<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New make/autoconf/platform.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 # Support macro for PLATFORM_EXTRACT_TARGET_AND_BUILD.
 27 # Converts autoconf style CPU name to OpenJDK style, into
 28 # VAR_CPU, VAR_CPU_ARCH, VAR_CPU_BITS and VAR_CPU_ENDIAN.
 29 AC_DEFUN([PLATFORM_EXTRACT_VARS_FROM_CPU],
 30 [
 31   # First argument is the cpu name from the trip/quad
 32   case &quot;$1&quot; in
 33     x86_64*x32)
 34       VAR_CPU=x32
 35       VAR_CPU_ARCH=x86
 36       VAR_CPU_BITS=32
 37       VAR_CPU_ENDIAN=little
 38       ;;
 39     x86_64)
 40       VAR_CPU=x86_64
 41       VAR_CPU_ARCH=x86
 42       VAR_CPU_BITS=64
 43       VAR_CPU_ENDIAN=little
 44       ;;
 45     i?86)
 46       VAR_CPU=x86
 47       VAR_CPU_ARCH=x86
 48       VAR_CPU_BITS=32
 49       VAR_CPU_ENDIAN=little
 50       ;;
 51     alpha*)
 52       VAR_CPU=alpha
 53       VAR_CPU_ARCH=alpha
 54       VAR_CPU_BITS=64
 55       VAR_CPU_ENDIAN=little
 56       ;;
 57     arm*)
 58       VAR_CPU=arm
 59       VAR_CPU_ARCH=arm
 60       VAR_CPU_BITS=32
 61       VAR_CPU_ENDIAN=little
 62       ;;
 63     aarch64)
 64       VAR_CPU=aarch64
 65       VAR_CPU_ARCH=aarch64
 66       VAR_CPU_BITS=64
 67       VAR_CPU_ENDIAN=little
 68       ;;
 69     ia64)
 70       VAR_CPU=ia64
 71       VAR_CPU_ARCH=ia64
 72       VAR_CPU_BITS=64
 73       VAR_CPU_ENDIAN=little
 74       ;;
 75     m68k)
 76       VAR_CPU=m68k
 77       VAR_CPU_ARCH=m68k
 78       VAR_CPU_BITS=32
 79       VAR_CPU_ENDIAN=big
 80       ;;
 81     mips)
 82       VAR_CPU=mips
 83       VAR_CPU_ARCH=mips
 84       VAR_CPU_BITS=32
 85       VAR_CPU_ENDIAN=big
 86       ;;
 87     mipsel)
 88       VAR_CPU=mipsel
 89       VAR_CPU_ARCH=mipsel
 90       VAR_CPU_BITS=32
 91       VAR_CPU_ENDIAN=little
 92       ;;
 93     mips64)
 94       VAR_CPU=mips64
 95       VAR_CPU_ARCH=mips64
 96       VAR_CPU_BITS=64
 97       VAR_CPU_ENDIAN=big
 98       ;;
 99     mips64el)
100       VAR_CPU=mips64el
101       VAR_CPU_ARCH=mips64el
102       VAR_CPU_BITS=64
103       VAR_CPU_ENDIAN=little
104       ;;
105     powerpc)
106       VAR_CPU=ppc
107       VAR_CPU_ARCH=ppc
108       VAR_CPU_BITS=32
109       VAR_CPU_ENDIAN=big
110       ;;
111     powerpc64)
112       VAR_CPU=ppc64
113       VAR_CPU_ARCH=ppc
114       VAR_CPU_BITS=64
115       VAR_CPU_ENDIAN=big
116       ;;
117     powerpc64le)
118       VAR_CPU=ppc64le
119       VAR_CPU_ARCH=ppc
120       VAR_CPU_BITS=64
121       VAR_CPU_ENDIAN=little
122       ;;
123     riscv64)
124       VAR_CPU=riscv64
125       VAR_CPU_ARCH=riscv
126       VAR_CPU_BITS=64
127       VAR_CPU_ENDIAN=little
128       ;;
129     s390)
130       VAR_CPU=s390
131       VAR_CPU_ARCH=s390
132       VAR_CPU_BITS=32
133       VAR_CPU_ENDIAN=big
134       ;;
135     s390x)
136       VAR_CPU=s390x
137       VAR_CPU_ARCH=s390
138       VAR_CPU_BITS=64
139       VAR_CPU_ENDIAN=big
140       ;;
141     sh*eb)
142       VAR_CPU=sh
143       VAR_CPU_ARCH=sh
144       VAR_CPU_BITS=32
145       VAR_CPU_ENDIAN=big
146       ;;
147     sh*)
148       VAR_CPU=sh
149       VAR_CPU_ARCH=sh
150       VAR_CPU_BITS=32
151       VAR_CPU_ENDIAN=little
152       ;;
153     sparc)
154       VAR_CPU=sparc
155       VAR_CPU_ARCH=sparc
156       VAR_CPU_BITS=32
157       VAR_CPU_ENDIAN=big
158       ;;
159     sparcv9|sparc64)
160       VAR_CPU=sparcv9
161       VAR_CPU_ARCH=sparc
162       VAR_CPU_BITS=64
163       VAR_CPU_ENDIAN=big
164       ;;
165     sparc)
166       VAR_CPU=sparc
167       VAR_CPU_ARCH=sparc
168       VAR_CPU_BITS=32
169       VAR_CPU_ENDIAN=big
170       ;;
171     sparcv9|sparc64)
172       VAR_CPU=sparcv9
173       VAR_CPU_ARCH=sparc
174       VAR_CPU_BITS=64
175       VAR_CPU_ENDIAN=big
176       ;;
177     *)
178       AC_MSG_ERROR([unsupported cpu $1])
179       ;;
180   esac
181 ])
182 
183 # Support macro for PLATFORM_EXTRACT_TARGET_AND_BUILD.
184 # Converts autoconf style OS name to OpenJDK style, into
185 # VAR_OS, VAR_OS_TYPE and VAR_OS_ENV.
186 AC_DEFUN([PLATFORM_EXTRACT_VARS_FROM_OS],
187 [
188   case &quot;$1&quot; in
189     *linux*)
190       VAR_OS=linux
191       VAR_OS_TYPE=unix
192       ;;
193     *darwin*)
194       VAR_OS=macosx
195       VAR_OS_TYPE=unix
196       ;;
197     *bsd*)
198       VAR_OS=bsd
199       VAR_OS_TYPE=unix
200       ;;
201     *cygwin*)
202       VAR_OS=windows
203       VAR_OS_ENV=windows.cygwin
204       ;;
205     *wsl*)
206       VAR_OS=windows
207       VAR_OS_ENV=windows.wsl
208       ;;
209     *mingw*)
210       VAR_OS=windows
211       VAR_OS_ENV=windows.msys
212       ;;
213     *aix*)
214       VAR_OS=aix
215       VAR_OS_TYPE=unix
216       ;;
217     *)
218       AC_MSG_ERROR([unsupported operating system $1])
219       ;;
220   esac
221 ])
222 
223 # Support macro for PLATFORM_EXTRACT_TARGET_AND_BUILD.
224 # Converts autoconf style OS name to OpenJDK style, into
225 # VAR_LIBC.
226 AC_DEFUN([PLATFORM_EXTRACT_VARS_FROM_LIBC],
227 [
228   case &quot;$1&quot; in
229     *linux*-musl)
230       VAR_LIBC=musl
231       ;;
232     *linux*-gnu)
233       VAR_LIBC=gnu
234       ;;
235     *)
236       VAR_LIBC=default
237       ;;
238   esac
239 ])
240 
241 # Expects $host_os $host_cpu $build_os and $build_cpu
242 # and $with_target_bits to have been setup!
243 #
244 # Translate the standard triplet(quadruplet) definition
245 # of the target/build system into OPENJDK_TARGET_OS, OPENJDK_TARGET_CPU,
246 # OPENJDK_BUILD_OS, etc.
247 AC_DEFUN([PLATFORM_EXTRACT_TARGET_AND_BUILD],
248 [
249   # Copy the autoconf trip/quadruplet verbatim to OPENJDK_TARGET_AUTOCONF_NAME
250   # (from the autoconf &quot;host&quot;) and OPENJDK_BUILD_AUTOCONF_NAME
251   # Note that we might later on rewrite e.g. OPENJDK_TARGET_CPU due to reduced build,
252   # but this will not change the value of OPENJDK_TARGET_AUTOCONF_NAME.
253   OPENJDK_TARGET_AUTOCONF_NAME=&quot;$host&quot;
254   OPENJDK_BUILD_AUTOCONF_NAME=&quot;$build&quot;
255   AC_SUBST(OPENJDK_TARGET_AUTOCONF_NAME)
256   AC_SUBST(OPENJDK_BUILD_AUTOCONF_NAME)
257 
258   # Convert the autoconf OS/CPU value to our own data, into the VAR_OS/CPU/LIBC variables.
259   PLATFORM_EXTRACT_VARS_FROM_OS($build_os)
260   PLATFORM_EXTRACT_VARS_FROM_CPU($build_cpu)
261   PLATFORM_EXTRACT_VARS_FROM_LIBC($build_os)
262   # ..and setup our own variables. (Do this explicitly to facilitate searching)
263   OPENJDK_BUILD_OS=&quot;$VAR_OS&quot;
264   if test &quot;x$VAR_OS_TYPE&quot; != x; then
265     OPENJDK_BUILD_OS_TYPE=&quot;$VAR_OS_TYPE&quot;
266   else
267     OPENJDK_BUILD_OS_TYPE=&quot;$VAR_OS&quot;
268   fi
269   if test &quot;x$VAR_OS_ENV&quot; != x; then
270     OPENJDK_BUILD_OS_ENV=&quot;$VAR_OS_ENV&quot;
271   else
272     OPENJDK_BUILD_OS_ENV=&quot;$VAR_OS&quot;
273   fi
274   OPENJDK_BUILD_CPU=&quot;$VAR_CPU&quot;
275   OPENJDK_BUILD_CPU_ARCH=&quot;$VAR_CPU_ARCH&quot;
276   OPENJDK_BUILD_CPU_BITS=&quot;$VAR_CPU_BITS&quot;
277   OPENJDK_BUILD_CPU_ENDIAN=&quot;$VAR_CPU_ENDIAN&quot;
278   OPENJDK_BUILD_LIBC=&quot;$VAR_LIBC&quot;
279   AC_SUBST(OPENJDK_BUILD_OS)
280   AC_SUBST(OPENJDK_BUILD_OS_TYPE)
281   AC_SUBST(OPENJDK_BUILD_OS_ENV)
282   AC_SUBST(OPENJDK_BUILD_CPU)
283   AC_SUBST(OPENJDK_BUILD_CPU_ARCH)
284   AC_SUBST(OPENJDK_BUILD_CPU_BITS)
285   AC_SUBST(OPENJDK_BUILD_CPU_ENDIAN)
286   AC_SUBST(OPENJDK_BUILD_LIBC)
287 
288   AC_MSG_CHECKING([openjdk-build os-cpu])
289   AC_MSG_RESULT([$OPENJDK_BUILD_OS-$OPENJDK_BUILD_CPU])
290 
291   if test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xlinux&quot;; then
292     AC_MSG_CHECKING([openjdk-build C library])
293     AC_MSG_RESULT([$OPENJDK_BUILD_LIBC])
294   fi
295 
296   # Convert the autoconf OS/CPU value to our own data, into the VAR_OS/CPU/LIBC variables.
297   PLATFORM_EXTRACT_VARS_FROM_OS($host_os)
298   PLATFORM_EXTRACT_VARS_FROM_CPU($host_cpu)
299   PLATFORM_EXTRACT_VARS_FROM_LIBC($host_os)
300   # ... and setup our own variables. (Do this explicitly to facilitate searching)
301   OPENJDK_TARGET_OS=&quot;$VAR_OS&quot;
302   if test &quot;x$VAR_OS_TYPE&quot; != x; then
303     OPENJDK_TARGET_OS_TYPE=&quot;$VAR_OS_TYPE&quot;
304   else
305     OPENJDK_TARGET_OS_TYPE=&quot;$VAR_OS&quot;
306   fi
307   if test &quot;x$VAR_OS_ENV&quot; != x; then
308     OPENJDK_TARGET_OS_ENV=&quot;$VAR_OS_ENV&quot;
309   else
310     OPENJDK_TARGET_OS_ENV=&quot;$VAR_OS&quot;
311   fi
312   OPENJDK_TARGET_CPU=&quot;$VAR_CPU&quot;
313   OPENJDK_TARGET_CPU_ARCH=&quot;$VAR_CPU_ARCH&quot;
314   OPENJDK_TARGET_CPU_BITS=&quot;$VAR_CPU_BITS&quot;
315   OPENJDK_TARGET_CPU_ENDIAN=&quot;$VAR_CPU_ENDIAN&quot;
316   OPENJDK_TARGET_OS_UPPERCASE=`$ECHO $OPENJDK_TARGET_OS | $TR &#39;abcdefghijklmnopqrstuvwxyz&#39; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;`
317   OPENJDK_TARGET_LIBC=&quot;$VAR_LIBC&quot;
318 
319   AC_SUBST(OPENJDK_TARGET_OS)
320   AC_SUBST(OPENJDK_TARGET_OS_TYPE)
321   AC_SUBST(OPENJDK_TARGET_OS_ENV)
322   AC_SUBST(OPENJDK_TARGET_OS_UPPERCASE)
323   AC_SUBST(OPENJDK_TARGET_CPU)
324   AC_SUBST(OPENJDK_TARGET_CPU_ARCH)
325   AC_SUBST(OPENJDK_TARGET_CPU_BITS)
326   AC_SUBST(OPENJDK_TARGET_CPU_ENDIAN)
327   AC_SUBST(OPENJDK_TARGET_LIBC)
328 
329   AC_MSG_CHECKING([openjdk-target os-cpu])
330   AC_MSG_RESULT([$OPENJDK_TARGET_OS-$OPENJDK_TARGET_CPU])
331 
332   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot;; then
333     AC_MSG_CHECKING([openjdk-target C library])
334     AC_MSG_RESULT([$OPENJDK_TARGET_LIBC])
335   fi
336 ])
337 
338 # Check if a reduced build (32-bit on 64-bit platforms) is requested, and modify behaviour
339 # accordingly. Must be done after setting up build and target system, but before
340 # doing anything else with these values.
341 AC_DEFUN([PLATFORM_SETUP_TARGET_CPU_BITS],
342 [
343   AC_ARG_WITH(target-bits, [AS_HELP_STRING([--with-target-bits],
344        [build 32-bit or 64-bit binaries (for platforms that support it), e.g. --with-target-bits=32 @&lt;:@guessed@:&gt;@])])
345 
346   # We have three types of compiles:
347   # native  == normal compilation, target system == build system
348   # cross   == traditional cross compilation, target system != build system; special toolchain needed
349   # reduced == using native compilers, but with special flags (e.g. -m32) to produce 32-bit builds on 64-bit machines
350   #
351   if test &quot;x$OPENJDK_BUILD_AUTOCONF_NAME&quot; != &quot;x$OPENJDK_TARGET_AUTOCONF_NAME&quot;; then
352     # We&#39;re doing a proper cross-compilation
353     COMPILE_TYPE=&quot;cross&quot;
354   else
355     COMPILE_TYPE=&quot;native&quot;
356   fi
357 
358   if test &quot;x$with_target_bits&quot; != x; then
359     if test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then
360       AC_MSG_ERROR([It is not possible to combine --with-target-bits=X and proper cross-compilation. Choose either.])
361     fi
362 
363     if test &quot;x$with_target_bits&quot; = x32 &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
364       # A reduced build is requested
365       COMPILE_TYPE=&quot;reduced&quot;
366       OPENJDK_TARGET_CPU_BITS=32
367       if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xx86&quot;; then
368         OPENJDK_TARGET_CPU=x86
369       elif test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xsparc&quot;; then
370         OPENJDK_TARGET_CPU=sparc
371       else
372         AC_MSG_ERROR([Reduced build (--with-target-bits=32) is only supported on x86_64 and sparcv9])
373       fi
374     elif test &quot;x$with_target_bits&quot; = x64 &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x32; then
375       AC_MSG_ERROR([It is not possible to use --with-target-bits=64 on a 32 bit system. Use proper cross-compilation instead.])
376     elif test &quot;x$with_target_bits&quot; = &quot;x$OPENJDK_TARGET_CPU_BITS&quot;; then
377       AC_MSG_NOTICE([--with-target-bits are set to build platform address size; argument has no meaning])
378     else
379       AC_MSG_ERROR([--with-target-bits can only be 32 or 64, you specified $with_target_bits!])
380     fi
381   fi
382   AC_SUBST(COMPILE_TYPE)
383 
384   AC_MSG_CHECKING([compilation type])
385   AC_MSG_RESULT([$COMPILE_TYPE])
386 ])
387 
388 # Setup the legacy variables, for controlling the old makefiles.
389 #
390 AC_DEFUN([PLATFORM_SETUP_LEGACY_VARS],
391 [
392   PLATFORM_SETUP_LEGACY_VARS_HELPER([TARGET])
393   PLATFORM_SETUP_LEGACY_VARS_HELPER([BUILD])
394 ])
395 
396 # $1 - Either TARGET or BUILD to setup the variables for.
397 AC_DEFUN([PLATFORM_SETUP_LEGACY_VARS_HELPER],
398 [
399   # Also store the legacy naming of the cpu.
400   # Ie i586 and amd64 instead of x86 and x86_64
401   OPENJDK_$1_CPU_LEGACY=&quot;$OPENJDK_$1_CPU&quot;
402   if test &quot;x$OPENJDK_$1_CPU&quot; = xx86; then
403     OPENJDK_$1_CPU_LEGACY=&quot;i586&quot;
404   elif test &quot;x$OPENJDK_$1_OS&quot; != xmacosx &amp;&amp; test &quot;x$OPENJDK_$1_CPU&quot; = xx86_64; then
405     # On all platforms except MacOSX replace x86_64 with amd64.
406     OPENJDK_$1_CPU_LEGACY=&quot;amd64&quot;
407   elif test &quot;x$OPENJDK_$1_CPU&quot; = xalpha; then
408     # Avoid name collisions with variables named alpha
409     OPENJDK_$1_CPU_LEGACY=&quot;_alpha_&quot;
410   elif test &quot;x$OPENJDK_$1_CPU&quot; = xsh; then
411     # Avoid name collisions with variables named sh
412     OPENJDK_$1_CPU_LEGACY=&quot;_sh_&quot;
413   fi
414   AC_SUBST(OPENJDK_$1_CPU_LEGACY)
415 
416   # And the second legacy naming of the cpu.
417   # Ie i386 and amd64 instead of x86 and x86_64.
418   OPENJDK_$1_CPU_LEGACY_LIB=&quot;$OPENJDK_$1_CPU&quot;
419   if test &quot;x$OPENJDK_$1_CPU&quot; = xx86; then
420     OPENJDK_$1_CPU_LEGACY_LIB=&quot;i386&quot;
421   elif test &quot;x$OPENJDK_$1_CPU&quot; = xx86_64; then
422     OPENJDK_$1_CPU_LEGACY_LIB=&quot;amd64&quot;
423   fi
424   AC_SUBST(OPENJDK_$1_CPU_LEGACY_LIB)
425 
426   # Setup OPENJDK_$1_CPU_OSARCH, which is used to set the os.arch Java system property
427   OPENJDK_$1_CPU_OSARCH=&quot;$OPENJDK_$1_CPU&quot;
428   if test &quot;x$OPENJDK_$1_OS&quot; = xlinux &amp;&amp; test &quot;x$OPENJDK_$1_CPU&quot; = xx86; then
429     # On linux only, we replace x86 with i386.
430     OPENJDK_$1_CPU_OSARCH=&quot;i386&quot;
431   elif test &quot;x$OPENJDK_$1_OS&quot; != xmacosx &amp;&amp; test &quot;x$OPENJDK_$1_CPU&quot; = xx86_64; then
432     # On all platforms except macosx, we replace x86_64 with amd64.
433     OPENJDK_$1_CPU_OSARCH=&quot;amd64&quot;
434   fi
435   AC_SUBST(OPENJDK_$1_CPU_OSARCH)
436 
437   OPENJDK_$1_CPU_JLI=&quot;$OPENJDK_$1_CPU&quot;
438   if test &quot;x$OPENJDK_$1_CPU&quot; = xx86; then
439     OPENJDK_$1_CPU_JLI=&quot;i386&quot;
440   elif test &quot;x$OPENJDK_$1_OS&quot; != xmacosx &amp;&amp; test &quot;x$OPENJDK_$1_CPU&quot; = xx86_64; then
441     # On all platforms except macosx, we replace x86_64 with amd64.
442     OPENJDK_$1_CPU_JLI=&quot;amd64&quot;
443   fi
444 
445   # The new version string in JDK 9 also defined new naming of OS and ARCH for bundles
446   # Macosx is osx and x86_64 is x64
447   if test &quot;x$OPENJDK_$1_OS&quot; = xmacosx; then
448     OPENJDK_$1_OS_BUNDLE=&quot;osx&quot;
449   else
450     OPENJDK_$1_OS_BUNDLE=&quot;$OPENJDK_TARGET_OS&quot;
451   fi
452   if test &quot;x$OPENJDK_$1_CPU&quot; = xx86_64; then
453     OPENJDK_$1_CPU_BUNDLE=&quot;x64&quot;
454   else
455     OPENJDK_$1_CPU_BUNDLE=&quot;$OPENJDK_$1_CPU&quot;
456   fi
457 
458   OPENJDK_$1_LIBC_BUNDLE=&quot;&quot;
459   if test &quot;x$OPENJDK_$1_LIBC&quot; = &quot;xmusl&quot;; then
460     OPENJDK_$1_LIBC_BUNDLE=&quot;-$OPENJDK_$1_LIBC&quot;
461   fi
462 
463   OPENJDK_$1_BUNDLE_PLATFORM=&quot;${OPENJDK_$1_OS_BUNDLE}-${OPENJDK_$1_CPU_BUNDLE}${OPENJDK_$1_LIBC_BUNDLE}&quot;
464   AC_SUBST(OPENJDK_$1_BUNDLE_PLATFORM)
465 
466   if test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then
467     # FIXME: ... or should this include reduced builds..?
468     DEFINE_CROSS_COMPILE_ARCH=&quot;CROSS_COMPILE_ARCH:=$OPENJDK_$1_CPU_LEGACY&quot;
469   else
470     DEFINE_CROSS_COMPILE_ARCH=&quot;&quot;
471   fi
472   AC_SUBST(DEFINE_CROSS_COMPILE_ARCH)
473 
474   # Convert openjdk platform names to hotspot names
475 
476   HOTSPOT_$1_OS=${OPENJDK_$1_OS}
477   if test &quot;x$OPENJDK_$1_OS&quot; = xmacosx; then
478     HOTSPOT_$1_OS=bsd
479   fi
480   AC_SUBST(HOTSPOT_$1_OS)
481 
482   HOTSPOT_$1_OS_TYPE=${OPENJDK_$1_OS_TYPE}
483   if test &quot;x$OPENJDK_$1_OS_TYPE&quot; = xunix; then
484     HOTSPOT_$1_OS_TYPE=posix
485   fi
486   AC_SUBST(HOTSPOT_$1_OS_TYPE)
487 
488   HOTSPOT_$1_CPU=${OPENJDK_$1_CPU}
489   if test &quot;x$OPENJDK_$1_CPU&quot; = xx86; then
490     HOTSPOT_$1_CPU=x86_32
491   elif test &quot;x$OPENJDK_$1_CPU&quot; = xsparcv9; then
492     HOTSPOT_$1_CPU=sparc
493   elif test &quot;x$OPENJDK_$1_CPU&quot; = xppc64; then
494     HOTSPOT_$1_CPU=ppc_64
495   elif test &quot;x$OPENJDK_$1_CPU&quot; = xppc64le; then
496     HOTSPOT_$1_CPU=ppc_64
497   fi
498   AC_SUBST(HOTSPOT_$1_CPU)
499 
500   # This is identical with OPENJDK_*, but define anyway for consistency.
501   HOTSPOT_$1_CPU_ARCH=${OPENJDK_$1_CPU_ARCH}
502   AC_SUBST(HOTSPOT_$1_CPU_ARCH)
503 
504   # Setup HOTSPOT_$1_CPU_DEFINE
505   if test &quot;x$OPENJDK_$1_CPU&quot; = xx86; then
506     HOTSPOT_$1_CPU_DEFINE=IA32
507   elif test &quot;x$OPENJDK_$1_CPU&quot; = xx86_64; then
508     HOTSPOT_$1_CPU_DEFINE=AMD64
509   elif test &quot;x$OPENJDK_$1_CPU&quot; = xx32; then
510     HOTSPOT_$1_CPU_DEFINE=X32
511   elif test &quot;x$OPENJDK_$1_CPU&quot; = xsparcv9; then
512     HOTSPOT_$1_CPU_DEFINE=SPARC
513   elif test &quot;x$OPENJDK_$1_CPU&quot; = xaarch64; then
514     HOTSPOT_$1_CPU_DEFINE=AARCH64
515   elif test &quot;x$OPENJDK_$1_CPU&quot; = xppc64; then
516     HOTSPOT_$1_CPU_DEFINE=PPC64
517   elif test &quot;x$OPENJDK_$1_CPU&quot; = xppc64le; then
518     HOTSPOT_$1_CPU_DEFINE=PPC64
519 
520   # The cpu defines below are for zero, we don&#39;t support them directly.
521   elif test &quot;x$OPENJDK_$1_CPU&quot; = xsparc; then
522     HOTSPOT_$1_CPU_DEFINE=SPARC
523   elif test &quot;x$OPENJDK_$1_CPU&quot; = xppc; then
524     HOTSPOT_$1_CPU_DEFINE=PPC32
525   elif test &quot;x$OPENJDK_$1_CPU&quot; = xs390; then
526     HOTSPOT_$1_CPU_DEFINE=S390
527   elif test &quot;x$OPENJDK_$1_CPU&quot; = xs390x; then
528     HOTSPOT_$1_CPU_DEFINE=S390
529   elif test &quot;x$OPENJDK_$1_CPU&quot; = xriscv64; then
530     HOTSPOT_$1_CPU_DEFINE=RISCV
531   elif test &quot;x$OPENJDK_$1_CPU&quot; != x; then
532     HOTSPOT_$1_CPU_DEFINE=$(echo $OPENJDK_$1_CPU | tr a-z A-Z)
533   fi
534   AC_SUBST(HOTSPOT_$1_CPU_DEFINE)
535 
536   if test &quot;x$OPENJDK_$1_LIBC&quot; = &quot;xmusl&quot;; then
537     HOTSPOT_$1_LIBC=$OPENJDK_$1_LIBC
538   else
539     HOTSPOT_$1_LIBC=&quot;&quot;
540   fi
541   AC_SUBST(HOTSPOT_$1_LIBC)
542 
543   # For historical reasons, the OS include directories have odd names.
544   OPENJDK_$1_OS_INCLUDE_SUBDIR=&quot;$OPENJDK_TARGET_OS&quot;
545   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
546     OPENJDK_$1_OS_INCLUDE_SUBDIR=&quot;win32&quot;
547   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
548     OPENJDK_$1_OS_INCLUDE_SUBDIR=&quot;darwin&quot;
549   fi
550   AC_SUBST(OPENJDK_$1_OS_INCLUDE_SUBDIR)
551 ])
552 
553 AC_DEFUN([PLATFORM_SET_RELEASE_FILE_OS_VALUES],
554 [
555   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot;; then
556     RELEASE_FILE_OS_NAME=Linux
557   fi
558   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
559     RELEASE_FILE_OS_NAME=Windows
560   fi
561   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
562     RELEASE_FILE_OS_NAME=&quot;Darwin&quot;
563   fi
564   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xaix&quot;; then
565     RELEASE_FILE_OS_NAME=&quot;AIX&quot;
566   fi
567   RELEASE_FILE_OS_ARCH=${OPENJDK_TARGET_CPU}
568   RELEASE_FILE_LIBC=${OPENJDK_TARGET_LIBC}
569 
570   AC_SUBST(RELEASE_FILE_OS_NAME)
571   AC_SUBST(RELEASE_FILE_OS_ARCH)
572   AC_SUBST(RELEASE_FILE_LIBC)
573 ])
574 
575 AC_DEFUN([PLATFORM_SET_MODULE_TARGET_OS_VALUES],
576 [
577   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
578     OPENJDK_MODULE_TARGET_OS_NAME=&quot;macos&quot;
579   else
580     OPENJDK_MODULE_TARGET_OS_NAME=&quot;$OPENJDK_TARGET_OS&quot;
581   fi
582 
583   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
584     OPENJDK_MODULE_TARGET_OS_ARCH=&quot;amd64&quot;
585   else
586     OPENJDK_MODULE_TARGET_OS_ARCH=&quot;$OPENJDK_TARGET_CPU&quot;
587   fi
588 
589   OPENJDK_MODULE_TARGET_PLATFORM=&quot;${OPENJDK_MODULE_TARGET_OS_NAME}-${OPENJDK_MODULE_TARGET_OS_ARCH}&quot;
590   AC_SUBST(OPENJDK_MODULE_TARGET_PLATFORM)
591 ])
592 
593 #%%% Build and target systems %%%
594 AC_DEFUN_ONCE([PLATFORM_SETUP_OPENJDK_BUILD_AND_TARGET],
595 [
596   # Figure out the build and target systems. # Note that in autoconf terminology, &quot;build&quot; is obvious, but &quot;target&quot;
597   # is confusing; it assumes you are cross-compiling a cross-compiler (!)  and &quot;target&quot; is thus the target of the
598   # product you&#39;re building. The target of this build is called &quot;host&quot;. Since this is confusing to most people, we
599   # have not adopted that system, but use &quot;target&quot; as the platform we are building for. In some places though we need
600   # to use the configure naming style.
601   AC_CANONICAL_BUILD
602   AC_CANONICAL_HOST
603   AC_CANONICAL_TARGET
604 
605   PLATFORM_EXTRACT_TARGET_AND_BUILD
606   PLATFORM_SETUP_TARGET_CPU_BITS
607   PLATFORM_SET_MODULE_TARGET_OS_VALUES
608   PLATFORM_SET_RELEASE_FILE_OS_VALUES
609   PLATFORM_SETUP_LEGACY_VARS
610 
611   # Deprecated in JDK 15
612   UTIL_DEPRECATED_ARG_ENABLE(deprecated-ports)
613 ])
614 
615 AC_DEFUN_ONCE([PLATFORM_SETUP_OPENJDK_BUILD_OS_VERSION],
616 [
617   ###############################################################################
618 
619   # Note that this is the build platform OS version!
620 
621   OS_VERSION=&quot;`uname -r | ${SED} &#39;s!\.! !g&#39; | ${SED} &#39;s!-! !g&#39;`&quot;
622   OS_VERSION_MAJOR=&quot;`${ECHO} ${OS_VERSION} | ${CUT} -f 1 -d &#39; &#39;`&quot;
623   OS_VERSION_MINOR=&quot;`${ECHO} ${OS_VERSION} | ${CUT} -f 2 -d &#39; &#39;`&quot;
624   OS_VERSION_MICRO=&quot;`${ECHO} ${OS_VERSION} | ${CUT} -f 3 -d &#39; &#39;`&quot;
625   AC_SUBST(OS_VERSION_MAJOR)
626   AC_SUBST(OS_VERSION_MINOR)
627   AC_SUBST(OS_VERSION_MICRO)
628 ])
629 
630 AC_DEFUN_ONCE([PLATFORM_SETUP_OPENJDK_TARGET_BITS],
631 [
632   ###############################################################################
633   #
634   # Now we check if libjvm.so will use 32 or 64 bit pointers for the C/C++ code.
635   # (The JVM can use 32 or 64 bit Java pointers but that decision
636   # is made at runtime.)
637   #
638 
639   # Make compilation sanity check
640   AC_CHECK_HEADERS([stdio.h], , [
641     AC_MSG_NOTICE([Failed to compile stdio.h. This likely implies missing compile dependencies.])
642     if test &quot;x$COMPILE_TYPE&quot; = xreduced; then
643       HELP_MSG_MISSING_DEPENDENCY([reduced])
644       AC_MSG_NOTICE([You are doing a reduced build. Check that you have 32-bit libraries installed. $HELP_MSG])
645     elif test &quot;x$COMPILE_TYPE&quot; = xcross; then
646       AC_MSG_NOTICE([You are doing a cross-compilation. Check that you have all target platform libraries installed.])
647     fi
648     AC_MSG_ERROR([Cannot continue.])
649   ])
650 
651   AC_CHECK_SIZEOF([int *], [1111])
652 
653   # AC_CHECK_SIZEOF defines &#39;ac_cv_sizeof_int_p&#39; to hold the number of bytes used by an &#39;int*&#39;
654   if test &quot;x$ac_cv_sizeof_int_p&quot; = x; then
655     # The test failed, lets stick to the assumed value.
656     AC_MSG_WARN([The number of bits in the target could not be determined, using $OPENJDK_TARGET_CPU_BITS.])
657   else
658     TESTED_TARGET_CPU_BITS=`expr 8 \* $ac_cv_sizeof_int_p`
659 
660     if test &quot;x$TESTED_TARGET_CPU_BITS&quot; != &quot;x$OPENJDK_TARGET_CPU_BITS&quot;; then
661       AC_MSG_NOTICE([The tested number of bits in the target ($TESTED_TARGET_CPU_BITS) differs from the number of bits expected to be found in the target ($OPENJDK_TARGET_CPU_BITS)])
662       if test &quot;x$COMPILE_TYPE&quot; = xreduced; then
663         HELP_MSG_MISSING_DEPENDENCY([reduced])
664         AC_MSG_NOTICE([You are doing a reduced build. Check that you have 32-bit libraries installed. $HELP_MSG])
665       elif test &quot;x$COMPILE_TYPE&quot; = xcross; then
666         AC_MSG_NOTICE([You are doing a cross-compilation. Check that you have all target platform libraries installed.])
667       fi
668       AC_MSG_ERROR([Cannot continue.])
669     fi
670   fi
671 
672   AC_MSG_CHECKING([for target address size])
673   AC_MSG_RESULT([$OPENJDK_TARGET_CPU_BITS bits])
674 ])
675 
676 AC_DEFUN_ONCE([PLATFORM_SETUP_OPENJDK_TARGET_ENDIANNESS],
677 [
678   ###############################################################################
679   #
680   # Is the target little of big endian?
681   #
682   AC_C_BIGENDIAN([ENDIAN=&quot;big&quot;],[ENDIAN=&quot;little&quot;],[ENDIAN=&quot;unknown&quot;],[ENDIAN=&quot;universal_endianness&quot;])
683 
684   if test &quot;x$ENDIAN&quot; = xuniversal_endianness; then
685     AC_MSG_ERROR([Building with both big and little endianness is not supported])
686   fi
687   if test &quot;x$ENDIAN&quot; != &quot;x$OPENJDK_TARGET_CPU_ENDIAN&quot;; then
688     AC_MSG_ERROR([The tested endian in the target ($ENDIAN) differs from the endian expected to be found in the target ($OPENJDK_TARGET_CPU_ENDIAN)])
689   fi
690 ])
    </pre>
  </body>
</html>