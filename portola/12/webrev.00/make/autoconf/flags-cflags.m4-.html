<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/autoconf/flags-cflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 #
 28 # Setup flags for C/C++ compiler
 29 #
 30 
 31 ###############################################################################
 32 #
 33 # How to compile shared libraries.
 34 #
 35 AC_DEFUN([FLAGS_SETUP_SHARED_LIBS],
 36 [
 37   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 38     # Default works for linux, might work on other platforms as well.
 39     SHARED_LIBRARY_FLAGS=&#39;-shared&#39;
 40     SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,\$$ORIGIN[$]1&#39;
 41     SET_SHARED_LIBRARY_ORIGIN=&quot;-Wl,-z,origin $SET_EXECUTABLE_ORIGIN&quot;
 42     SET_SHARED_LIBRARY_NAME=&#39;-Wl,-soname=[$]1&#39;
 43     SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-version-script=[$]1&#39;
 44 
 45   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 46     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
 47       # Linking is different on MacOSX
 48       SHARED_LIBRARY_FLAGS=&quot;-dynamiclib -compatibility_version 1.0.0 -current_version 1.0.0&quot;
 49       SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,@loader_path$(or [$]1,/.)&#39;
 50       SET_SHARED_LIBRARY_ORIGIN=&quot;$SET_EXECUTABLE_ORIGIN&quot;
 51       SET_SHARED_LIBRARY_NAME=&#39;-Wl,-install_name,@rpath/[$]1&#39;
 52       SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-exported_symbols_list,[$]1&#39;
 53 
 54     else
 55       # Default works for linux, might work on other platforms as well.
 56       SHARED_LIBRARY_FLAGS=&#39;-shared&#39;
 57       SET_EXECUTABLE_ORIGIN=&#39;-Wl,-rpath,\$$ORIGIN[$]1&#39;
 58       SET_SHARED_LIBRARY_NAME=&#39;-Wl,-soname=[$]1&#39;
 59       SET_SHARED_LIBRARY_MAPFILE=&#39;-Wl,-version-script=[$]1&#39;
 60 
 61       # arm specific settings
 62       if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xarm&quot;; then
 63         # &#39;-Wl,-z,origin&#39; isn&#39;t used on arm.
 64         SET_SHARED_LIBRARY_ORIGIN=&#39;-Wl,-rpath,\$$$$ORIGIN[$]1&#39;
 65       else
 66         SET_SHARED_LIBRARY_ORIGIN=&quot;-Wl,-z,origin $SET_EXECUTABLE_ORIGIN&quot;
 67       fi
 68     fi
 69 
 70   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
 71     SHARED_LIBRARY_FLAGS=&quot;-qmkshrobj -bM:SRE -bnoentry&quot;
 72     SET_EXECUTABLE_ORIGIN=&quot;&quot;
 73     SET_SHARED_LIBRARY_ORIGIN=&#39;&#39;
 74     SET_SHARED_LIBRARY_NAME=&#39;&#39;
 75     SET_SHARED_LIBRARY_MAPFILE=&#39;&#39;
 76 
 77   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 78     SHARED_LIBRARY_FLAGS=&quot;-dll&quot;
 79     SET_EXECUTABLE_ORIGIN=&#39;&#39;
 80     SET_SHARED_LIBRARY_ORIGIN=&#39;&#39;
 81     SET_SHARED_LIBRARY_NAME=&#39;&#39;
 82     SET_SHARED_LIBRARY_MAPFILE=&#39;-def:[$]1&#39;
 83   fi
 84 
 85   AC_SUBST(SET_EXECUTABLE_ORIGIN)
 86   AC_SUBST(SET_SHARED_LIBRARY_ORIGIN)
 87   AC_SUBST(SET_SHARED_LIBRARY_NAME)
 88   AC_SUBST(SET_SHARED_LIBRARY_MAPFILE)
 89   AC_SUBST(SHARED_LIBRARY_FLAGS)
 90 ])
 91 
 92 AC_DEFUN([FLAGS_SETUP_DEBUG_SYMBOLS],
 93 [
 94   # By default don&#39;t set any specific assembler debug
 95   # info flags for toolchains unless we know they work.
 96   # See JDK-8207057.
 97   ASFLAGS_DEBUG_SYMBOLS=&quot;&quot;
 98   # Debug symbols
 99   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
100     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
101     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
102   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
103     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
104     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
105   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
106     CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;
107   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
108     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7&quot;
109   fi
110 
111   AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
112   AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
113 ])
114 
115 AC_DEFUN([FLAGS_SETUP_WARNINGS],
116 [
117   # Set default value.
118   if test &quot;x$TOOLCHAIN_TYPE&quot; != xxlc; then
119     WARNINGS_AS_ERRORS_DEFAULT=true
120   else
121     WARNINGS_AS_ERRORS_DEFAULT=false
122   fi
123 
124   UTIL_ARG_ENABLE(NAME: warnings-as-errors, DEFAULT: $WARNINGS_AS_ERRORS_DEFAULT,
125       RESULT: WARNINGS_AS_ERRORS,
126       DEFAULT_DESC: [auto],
127       DESC: [consider native warnings to be an error])
128   AC_SUBST(WARNINGS_AS_ERRORS)
129 
130   case &quot;${TOOLCHAIN_TYPE}&quot; in
131     microsoft)
132       DISABLE_WARNING_PREFIX=&quot;-wd&quot;
133       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-WX&quot;
134 
135       WARNINGS_ENABLE_ALL=&quot;-W3&quot;
136       DISABLED_WARNINGS=&quot;4800&quot;
137       ;;
138 
139     gcc)
140       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
141       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
142 
143       # Additional warnings that are not activated by -Wall and -Wextra
144       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare \
145           -Wunused-function -Wundef -Wunused-value -Wreturn-type \
146           -Wtrampolines&quot;
147       WARNINGS_ENABLE_ADDITIONAL_CXX=&quot;-Woverloaded-virtual -Wreorder&quot;
148       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
149       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;$WARNINGS_ENABLE_ALL_CFLAGS $WARNINGS_ENABLE_ADDITIONAL_CXX&quot;
150 
151       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;
152       BUILD_CC_DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
153       ;;
154 
155     clang)
156       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
157       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
158 
159       # Additional warnings that are not activated by -Wall and -Wextra
160       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare -Wreorder \
161           -Wunused-function -Wundef -Wunused-value -Woverloaded-virtual&quot;
162       WARNINGS_ENABLE_ALL=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
163 
164       DISABLED_WARNINGS=&quot;unknown-warning-option unused-parameter unused&quot;
165 
166       if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
167         # missing-method-return-type triggers in JavaNativeFoundation framework
168         DISABLED_WARNINGS=&quot;$DISABLED_WARNINGS missing-method-return-type&quot;
169       fi
170 
171       ;;
172 
173     xlc)
174       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
175       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-qhalt=w&quot;
176 
177       # Possibly a better subset than &quot;all&quot; is &quot;lan:trx:ret:zea:cmp:ret&quot;
178       WARNINGS_ENABLE_ALL=&quot;-qinfo=all -qformat=all&quot;
179       DISABLED_WARNINGS=&quot;&quot;
180       ;;
181   esac
182   AC_SUBST(DISABLE_WARNING_PREFIX)
183   AC_SUBST(BUILD_CC_DISABLE_WARNING_PREFIX)
184   AC_SUBST(CFLAGS_WARNINGS_ARE_ERRORS)
185   AC_SUBST(DISABLED_WARNINGS)
186   AC_SUBST(DISABLED_WARNINGS_C)
187   AC_SUBST(DISABLED_WARNINGS_CXX)
188 ])
189 
190 AC_DEFUN([FLAGS_SETUP_QUALITY_CHECKS],
191 [
192   # bounds, memory and behavior checking options
193   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
194     case $DEBUG_LEVEL in
195     release )
196       # no adjustment
197       ;;
198     fastdebug )
199       # no adjustment
200       ;;
201     slowdebug )
202       # FIXME: By adding this to C(XX)FLAGS_DEBUG_OPTIONS/JVM_CFLAGS_SYMBOLS it
203       # get&#39;s added conditionally on whether we produce debug symbols or not.
204       # This is most likely not really correct.
205 
206       # Add runtime stack smashing and undefined behavior checks.
207       CFLAGS_DEBUG_OPTIONS=&quot;-fstack-protector-all --param ssp-buffer-size=1&quot;
208       CXXFLAGS_DEBUG_OPTIONS=&quot;-fstack-protector-all --param ssp-buffer-size=1&quot;
209 
210       JVM_CFLAGS_SYMBOLS=&quot;$JVM_CFLAGS_SYMBOLS -fstack-protector-all --param ssp-buffer-size=1&quot;
211       ;;
212     esac
213   fi
214 ])
215 
216 AC_DEFUN([FLAGS_SETUP_OPTIMIZATION],
217 [
218   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
219     C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
220     C_O_FLAG_HIGHEST=&quot;-O3&quot;
221     C_O_FLAG_HI=&quot;-O3&quot;
222     C_O_FLAG_NORM=&quot;-O2&quot;
223     C_O_FLAG_SIZE=&quot;-Os&quot;
224     C_O_FLAG_DEBUG=&quot;-O0&quot;
225     C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
226     C_O_FLAG_NONE=&quot;-O0&quot;
227     # -D_FORTIFY_SOURCE=2 hardening option needs optimization (at least -O1) enabled
228     # set for lower O-levels -U_FORTIFY_SOURCE to overwrite previous settings
229     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux -a &quot;x$DEBUG_LEVEL&quot; = &quot;xfastdebug&quot;; then
230       ENABLE_FORTIFY_CFLAGS=&quot;-D_FORTIFY_SOURCE=2&quot;
231       DISABLE_FORTIFY_CFLAGS=&quot;-U_FORTIFY_SOURCE&quot;
232       C_O_FLAG_HIGHEST_JVM=&quot;${C_O_FLAG_HIGHEST_JVM} ${ENABLE_FORTIFY_CFLAGS}&quot;
233       C_O_FLAG_HIGHEST=&quot;${C_O_FLAG_HIGHEST} ${ENABLE_FORTIFY_CFLAGS}&quot;
234       C_O_FLAG_HI=&quot;${C_O_FLAG_HI} ${ENABLE_FORTIFY_CFLAGS}&quot;
235       C_O_FLAG_NORM=&quot;${C_O_FLAG_NORM} ${ENABLE_FORTIFY_CFLAGS}&quot;
236       C_O_FLAG_SIZE=&quot;${C_O_FLAG_SIZE} ${DISABLE_FORTIFY_CFLAGS}&quot;
237       C_O_FLAG_DEBUG=&quot;${C_O_FLAG_DEBUG} ${DISABLE_FORTIFY_CFLAGS}&quot;
238       C_O_FLAG_DEBUG_JVM=&quot;${C_O_FLAG_DEBUG_JVM} ${DISABLE_FORTIFY_CFLAGS}&quot;
239       C_O_FLAG_NONE=&quot;${C_O_FLAG_NONE} ${DISABLE_FORTIFY_CFLAGS}&quot;
240     fi
241   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
242     C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
243     C_O_FLAG_HIGHEST=&quot;-O3&quot;
244     C_O_FLAG_HI=&quot;-O3&quot;
245     C_O_FLAG_NORM=&quot;-O2&quot;
246     C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
247     C_O_FLAG_SIZE=&quot;-Os&quot;
248     C_O_FLAG_DEBUG=&quot;-O0&quot;
249     C_O_FLAG_NONE=&quot;-O0&quot;
250   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
251     C_O_FLAG_HIGHEST_JVM=&quot;-O3 -qhot=level=1 -qinline -qinlglue&quot;
252     C_O_FLAG_HIGHEST=&quot;-O3 -qhot=level=1 -qinline -qinlglue&quot;
253     C_O_FLAG_HI=&quot;-O3 -qinline -qinlglue&quot;
254     C_O_FLAG_NORM=&quot;-O2&quot;
255     C_O_FLAG_DEBUG=&quot;-qnoopt&quot;
256     # FIXME: Value below not verified.
257     C_O_FLAG_DEBUG_JVM=&quot;&quot;
258     C_O_FLAG_NONE=&quot;-qnoopt&quot;
259   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
260     C_O_FLAG_HIGHEST_JVM=&quot;-O2 -Oy-&quot;
261     C_O_FLAG_HIGHEST=&quot;-O2&quot;
262     C_O_FLAG_HI=&quot;-O1&quot;
263     C_O_FLAG_NORM=&quot;-O1&quot;
264     C_O_FLAG_DEBUG=&quot;-Od&quot;
265     C_O_FLAG_DEBUG_JVM=&quot;&quot;
266     C_O_FLAG_NONE=&quot;-Od&quot;
267     C_O_FLAG_SIZE=&quot;-Os&quot;
268   fi
269 
270   # Now copy to C++ flags
271   CXX_O_FLAG_HIGHEST_JVM=&quot;$C_O_FLAG_HIGHEST_JVM&quot;
272   CXX_O_FLAG_HIGHEST=&quot;$C_O_FLAG_HIGHEST&quot;
273   CXX_O_FLAG_HI=&quot;$C_O_FLAG_HI&quot;
274   CXX_O_FLAG_NORM=&quot;$C_O_FLAG_NORM&quot;
275   CXX_O_FLAG_DEBUG=&quot;$C_O_FLAG_DEBUG&quot;
276   CXX_O_FLAG_DEBUG_JVM=&quot;$C_O_FLAG_DEBUG_JVM&quot;
277   CXX_O_FLAG_NONE=&quot;$C_O_FLAG_NONE&quot;
278   CXX_O_FLAG_SIZE=&quot;$C_O_FLAG_SIZE&quot;
279 
280   # Adjust optimization flags according to debug level.
281   case $DEBUG_LEVEL in
282     release )
283       # no adjustment
284       ;;
285     fastdebug )
286       # Not quite so much optimization
287       C_O_FLAG_HI=&quot;$C_O_FLAG_NORM&quot;
288       CXX_O_FLAG_HI=&quot;$CXX_O_FLAG_NORM&quot;
289       ;;
290     slowdebug )
291       # Disable optimization
292       C_O_FLAG_HIGHEST_JVM=&quot;$C_O_FLAG_DEBUG_JVM&quot;
293       C_O_FLAG_HIGHEST=&quot;$C_O_FLAG_DEBUG&quot;
294       C_O_FLAG_HI=&quot;$C_O_FLAG_DEBUG&quot;
295       C_O_FLAG_NORM=&quot;$C_O_FLAG_DEBUG&quot;
296       C_O_FLAG_SIZE=&quot;$C_O_FLAG_DEBUG&quot;
297       CXX_O_FLAG_HIGHEST_JVM=&quot;$CXX_O_FLAG_DEBUG_JVM&quot;
298       CXX_O_FLAG_HIGHEST=&quot;$CXX_O_FLAG_DEBUG&quot;
299       CXX_O_FLAG_HI=&quot;$CXX_O_FLAG_DEBUG&quot;
300       CXX_O_FLAG_NORM=&quot;$CXX_O_FLAG_DEBUG&quot;
301       CXX_O_FLAG_SIZE=&quot;$CXX_O_FLAG_DEBUG&quot;
302       ;;
303   esac
304 
305   AC_SUBST(C_O_FLAG_HIGHEST_JVM)
306   AC_SUBST(C_O_FLAG_HIGHEST)
307   AC_SUBST(C_O_FLAG_HI)
308   AC_SUBST(C_O_FLAG_NORM)
309   AC_SUBST(C_O_FLAG_NONE)
310   AC_SUBST(C_O_FLAG_SIZE)
311   AC_SUBST(CXX_O_FLAG_HIGHEST_JVM)
312   AC_SUBST(CXX_O_FLAG_HIGHEST)
313   AC_SUBST(CXX_O_FLAG_HI)
314   AC_SUBST(CXX_O_FLAG_NORM)
315   AC_SUBST(CXX_O_FLAG_NONE)
316   AC_SUBST(CXX_O_FLAG_SIZE)
317 ])
318 
319 AC_DEFUN([FLAGS_SETUP_CFLAGS],
320 [
321   ### CFLAGS
322 
323   FLAGS_SETUP_CFLAGS_HELPER
324 
325   FLAGS_OS=$OPENJDK_TARGET_OS
326   FLAGS_OS_TYPE=$OPENJDK_TARGET_OS_TYPE
327   FLAGS_CPU=$OPENJDK_TARGET_CPU
328   FLAGS_CPU_ARCH=$OPENJDK_TARGET_CPU_ARCH
329   FLAGS_CPU_BITS=$OPENJDK_TARGET_CPU_BITS
330   FLAGS_CPU_ENDIAN=$OPENJDK_TARGET_CPU_ENDIAN
331   FLAGS_CPU_LEGACY=$OPENJDK_TARGET_CPU_LEGACY
332   FLAGS_CPU_LEGACY_LIB=$OPENJDK_TARGET_CPU_LEGACY_LIB
333 
334   FLAGS_SETUP_CFLAGS_CPU_DEP([TARGET])
335 
336   # Repeat the check for the BUILD_CC and BUILD_CXX. Need to also reset CFLAGS
337   # since any target specific flags will likely not work with the build compiler.
338   CC_OLD=&quot;$CC&quot;
339   CXX_OLD=&quot;$CXX&quot;
340   CFLAGS_OLD=&quot;$CFLAGS&quot;
341   CXXFLAGS_OLD=&quot;$CXXFLAGS&quot;
342   CC=&quot;$BUILD_CC&quot;
343   CXX=&quot;$BUILD_CXX&quot;
344   CFLAGS=&quot;&quot;
345   CXXFLAGS=&quot;&quot;
346 
347   FLAGS_OS=$OPENJDK_BUILD_OS
348   FLAGS_OS_TYPE=$OPENJDK_BUILD_OS_TYPE
349   FLAGS_CPU=$OPENJDK_BUILD_CPU
350   FLAGS_CPU_ARCH=$OPENJDK_BUILD_CPU_ARCH
351   FLAGS_CPU_BITS=$OPENJDK_BUILD_CPU_BITS
352   FLAGS_CPU_ENDIAN=$OPENJDK_BUILD_CPU_ENDIAN
353   FLAGS_CPU_LEGACY=$OPENJDK_BUILD_CPU_LEGACY
354   FLAGS_CPU_LEGACY_LIB=$OPENJDK_BUILD_CPU_LEGACY_LIB
355 
356   FLAGS_SETUP_CFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_], [BUILD_])
357 
358   CC=&quot;$CC_OLD&quot;
359   CXX=&quot;$CXX_OLD&quot;
360   CFLAGS=&quot;$CFLAGS_OLD&quot;
361   CXXFLAGS=&quot;$CXXFLAGS_OLD&quot;
362 ])
363 
364 ################################################################################
365 # platform independent
366 AC_DEFUN([FLAGS_SETUP_CFLAGS_HELPER],
367 [
368   #### OS DEFINES, these should be independent on toolchain
369   if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
370     CFLAGS_OS_DEF_JVM=&quot;-DLINUX&quot;
371     CFLAGS_OS_DEF_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE&quot;
372   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
373     CFLAGS_OS_DEF_JVM=&quot;-D_ALLBSD_SOURCE -D_DARWIN_C_SOURCE -D_XOPEN_SOURCE&quot;
374     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE -D_DARWIN_UNLIMITED_SELECT&quot;
375   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
376     CFLAGS_OS_DEF_JVM=&quot;-DAIX&quot;
377   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xbsd; then
378     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE&quot;
379   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then
380     CFLAGS_OS_DEF_JVM=&quot;-D_WINDOWS -DWIN32 -D_JNI_IMPLEMENTATION_&quot;
381   fi
382 
383   CFLAGS_OS_DEF_JDK=&quot;$CFLAGS_OS_DEF_JDK -D$OPENJDK_TARGET_OS_UPPERCASE&quot;
384 
385   #### GLOBAL DEFINES
386   # Set some common defines. These works for all compilers, but assume
387   # -D is universally accepted.
388 
389   # Always enable optional macros for VM.
390   ALWAYS_CFLAGS_JVM=&quot;-D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS&quot;
391 
392   # Setup some hard coded includes
393   ALWAYS_CFLAGS_JDK=&quot; \
394       -I\$(SUPPORT_OUTPUTDIR)/modules_include/java.base \
395       -I\$(SUPPORT_OUTPUTDIR)/modules_include/java.base/\$(OPENJDK_TARGET_OS_INCLUDE_SUBDIR) \
396       -I${TOPDIR}/src/java.base/share/native/libjava \
397       -I${TOPDIR}/src/java.base/$OPENJDK_TARGET_OS_TYPE/native/libjava \
398       -I${TOPDIR}/src/hotspot/share/include \
399       -I${TOPDIR}/src/hotspot/os/${HOTSPOT_TARGET_OS_TYPE}/include&quot;
400 
401   ###############################################################################
402 
403   # Adjust flags according to debug level.
404   # Setup debug/release defines
405   if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
406     DEBUG_CFLAGS_JDK=&quot;-DNDEBUG&quot;
407   else
408     DEBUG_CFLAGS_JDK=&quot;-DDEBUG&quot;
409 
410     if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
411       # We need &#39;-qminimaltoc&#39; or &#39;-qpic=large -bbigtoc&#39; if the TOC overflows.
412       # Hotspot now overflows its 64K TOC (currently only for debug),
413       # so for debug we build with &#39;-qpic=large -bbigtoc&#39;.
414       DEBUG_CFLAGS_JVM=&quot;-qpic=large&quot;
415     fi
416   fi
417 
418   if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
419     DEBUG_OPTIONS_FLAGS_JDK=&quot;$CFLAGS_DEBUG_OPTIONS&quot;
420     DEBUG_SYMBOLS_CFLAGS_JDK=&quot;$CFLAGS_DEBUG_SYMBOLS&quot;
421   fi
422 
423   #### TOOLCHAIN DEFINES
424 
425   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
426     ALWAYS_DEFINES_JVM=&quot;-D_GNU_SOURCE -D_REENTRANT&quot;
427   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
428     ALWAYS_DEFINES_JVM=&quot;-D_GNU_SOURCE&quot;
429   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
430     ALWAYS_DEFINES_JVM=&quot;-D_REENTRANT&quot;
431     ALWAYS_DEFINES_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE -DSTDC&quot;
432   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
433     ALWAYS_DEFINES_JDK=&quot;-DWIN32_LEAN_AND_MEAN -D_CRT_SECURE_NO_DEPRECATE \
434         -D_CRT_NONSTDC_NO_DEPRECATE -DWIN32 -DIAL&quot;
435     ALWAYS_DEFINES_JVM=&quot;-DNOMINMAX -DWIN32_LEAN_AND_MEAN&quot;
436   fi
437 
438   ###############################################################################
439   #
440   #
441   # CFLAGS BASIC
442   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
443     # COMMON to gcc and clang
444     TOOLCHAIN_CFLAGS_JVM=&quot;-pipe -fno-rtti -fno-exceptions \
445         -fvisibility=hidden -fno-strict-aliasing -fno-omit-frame-pointer&quot;
446   fi
447 
448   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
449     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -fcheck-new -fstack-protector&quot;
450     TOOLCHAIN_CFLAGS_JDK=&quot;-pipe -fstack-protector&quot;
451     # reduce lib size on linux in link step, this needs also special compile flags
452     # do this on s390x also for libjvm (where serviceability agent is not supported)
453     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
454       TOOLCHAIN_CFLAGS_JDK=&quot;$TOOLCHAIN_CFLAGS_JDK -ffunction-sections -fdata-sections&quot;
455       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
456         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -ffunction-sections -fdata-sections&quot;
457       fi
458     fi
459     # technically NOT for CXX (but since this gives *worse* performance, use
460     # no-strict-aliasing everywhere!)
461     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot;
462 
463   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
464     # Restrict the debug information created by Clang to avoid
465     # too big object files and speed the build up a little bit
466     # (see http://llvm.org/bugs/show_bug.cgi?id=7554)
467     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -flimit-debug-info&quot;
468 
469     # In principle the stack alignment below is cpu- and ABI-dependent and
470     # should agree with values of StackAlignmentInBytes in various
471     # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
472     # works for all platforms.
473     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
474 
475     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
476       if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
477         # Clang does not inline as much as GCC does for functions with &quot;inline&quot; keyword by default.
478         # This causes noticeable slowdown in pause time for G1, and possibly in other areas.
479         # Increasing the inline hint threshold avoids the slowdown for Clang-built JVM.
480         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mllvm -inlinehint-threshold=100000&quot;
481       fi
482       TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
483       TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
484     fi
485 
486   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
487     # Suggested additions: -qsrcmsg to get improved error reporting
488     # set -qtbtable=full for a better traceback table/better stacks in hs_err when xlc16 is used
489     TOOLCHAIN_CFLAGS_JDK=&quot;-qtbtable=full -qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS
490     TOOLCHAIN_CFLAGS_JVM=&quot;-qtbtable=full -qtune=balanced \
491         -qalias=noansi -qstrict -qtls=default -qnortti -qnoeh -qignerrno -qstackprotect&quot;
492   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
493     TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
494     TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
495   fi
496 
497   # CFLAGS C language level for JDK sources (hotspot only uses C++)
498   # Ideally we would have a common level across all toolchains so that all sources
499   # are sure to conform to the same standard. Unfortunately neither our sources nor
500   # our toolchains are in a condition to support that. But what we loosely aim for is
501   # C99 level.
502   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
503     # Explicitly set C99. clang and xlclang support the same flag.
504     LANGSTD_CFLAGS=&quot;-std=c99&quot;
505   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
506     # MSVC doesn&#39;t support C99/C11 explicitly, unless you compile as C++:
507     # LANGSTD_CFLAGS=&quot;-TP&quot;
508     # but that requires numerous changes to the sources files. So we are limited
509     # to C89/C90 plus whatever extensions Visual Studio has decided to implement.
510     # This is the lowest bar for shared code.
511     LANGSTD_CFLAGS=&quot;&quot;
512   fi
513   TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;$LANGSTD_CFLAGS $TOOLCHAIN_CFLAGS_JDK_CONLY&quot;
514 
515   # CXXFLAGS C++ language level for all of JDK, including Hotspot.
516   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
517     LANGSTD_CXXFLAGS=&quot;-std=c++14&quot;
518   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
519     LANGSTD_CXXFLAGS=&quot;-std:c++14&quot;
520   else
521     AC_MSG_ERROR([Don&#39;t know how to enable C++14 for this toolchain])
522   fi
523   TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;$TOOLCHAIN_CFLAGS_JDK_CXXONLY $LANGSTD_CXXFLAGS&quot;
524   TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM $LANGSTD_CXXFLAGS&quot;
525   ADLC_LANGSTD_CXXFLAGS=&quot;$LANGSTD_CXXFLAGS&quot;
526 
527   # CFLAGS WARNINGS STUFF
528   # Set JVM_CFLAGS warning handling
529   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
530     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
531     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
532     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
533 
534   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
535     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
536 
537   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
538     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
539 
540   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
541     WARNING_CFLAGS=&quot;&quot;  # currently left empty
542   fi
543 
544   # Set some additional per-OS defines.
545 
546   # Additional macosx handling
547   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
548     OS_CFLAGS=&quot;-DMAC_OS_X_VERSION_MIN_REQUIRED=$MACOSX_VERSION_MIN_NODOTS \
549         -mmacosx-version-min=$MACOSX_VERSION_MIN&quot;
550 
551     if test -n &quot;$MACOSX_VERSION_MAX&quot;; then
552         OS_CFLAGS=&quot;$OS_CFLAGS \
553             -DMAC_OS_X_VERSION_MAX_ALLOWED=$MACOSX_VERSION_MAX_NODOTS&quot;
554     fi
555   fi
556 
557   # Where does this really belong??
558   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
559     PICFLAG=&quot;-fPIC&quot;
560     PIEFLAG=&quot;-fPIE&quot;
561   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
562     # &#39;-qpic&#39; defaults to &#39;qpic=small&#39;. This means that the compiler generates only
563     # one instruction for accessing the TOC. If the TOC grows larger than 64K, the linker
564     # will have to patch this single instruction with a call to some out-of-order code which
565     # does the load from the TOC. This is of course slower, and we also would have
566     # to use &#39;-bbigtoc&#39; for linking anyway so we could also change the PICFLAG to &#39;qpic=large&#39;.
567     # With &#39;qpic=large&#39; the compiler will by default generate a two-instruction sequence which
568     # can be patched directly by the linker and does not require a jump to out-of-order code.
569     #
570     # Since large TOC causes perf. overhead, only pay it where we must. Currently this is
571     # for all libjvm variants (both gtest and normal) but no other binaries. So, build
572     # libjvm with -qpic=large and link with -bbigtoc.
573     JVM_PICFLAG=&quot;-qpic=large&quot;
574     JDK_PICFLAG=&quot;-qpic&quot;
575   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
576     PICFLAG=&quot;&quot;
577   fi
578 
579   if test &quot;x$TOOLCHAIN_TYPE&quot; != xxlc; then
580     JVM_PICFLAG=&quot;$PICFLAG&quot;
581     JDK_PICFLAG=&quot;$PICFLAG&quot;
582   fi
583 
584   if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
585     # Linking is different on MacOSX
586     JDK_PICFLAG=&#39;&#39;
587     if test &quot;x$STATIC_BUILD&quot; = xtrue; then
588       JVM_PICFLAG=&quot;&quot;
589     fi
590   fi
591 
592   # Optional POSIX functionality needed by the JVM
593   #
594   # Check if clock_gettime is available and in which library. This indicates
595   # availability of CLOCK_MONOTONIC for hotspot. But we don&#39;t need to link, so
596   # don&#39;t let it update LIBS.
597   save_LIBS=&quot;$LIBS&quot;
598   AC_SEARCH_LIBS(clock_gettime, rt, [HAS_CLOCK_GETTIME=true], [])
599   if test &quot;x$LIBS&quot; = &quot;x-lrt &quot;; then
600     CLOCK_GETTIME_IN_LIBRT=true
601   fi
602   LIBS=&quot;$save_LIBS&quot;
603 
604   if test &quot;x$HAS_CLOCK_GETTIME&quot; = &quot;xtrue&quot;; then
605     OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DSUPPORTS_CLOCK_MONOTONIC&quot;
606     if test &quot;x$CLOCK_GETTIME_IN_LIBRT&quot; = &quot;xtrue&quot;; then
607       OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DNEEDS_LIBRT&quot;
608     fi
609   fi
610 
611   # Extra flags needed when building optional static versions of certain
612   # JDK libraries.
613   STATIC_LIBS_CFLAGS=&quot;-DSTATIC_BUILD=1&quot;
614   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
615     STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS -ffunction-sections -fdata-sections \
616       -DJNIEXPORT=&#39;__attribute__((visibility(\&quot;hidden\&quot;)))&#39;&quot;
617   else
618     STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS -DJNIEXPORT=&quot;
619   fi
620   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
621     # Disable relax-relocation to enable compatibility with older linkers
622     RELAX_RELOCATIONS_FLAG=&quot;-Xassembler -mrelax-relocations=no&quot;
623     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${RELAX_RELOCATIONS_FLAG}],
624         IF_TRUE: [STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS ${RELAX_RELOCATIONS_FLAG}&quot;])
625   fi
626   AC_SUBST(STATIC_LIBS_CFLAGS)
627 ])
628 
629 ################################################################################
630 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
631 #      conditionals against.
632 # $2 - Optional prefix for each variable defined.
633 # $3 - Optional prefix for compiler variables (either BUILD_ or nothing).
634 AC_DEFUN([FLAGS_SETUP_CFLAGS_CPU_DEP],
635 [
636   #### CPU DEFINES, these should (in theory) be independent on toolchain
637 
638   # Setup target CPU
639   # Setup endianness
640   if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
641     $1_DEFINES_CPU_JVM=&quot;-DVM_LITTLE_ENDIAN&quot;
642     $1_DEFINES_CPU_JDK=&quot;-D_LITTLE_ENDIAN&quot;
643   else
644     $1_DEFINES_CPU_JDK=&quot;-D_BIG_ENDIAN&quot;
645   fi
646 
647   # setup CPU bit size
648   $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -DARCH=&#39;\&quot;$FLAGS_CPU_LEGACY\&quot;&#39; \
649       -D$FLAGS_CPU_LEGACY&quot;
650 
651   if test &quot;x$FLAGS_CPU_BITS&quot; = x64; then
652     # -D_LP64=1 is only set on linux and mac. Setting on windows causes diff in
653     # unpack200.exe.
654     if test &quot;x$FLAGS_OS&quot; = xlinux || test &quot;x$FLAGS_OS&quot; = xmacosx; then
655       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_LP64=1&quot;
656     fi
657     if test &quot;x$FLAGS_OS&quot; != xaix; then
658       # xlc on AIX defines _LP64=1 by default and issues a warning if we redefine it.
659       $1_DEFINES_CPU_JVM=&quot;${$1_DEFINES_CPU_JVM} -D_LP64=1&quot;
660     fi
661   fi
662 
663   # toolchain dependend, per-cpu
664   if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
665     if test &quot;x$FLAGS_CPU&quot; = xx86_64; then
666       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_AMD64_ -Damd64&quot;
667     else
668       $1_DEFINES_CPU_JDK=&quot;${$1_DEFINES_CPU_JDK} -D_X86_ -Dx86&quot;
669     fi
670   fi
671 
672   # CFLAGS PER CPU
673   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
674     # COMMON to gcc and clang
675     if test &quot;x$FLAGS_CPU&quot; = xx86; then
676       # Force compatibility with i586 on 32 bit intel platforms.
677       $1_CFLAGS_CPU=&quot;-march=i586&quot;
678     fi
679   fi
680 
681   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
682     if test &quot;x$FLAGS_CPU&quot; = xaarch64; then
683       # -Wno-psabi to get rid of annoying &quot;note: parameter passing for argument of type &#39;&lt;type&gt; changed in GCC 9.1&quot;
684       $1_CFLAGS_CPU=&quot;-Wno-psabi&quot;
685     elif test &quot;x$FLAGS_CPU&quot; = xarm; then
686       # -Wno-psabi to get rid of annoying &quot;note: the mangling of &#39;va_list&#39; has changed in GCC 4.4&quot;
687       $1_CFLAGS_CPU=&quot;-fsigned-char -Wno-psabi $ARM_ARCH_TYPE_FLAGS $ARM_FLOAT_TYPE_FLAGS -DJDK_ARCH_ABI_PROP_NAME=&#39;\&quot;\$(JDK_ARCH_ABI_PROP_NAME)\&quot;&#39;&quot;
688       $1_CFLAGS_CPU_JVM=&quot;-DARM&quot;
689     elif test &quot;x$FLAGS_CPU_ARCH&quot; = xppc; then
690       $1_CFLAGS_CPU_JVM=&quot;-minsert-sched-nops=regroup_exact -mno-multiple -mno-string&quot;
691       if test &quot;x$FLAGS_CPU&quot; = xppc64; then
692         # -mminimal-toc fixes `relocation truncated to fit&#39; error for gcc 4.1.
693         # Use ppc64 instructions, but schedule for power5
694         $1_CFLAGS_CPU_JVM=&quot;${$1_CFLAGS_CPU_JVM} -mminimal-toc -mcpu=powerpc64 -mtune=power5&quot;
695       elif test &quot;x$FLAGS_CPU&quot; = xppc64le; then
696         # Little endian machine uses ELFv2 ABI.
697         # Use Power8, this is the first CPU to support PPC64 LE with ELFv2 ABI.
698         $1_CFLAGS_CPU_JVM=&quot;${$1_CFLAGS_CPU_JVM} -DABI_ELFv2 -mcpu=power8 -mtune=power8&quot;
699       fi
700     elif test &quot;x$FLAGS_CPU&quot; = xs390x; then
701       $1_CFLAGS_CPU=&quot;-mbackchain -march=z10&quot;
702     fi
703 
704     if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
705       # for all archs except arm and ppc, prevent gcc to omit frame pointer
706       $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
707     fi
708 
709   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
710     if test &quot;x$FLAGS_OS&quot; = xlinux; then
711       # ppc test not really needed for clang
712       if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
713         # for all archs except arm and ppc, prevent gcc to omit frame pointer
714         $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
715       fi
716     fi
717 
718   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
719     if test &quot;x$FLAGS_CPU&quot; = xppc64; then
720       $1_CFLAGS_CPU_JVM=&quot;-qarch=ppc64&quot;
721     fi
722 
723   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
724     if test &quot;x$FLAGS_CPU&quot; = xx86; then
725       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
726     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
727       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
728         # NOTE: This is probably redundant; -homeparams is default on
729         # non-release builds.
730         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
731       fi
732     fi
733   fi
734 
735   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
736     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
737     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
738 
739     $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
740   fi
741 
742   # Prevent the __FILE__ macro from generating absolute paths into the built
743   # binaries. Depending on toolchain, different mitigations are possible.
744   # * GCC and Clang of new enough versions have -fmacro-prefix-map.
745   # * For most other toolchains, supplying all source files and -I flags as
746   #   relative paths fixes the issue.
747   FILE_MACRO_CFLAGS=
748   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then
749     if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
750       # Check if compiler supports -fmacro-prefix-map. If so, use that to make
751       # the __FILE__ macro resolve to paths relative to the workspace root.
752       workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;
753       FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;
754       FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],
755           PREFIX: $3,
756           IF_FALSE: [
757               FILE_MACRO_CFLAGS=
758           ]
759       )
760     fi
761   fi
762   AC_SUBST(FILE_MACRO_CFLAGS)
763 
764   # EXPORT to API
765   CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
766       $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
767       $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
768       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS&quot;
769 
770   CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
771       $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
772       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK \
773       $FILE_MACRO_CFLAGS&quot;
774 
775   # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
776   # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
777   # change in the future.)
778 
779   CFLAGS_JDK_COMMON_CONLY=&quot;$TOOLCHAIN_CFLAGS_JDK_CONLY  \
780       $WARNING_CFLAGS_JDK_CONLY ${$2EXTRA_CFLAGS}&quot;
781   CFLAGS_JDK_COMMON_CXXONLY=&quot;$ALWAYS_DEFINES_JDK_CXXONLY \
782       $TOOLCHAIN_CFLAGS_JDK_CXXONLY \
783       ${$1_TOOLCHAIN_CFLAGS_JDK_CXXONLY} \
784       $WARNING_CFLAGS_JDK_CXXONLY ${$2EXTRA_CXXFLAGS}&quot;
785 
786   $1_CFLAGS_JVM=&quot;${$1_DEFINES_CPU_JVM} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JVM} ${$1_TOOLCHAIN_CFLAGS} ${$1_WARNING_CFLAGS_JVM}&quot;
787   $1_CFLAGS_JDK=&quot;${$1_DEFINES_CPU_JDK} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JDK} ${$1_TOOLCHAIN_CFLAGS}&quot;
788 
789   $2JVM_CFLAGS=&quot;$CFLAGS_JVM_COMMON ${$1_CFLAGS_JVM} ${$2EXTRA_CXXFLAGS}&quot;
790 
791   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK} $PIEFLAG&quot;
792   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK} $PIEFLAG&quot;
793   $2CFLAGS_JDKLIB=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK} \
794       $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;
795   $2CXXFLAGS_JDKLIB=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK} \
796       $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;
797 
798   AC_SUBST($2JVM_CFLAGS)
799   AC_SUBST($2CFLAGS_JDKLIB)
800   AC_SUBST($2CFLAGS_JDKEXE)
801   AC_SUBST($2CXXFLAGS_JDKLIB)
802   AC_SUBST($2CXXFLAGS_JDKEXE)
803   AC_SUBST($2ADLC_LANGSTD_CXXFLAGS)
804 
805   COMPILER_FP_CONTRACT_OFF_FLAG=&quot;-ffp-contract=off&quot;
806   # Check that the compiler supports -ffp-contract=off flag
807   # Set FDLIBM_CFLAGS to -ffp-contract=off if it does. Empty
808   # otherwise.
809   # These flags are required for GCC-based builds of
810   # fdlibm with optimization without losing precision.
811   # Notably, -ffp-contract=off needs to be added for GCC &gt;= 4.6.
812   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
813     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${COMPILER_FP_CONTRACT_OFF_FLAG}],
814         PREFIX: $3,
815         IF_TRUE: [$2FDLIBM_CFLAGS=${COMPILER_FP_CONTRACT_OFF_FLAG}],
816         IF_FALSE: [$2FDLIBM_CFLAGS=&quot;&quot;])
817   fi
818   AC_SUBST($2FDLIBM_CFLAGS)
819 ])
820 
821 # FLAGS_SETUP_GCC6_COMPILER_FLAGS([PREFIX])
822 # Arguments:
823 # $1 - Prefix for each variable defined.
824 # $2 - Prefix for compiler variables (either BUILD_ or nothing).
825 AC_DEFUN([FLAGS_SETUP_GCC6_COMPILER_FLAGS],
826 [
827   # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
828   # runs afoul of the more aggressive versions of these optimisations.
829   # Notably, value range propagation now assumes that the this pointer of C++
830   # member functions is non-null.
831   NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
832   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG],
833       PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
834   NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
835   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG],
836       PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
837   $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
838 ])
    </pre>
  </body>
</html>