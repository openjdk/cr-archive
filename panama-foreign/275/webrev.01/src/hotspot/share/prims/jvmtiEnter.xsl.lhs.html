<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/hotspot/share/prims/jvmtiEnter.xsl</title>
    <link rel="stylesheet" href="../../../../style.css" />
    <script type="text/javascript" src="../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 &lt;?xml version=&quot;1.0&quot;?&gt; 
   2 &lt;!--
<a name="1" id="anc1"></a><span class="line-modified">   3  Copyright (c) 2002, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   4  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   5 
   6  This code is free software; you can redistribute it and/or modify it
   7  under the terms of the GNU General Public License version 2 only, as
   8  published by the Free Software Foundation.
   9 
  10  This code is distributed in the hope that it will be useful, but WITHOUT
  11  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  12  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  13  version 2 for more details (a copy is included in the LICENSE file that
  14  accompanied this code).
  15 
  16  You should have received a copy of the GNU General Public License version
  17  2 along with this work; if not, write to the Free Software Foundation,
  18  Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  19 
  20  Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  21  or visit www.oracle.com if you need additional information or have any
  22  questions.
  23   
  24 --&gt;
  25 
  26 &lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; version=&quot;1.0&quot;&gt;
  27 
  28 &lt;xsl:import href=&quot;jvmtiLib.xsl&quot;/&gt;
  29 
  30 &lt;xsl:output method=&quot;text&quot; indent=&quot;no&quot; omit-xml-declaration=&quot;yes&quot;/&gt;
  31 
  32 &lt;xsl:param name=&quot;trace&quot;&gt;&lt;/xsl:param&gt;
  33 &lt;xsl:param name=&quot;interface&quot;&gt;&lt;/xsl:param&gt;
  34 
  35 
  36 &lt;xsl:template match=&quot;specification&quot;&gt;
  37   &lt;xsl:call-template name=&quot;sourceHeader&quot;/&gt;
  38   &lt;xsl:text&gt;
  39 # include &quot;precompiled.hpp&quot;
  40 # include &quot;classfile/javaClasses.inline.hpp&quot;
  41 # include &quot;memory/resourceArea.hpp&quot;
  42 # include &quot;utilities/macros.hpp&quot;
  43 #if INCLUDE_JVMTI
  44 # include &quot;logging/log.hpp&quot;
  45 # include &quot;oops/oop.inline.hpp&quot;
  46 # include &quot;prims/jvmtiEnter.inline.hpp&quot;
  47 # include &quot;prims/jvmtiRawMonitor.hpp&quot;
  48 # include &quot;prims/jvmtiUtil.hpp&quot;
  49 # include &quot;runtime/fieldDescriptor.inline.hpp&quot;
  50 # include &quot;runtime/threadSMR.hpp&quot;
  51 
  52 &lt;/xsl:text&gt;
  53 
  54   &lt;xsl:if test=&quot;$trace = &#39;Trace&#39;&quot;&gt;
  55    &lt;xsl:text&gt;
  56 #ifdef JVMTI_TRACE
  57 &lt;/xsl:text&gt;
  58   &lt;/xsl:if&gt;
  59 
  60  &lt;xsl:if test=&quot;$trace != &#39;Trace&#39;&quot;&gt;
  61     &lt;xsl:text&gt;
  62 
  63 // Error names
  64 const char* JvmtiUtil::_error_names[] = {
  65 &lt;/xsl:text&gt;
  66     &lt;xsl:call-template name=&quot;fillEntityName&quot;&gt; 
  67       &lt;xsl:with-param name=&quot;entities&quot; select=&quot;errorsection/errorcategory/errorid&quot;/&gt;
  68     &lt;/xsl:call-template&gt;
  69     &lt;xsl:text&gt;
  70 };
  71 
  72 
  73 // Event threaded
  74 const bool JvmtiUtil::_event_threaded[] = {
  75 &lt;/xsl:text&gt;
  76     &lt;xsl:call-template name=&quot;fillEventThreaded&quot;&gt; 
  77       &lt;xsl:with-param name=&quot;entities&quot; select=&quot;eventsection/event&quot;/&gt;
  78     &lt;/xsl:call-template&gt;
  79     &lt;xsl:text&gt;
  80 };
  81 
  82 &lt;/xsl:text&gt;
  83     &lt;xsl:call-template name=&quot;eventCapabilitiesTest&quot;/&gt;
  84  &lt;/xsl:if&gt;
  85 
  86  &lt;xsl:if test=&quot;$trace = &#39;Trace&#39;&quot;&gt;
  87 
  88 &lt;!--  all this just to return the highest event number --&gt;
  89   &lt;xsl:variable name=&quot;maxEvent&quot;&gt;
  90     &lt;xsl:for-each select=&quot;eventsection/event&quot;&gt;
  91       &lt;xsl:variable name=&quot;mynum&quot; select=&quot;@num&quot;/&gt;
  92       &lt;xsl:if test=&quot;count(../../eventsection/event[@num &amp;gt; $mynum]) = 0&quot;&gt;
  93         &lt;xsl:value-of select=&quot;@num&quot;/&gt;
  94       &lt;/xsl:if&gt;
  95     &lt;/xsl:for-each&gt;    
  96   &lt;/xsl:variable&gt;
  97 
  98   &lt;xsl:text&gt;jbyte JvmtiTrace::_event_trace_flags[&lt;/xsl:text&gt;
  99   &lt;xsl:value-of select=&quot;1+$maxEvent&quot;/&gt;
 100   &lt;xsl:text&gt;];
 101 
 102 jint JvmtiTrace::_max_event_index = &lt;/xsl:text&gt;
 103   &lt;xsl:value-of select=&quot;$maxEvent&quot;/&gt;
 104   &lt;xsl:text&gt;;
 105 
 106 // Event names
 107 const char* JvmtiTrace::_event_names[] = {
 108 &lt;/xsl:text&gt;
 109     &lt;xsl:call-template name=&quot;fillEntityName&quot;&gt; 
 110       &lt;xsl:with-param name=&quot;entities&quot; select=&quot;eventsection/event&quot;/&gt;
 111     &lt;/xsl:call-template&gt;
 112     &lt;xsl:text&gt;
 113 };
 114 &lt;/xsl:text&gt;
 115     &lt;xsl:apply-templates select=&quot;//constants[@kind=&#39;enum&#39;]&quot;/&gt;
 116   &lt;/xsl:if&gt;
 117   &lt;xsl:apply-templates select=&quot;functionsection&quot;/&gt;
 118 
 119   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 120    &lt;xsl:text&gt;
 121 #endif /*JVMTI_TRACE */
 122 &lt;/xsl:text&gt;
 123   &lt;/xsl:if&gt;
 124 
 125 &lt;/xsl:template&gt;
 126 
 127 &lt;xsl:template match=&quot;constants&quot;&gt;
 128   &lt;xsl:text&gt;
 129 
 130 // &lt;/xsl:text&gt;
 131   &lt;xsl:value-of select=&quot;@label&quot;/&gt;
 132   &lt;xsl:text&gt; names
 133 const char* &lt;/xsl:text&gt;
 134   &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 135   &lt;xsl:text&gt;ConstantNames[] = {
 136 &lt;/xsl:text&gt;
 137   &lt;xsl:apply-templates select=&quot;constant&quot; mode=&quot;constname&quot;/&gt;
 138   &lt;xsl:text&gt;  NULL
 139 };
 140 
 141 // &lt;/xsl:text&gt;
 142   &lt;xsl:value-of select=&quot;@label&quot;/&gt;
 143   &lt;xsl:text&gt; value
 144 jint &lt;/xsl:text&gt;
 145   &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 146   &lt;xsl:text&gt;ConstantValues[] = {
 147 &lt;/xsl:text&gt;
 148   &lt;xsl:apply-templates select=&quot;constant&quot; mode=&quot;constvalue&quot;/&gt;
 149   &lt;xsl:text&gt;  0
 150 };
 151 
 152 &lt;/xsl:text&gt;
 153 &lt;/xsl:template&gt;
 154 
 155 &lt;xsl:template match=&quot;constant&quot; mode=&quot;constname&quot;&gt;
 156   &lt;xsl:text&gt;  &quot;&lt;/xsl:text&gt;
 157   &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 158   &lt;xsl:text&gt;&quot;,
 159 &lt;/xsl:text&gt;
 160 &lt;/xsl:template&gt;
 161 
 162 &lt;xsl:template match=&quot;constant&quot; mode=&quot;constvalue&quot;&gt;
 163   &lt;xsl:text&gt;  &lt;/xsl:text&gt;
 164   &lt;xsl:value-of select=&quot;@num&quot;/&gt;
 165   &lt;xsl:text&gt;,
 166 &lt;/xsl:text&gt;
 167 &lt;/xsl:template&gt;
 168 
 169 &lt;xsl:template name=&quot;eventCapabilitiesTest&quot;&gt;
 170   &lt;xsl:text&gt;
 171 
 172 // Check Event Capabilities
 173 const bool JvmtiUtil::has_event_capability(jvmtiEvent event_type, const jvmtiCapabilities* capabilities_ptr) {
 174   switch (event_type) {
 175 &lt;/xsl:text&gt;
 176   &lt;xsl:for-each select=&quot;//eventsection/event&quot;&gt;
 177     &lt;xsl:variable name=&quot;capa&quot; select=&quot;capabilities/required&quot;/&gt;
 178     &lt;xsl:if test=&quot;count($capa)&quot;&gt;
 179         &lt;xsl:text&gt;    case &lt;/xsl:text&gt;
 180         &lt;xsl:value-of select=&quot;@const&quot;/&gt;
 181         &lt;xsl:text&gt;:
 182       return capabilities_ptr-&amp;gt;&lt;/xsl:text&gt;
 183         &lt;xsl:value-of select=&quot;$capa/@id&quot;/&gt;
 184         &lt;xsl:text&gt; != 0;
 185 &lt;/xsl:text&gt;
 186     &lt;/xsl:if&gt;
 187   &lt;/xsl:for-each&gt;
 188   &lt;xsl:text&gt;  default: break; }
 189   // if it does not have a capability it is required
 190   return JNI_TRUE;
 191 }
 192 
 193 &lt;/xsl:text&gt;
 194 &lt;/xsl:template&gt;
 195 
 196 &lt;xsl:template match=&quot;functionsection&quot;&gt;
 197   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 198 
 199 &lt;!--  all this just to return the highest function number --&gt;
 200   &lt;xsl:variable name=&quot;maxFunction&quot;&gt;
 201     &lt;xsl:for-each select=&quot;category/function&quot;&gt;
 202       &lt;xsl:variable name=&quot;mynum&quot; select=&quot;@num&quot;/&gt;
 203       &lt;xsl:if test=&quot;count(../../category/function[@num &amp;gt; $mynum]) = 0&quot;&gt;
 204         &lt;xsl:value-of select=&quot;@num&quot;/&gt;
 205       &lt;/xsl:if&gt;
 206     &lt;/xsl:for-each&gt;    
 207   &lt;/xsl:variable&gt;
 208 
 209   &lt;xsl:text&gt;jbyte JvmtiTrace::_trace_flags[&lt;/xsl:text&gt;
 210   &lt;xsl:value-of select=&quot;1+$maxFunction&quot;/&gt;
 211   &lt;xsl:text&gt;];
 212 
 213 jint JvmtiTrace::_max_function_index = &lt;/xsl:text&gt;
 214   &lt;xsl:value-of select=&quot;$maxFunction&quot;/&gt;
 215   &lt;xsl:text&gt;;
 216 
 217 // Function names
 218 const char* JvmtiTrace::_function_names[] = {
 219 &lt;/xsl:text&gt;
 220   &lt;xsl:call-template name=&quot;fillEntityName&quot;&gt;
 221     &lt;xsl:with-param name=&quot;entities&quot; select=&quot;category/function&quot;/&gt;
 222   &lt;/xsl:call-template&gt;
 223   &lt;xsl:text&gt;
 224 };
 225 
 226 // Exclude list
 227 short JvmtiTrace::_exclude_functions[] = {
 228   &lt;/xsl:text&gt;
 229   &lt;xsl:apply-templates select=&quot;category/function&quot; mode=&quot;notrace&quot;&gt;
 230     &lt;xsl:sort select=&quot;@num&quot;/&gt;
 231   &lt;/xsl:apply-templates&gt;
 232   &lt;xsl:text&gt;0
 233 };
 234 
 235 &lt;/xsl:text&gt;
 236   &lt;/xsl:if&gt;
 237 
 238   &lt;xsl:text&gt;
 239 extern &quot;C&quot; {
 240 
 241 &lt;/xsl:text&gt;
 242   &lt;xsl:apply-templates select=&quot;category&quot; mode=&quot;wrapper&quot;/&gt;
 243   &lt;xsl:text&gt;
 244 } /* end extern &quot;C&quot; */
 245 
 246 // JVMTI API functions
 247 struct jvmtiInterface_1_ jvmti&lt;/xsl:text&gt;
 248   &lt;xsl:value-of select=&quot;$trace&quot;/&gt;
 249   &lt;xsl:text&gt;_Interface = {
 250 &lt;/xsl:text&gt;
 251  
 252   &lt;xsl:call-template name=&quot;fillFuncStruct&quot;&gt;
 253     &lt;xsl:with-param name=&quot;funcs&quot; select=&quot;category/function[count(@hide)=0]&quot;/&gt;
 254   &lt;/xsl:call-template&gt;
 255 
 256   &lt;xsl:text&gt;
 257 };
 258 #endif // INCLUDE_JVMTI
 259 &lt;/xsl:text&gt;
 260 &lt;/xsl:template&gt;
 261 
 262 &lt;xsl:template match=&quot;function&quot; mode=&quot;functionid&quot;&gt;
 263   &lt;xsl:text&gt;jvmti&lt;/xsl:text&gt;
 264   &lt;xsl:value-of select=&quot;$trace&quot;/&gt;
 265   &lt;xsl:text&gt;_&lt;/xsl:text&gt;
 266   &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 267 &lt;/xsl:template&gt;
 268 
 269 &lt;xsl:template name=&quot;fillFuncStructDoit&quot;&gt;
 270   &lt;xsl:param name=&quot;func&quot;/&gt;
 271   &lt;xsl:param name=&quot;index&quot;/&gt;
 272   &lt;xsl:text&gt;                              /* &lt;/xsl:text&gt;
 273   &lt;xsl:number value=&quot;$index&quot; format=&quot;  1&quot;/&gt;
 274   &lt;xsl:text&gt; : &lt;/xsl:text&gt;
 275   &lt;xsl:choose&gt;
 276     &lt;xsl:when test=&quot;count($func)=1&quot;&gt;
 277       &lt;xsl:value-of select=&quot;$func/synopsis&quot;/&gt;
 278       &lt;xsl:text&gt; */
 279       &lt;/xsl:text&gt;
 280       &lt;xsl:apply-templates select=&quot;$func&quot; mode=&quot;functionid&quot;/&gt;
 281     &lt;/xsl:when&gt;
 282     &lt;xsl:otherwise&gt;
 283       &lt;xsl:text&gt; RESERVED */
 284       NULL&lt;/xsl:text&gt;        
 285     &lt;/xsl:otherwise&gt;
 286   &lt;/xsl:choose&gt;
 287 &lt;/xsl:template&gt;
 288 
 289 &lt;!-- generic function iterator applied to the function structure --&gt;
 290 &lt;xsl:template name=&quot;fillFuncStruct&quot;&gt;
 291   &lt;xsl:param name=&quot;funcs&quot;/&gt;
 292   &lt;xsl:param name=&quot;index&quot; select=&quot;1&quot;/&gt;
 293   &lt;xsl:call-template name=&quot;fillFuncStructDoit&quot;&gt;
 294     &lt;xsl:with-param name=&quot;func&quot; select=&quot;$funcs[@num=$index]&quot;/&gt;
 295     &lt;xsl:with-param name=&quot;index&quot; select=&quot;$index&quot;/&gt;
 296   &lt;/xsl:call-template&gt;
 297   &lt;xsl:if test=&quot;count($funcs[@num &amp;gt; $index]) &amp;gt; 0&quot;&gt;
 298     &lt;xsl:text&gt;,
 299 &lt;/xsl:text&gt;
 300     &lt;xsl:call-template name=&quot;fillFuncStruct&quot;&gt;
 301       &lt;xsl:with-param name=&quot;funcs&quot; select=&quot;$funcs&quot;/&gt;
 302       &lt;xsl:with-param name=&quot;index&quot; select=&quot;1+$index&quot;/&gt;
 303     &lt;/xsl:call-template&gt;
 304   &lt;/xsl:if&gt;
 305 &lt;/xsl:template&gt;
 306 
 307 &lt;xsl:template name=&quot;fillEntityNameDoit&quot;&gt;
 308   &lt;xsl:param name=&quot;entity&quot;/&gt;
 309   &lt;xsl:param name=&quot;index&quot;/&gt;
 310   &lt;xsl:choose&gt;
 311     &lt;xsl:when test=&quot;count($entity) &amp;gt; 0&quot;&gt;
 312       &lt;xsl:text&gt;  &quot;&lt;/xsl:text&gt;
 313       &lt;xsl:value-of select=&quot;$entity[position()=1]/@id&quot;/&gt;
 314       &lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;
 315     &lt;/xsl:when&gt;
 316     &lt;xsl:otherwise&gt;
 317       &lt;xsl:text&gt;  NULL&lt;/xsl:text&gt;        
 318     &lt;/xsl:otherwise&gt;
 319   &lt;/xsl:choose&gt;
 320 &lt;/xsl:template&gt;
 321 
 322 &lt;!-- generic entity (with id and num) iterator applied to entity names --&gt;
 323 &lt;xsl:template name=&quot;fillEntityName&quot;&gt;
 324   &lt;xsl:param name=&quot;entities&quot;/&gt;
 325   &lt;xsl:param name=&quot;index&quot; select=&quot;0&quot;/&gt;
 326   &lt;xsl:call-template name=&quot;fillEntityNameDoit&quot;&gt;
 327     &lt;xsl:with-param name=&quot;entity&quot; select=&quot;$entities[@num=$index]&quot;/&gt;
 328     &lt;xsl:with-param name=&quot;index&quot; select=&quot;$index&quot;/&gt;
 329   &lt;/xsl:call-template&gt;
 330   &lt;xsl:if test=&quot;count($entities[@num &amp;gt; $index]) &amp;gt; 0&quot;&gt;
 331     &lt;xsl:text&gt;,
 332 &lt;/xsl:text&gt;
 333     &lt;xsl:call-template name=&quot;fillEntityName&quot;&gt;
 334       &lt;xsl:with-param name=&quot;entities&quot; select=&quot;$entities&quot;/&gt;
 335       &lt;xsl:with-param name=&quot;index&quot; select=&quot;1+$index&quot;/&gt;
 336     &lt;/xsl:call-template&gt;
 337   &lt;/xsl:if&gt;
 338 &lt;/xsl:template&gt;
 339 
 340 &lt;xsl:template name=&quot;fillEventThreadedDoit&quot;&gt;
 341   &lt;xsl:param name=&quot;entity&quot;/&gt;
 342   &lt;xsl:param name=&quot;index&quot;/&gt;
 343   &lt;xsl:choose&gt;
 344     &lt;xsl:when test=&quot;count($entity) &amp;gt; 0&quot;&gt;
 345       &lt;xsl:choose&gt;
 346         &lt;xsl:when test=&quot;count($entity[position()=1]/@filtered)=0&quot;&gt;
 347           &lt;xsl:text&gt;  false&lt;/xsl:text&gt;
 348         &lt;/xsl:when&gt;
 349         &lt;xsl:otherwise&gt;
 350           &lt;xsl:text&gt;  true&lt;/xsl:text&gt;        
 351         &lt;/xsl:otherwise&gt;
 352       &lt;/xsl:choose&gt;
 353     &lt;/xsl:when&gt;
 354     &lt;xsl:otherwise&gt;
 355       &lt;xsl:text&gt;  false&lt;/xsl:text&gt;        
 356     &lt;/xsl:otherwise&gt;
 357   &lt;/xsl:choose&gt;
 358 &lt;/xsl:template&gt;
 359 
 360 
 361 &lt;xsl:template name=&quot;fillEventThreaded&quot;&gt;
 362   &lt;xsl:param name=&quot;entities&quot;/&gt;
 363   &lt;xsl:param name=&quot;index&quot; select=&quot;0&quot;/&gt;
 364   &lt;xsl:call-template name=&quot;fillEventThreadedDoit&quot;&gt;
 365     &lt;xsl:with-param name=&quot;entity&quot; select=&quot;$entities[@num=$index]&quot;/&gt;
 366     &lt;xsl:with-param name=&quot;index&quot; select=&quot;$index&quot;/&gt;
 367   &lt;/xsl:call-template&gt;
 368   &lt;xsl:if test=&quot;count($entities[@num &amp;gt; $index]) &amp;gt; 0&quot;&gt;
 369     &lt;xsl:text&gt;,
 370 &lt;/xsl:text&gt;
 371     &lt;xsl:call-template name=&quot;fillEventThreaded&quot;&gt;
 372       &lt;xsl:with-param name=&quot;entities&quot; select=&quot;$entities&quot;/&gt;
 373       &lt;xsl:with-param name=&quot;index&quot; select=&quot;1+$index&quot;/&gt;
 374     &lt;/xsl:call-template&gt;
 375   &lt;/xsl:if&gt;
 376 &lt;/xsl:template&gt;
 377 
 378 &lt;xsl:template match=&quot;function&quot; mode=&quot;notrace&quot;&gt;
 379   &lt;xsl:if test=&quot;count(@impl)=1 and contains(@impl,&#39;notrace&#39;)&quot;&gt;
 380     &lt;xsl:value-of select=&quot;@num&quot;/&gt;
 381     &lt;xsl:text&gt;,
 382   &lt;/xsl:text&gt;
 383   &lt;/xsl:if&gt;
 384 &lt;/xsl:template&gt;
 385 
 386 &lt;xsl:template match=&quot;category&quot; mode=&quot;wrapper&quot;&gt;
 387   &lt;xsl:text&gt;
 388   //
 389   // &lt;/xsl:text&gt;&lt;xsl:value-of select=&quot;@label&quot;/&gt;&lt;xsl:text&gt; functions
 390   // 
 391 &lt;/xsl:text&gt;
 392   &lt;xsl:apply-templates select=&quot;function[count(@hide)=0]&quot;/&gt;
 393 &lt;/xsl:template&gt;
 394 
 395 &lt;xsl:template match=&quot;function&quot; mode=&quot;transition&quot;&gt;
 396   &lt;xsl:param name=&quot;space&quot;&gt;
 397     &lt;xsl:text&gt;
 398   &lt;/xsl:text&gt;
 399   &lt;/xsl:param&gt;
 400   &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 401   
 402   &lt;xsl:choose&gt; 
 403     &lt;xsl:when test=&quot;count(@callbacksafe)=0 or not(contains(@callbacksafe,&#39;safe&#39;))&quot;&gt;
 404       &lt;xsl:text&gt;if (this_thread == NULL || !this_thread-&gt;is_Java_thread()) {&lt;/xsl:text&gt; 
 405     &lt;/xsl:when&gt; 
 406     &lt;xsl:otherwise&gt; 
 407       &lt;xsl:choose&gt;
 408         &lt;xsl:when test=&quot;count(@phase)=0 or contains(@phase,&#39;live&#39;) or contains(@phase,&#39;start&#39;)&quot;&gt;
 409 	  &lt;xsl:text&gt;if (this_thread == NULL || (!this_thread-&gt;is_Java_thread() &amp;amp;&amp;amp; !this_thread-&gt;is_Named_thread())) {&lt;/xsl:text&gt;
 410         &lt;/xsl:when&gt;
 411         &lt;xsl:otherwise&gt;
 412           &lt;xsl:text&gt;if (!this_thread-&gt;is_Java_thread()) {&lt;/xsl:text&gt; 
 413         &lt;/xsl:otherwise&gt;
 414       &lt;/xsl:choose&gt;
 415      &lt;/xsl:otherwise&gt; 
 416   &lt;/xsl:choose&gt; 
 417   
 418   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 419     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 420     &lt;xsl:text&gt;  if (trace_flags) {&lt;/xsl:text&gt;
 421     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 422     &lt;xsl:text&gt;    log_trace(jvmti)(&quot;[non-attached thread] %s %s&quot;,  func_name,&lt;/xsl:text&gt;
 423     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 424     &lt;xsl:text&gt;    JvmtiUtil::error_name(JVMTI_ERROR_UNATTACHED_THREAD));&lt;/xsl:text&gt;
 425     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 426     &lt;xsl:text&gt;  }&lt;/xsl:text&gt;
 427   &lt;/xsl:if&gt;
 428   &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 429   &lt;xsl:text&gt;  return JVMTI_ERROR_UNATTACHED_THREAD;&lt;/xsl:text&gt;
 430   &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 431   &lt;xsl:text&gt;}&lt;/xsl:text&gt;  
 432   &lt;xsl:value-of select=&quot;$space&quot;/&gt;  
 433   &lt;xsl:if test=&quot;count(@impl)=0 or not(contains(@impl,&#39;innative&#39;))&quot;&gt;
 434     &lt;xsl:text&gt;JavaThread* current_thread = (JavaThread*)this_thread;&lt;/xsl:text&gt;   
 435     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 436     &lt;xsl:text&gt;ThreadInVMfromNative __tiv(current_thread);&lt;/xsl:text&gt;
 437     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 438     &lt;xsl:text&gt;VM_ENTRY_BASE(jvmtiError, &lt;/xsl:text&gt;
 439     &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;functionid&quot;/&gt;
 440     &lt;xsl:text&gt; , current_thread)&lt;/xsl:text&gt;
 441     &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 442     &lt;xsl:text&gt;debug_only(VMNativeEntryWrapper __vew;)&lt;/xsl:text&gt;
 443     &lt;xsl:if test=&quot;count(@callbacksafe)=0 or not(contains(@callbacksafe,&#39;safe&#39;))&quot;&gt;
 444       &lt;xsl:value-of select=&quot;$space&quot;/&gt;
 445       &lt;xsl:text&gt;CautiouslyPreserveExceptionMark __em(this_thread);&lt;/xsl:text&gt;
 446     &lt;/xsl:if&gt;
 447   &lt;/xsl:if&gt;
 448 &lt;/xsl:template&gt;
 449 
 450 
 451 &lt;xsl:template match=&quot;required&quot;&gt;
 452   &lt;xsl:text&gt;
 453   if (jvmti_env-&amp;gt;get_capabilities()-&amp;gt;&lt;/xsl:text&gt;
 454     &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 455     &lt;xsl:text&gt; == 0) {
 456 &lt;/xsl:text&gt;
 457     &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 458       &lt;xsl:text&gt;    if (trace_flags) {
 459           log_trace(jvmti)(&quot;[%s] %s %s&quot;,  curr_thread_name, func_name, 
 460                     JvmtiUtil::error_name(JVMTI_ERROR_MUST_POSSESS_CAPABILITY));
 461     }
 462 &lt;/xsl:text&gt;
 463     &lt;/xsl:if&gt;
 464     &lt;xsl:text&gt;    return JVMTI_ERROR_MUST_POSSESS_CAPABILITY;
 465   }
 466 &lt;/xsl:text&gt;
 467 &lt;/xsl:template&gt;
 468 
 469 
 470 &lt;xsl:template match=&quot;function&quot;&gt;
 471   &lt;xsl:text&gt;
 472 static jvmtiError JNICALL
 473 &lt;/xsl:text&gt;
 474   &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;functionid&quot;/&gt;
 475   &lt;xsl:text&gt;(jvmtiEnv* env&lt;/xsl:text&gt;
 476   &lt;xsl:apply-templates select=&quot;parameters&quot; mode=&quot;signature&quot;/&gt;
 477   &lt;xsl:text&gt;) {
 478 &lt;/xsl:text&gt;
 479 
 480   &lt;xsl:if test=&quot;not(contains(@jkernel,&#39;yes&#39;))&quot;&gt;
 481   &lt;xsl:text&gt;&amp;#xA;#if !INCLUDE_JVMTI &amp;#xA;&lt;/xsl:text&gt;
 482   &lt;xsl:text&gt;  return JVMTI_ERROR_NOT_AVAILABLE; &amp;#xA;&lt;/xsl:text&gt;
 483   &lt;xsl:text&gt;#else &amp;#xA;&lt;/xsl:text&gt;
 484   &lt;/xsl:if&gt;
 485 
 486   &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;traceSetUp&quot;/&gt;
 487   &lt;xsl:choose&gt;
 488     &lt;xsl:when test=&quot;count(@phase)=0 or contains(@phase,&#39;live&#39;)&quot;&gt;
 489       &lt;xsl:text&gt;  if(!JvmtiEnv::is_vm_live()) {
 490 &lt;/xsl:text&gt;
 491     &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 492       &lt;xsl:text&gt;    if (trace_flags) {
 493           log_trace(jvmti)(&quot;[-] %s %s(%d)&quot;, func_name,
 494                     JvmtiUtil::error_name(JVMTI_ERROR_WRONG_PHASE), JvmtiEnv::get_phase());
 495     }
 496 &lt;/xsl:text&gt;
 497     &lt;/xsl:if&gt;
 498     &lt;xsl:text&gt;    return JVMTI_ERROR_WRONG_PHASE;
 499   }&lt;/xsl:text&gt;  
 500 
 501       &lt;xsl:text&gt;  
 502   Thread* this_thread = Thread::current_or_null(); &lt;/xsl:text&gt;
 503 
 504       &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;transition&quot;/&gt;
 505     &lt;/xsl:when&gt;
 506     &lt;xsl:otherwise&gt;
 507       &lt;xsl:if test=&quot;contains(@phase,&#39;onload&#39;)&quot;&gt;
 508         &lt;xsl:text&gt;  if(JvmtiEnv::get_phase()!=JVMTI_PHASE_ONLOAD&lt;/xsl:text&gt;
 509         &lt;xsl:if test=&quot;not(contains(@phase,&#39;onloadOnly&#39;))&quot;&gt;
 510           &lt;xsl:text&gt; &amp;amp;&amp;amp; JvmtiEnv::get_phase()!=JVMTI_PHASE_LIVE&lt;/xsl:text&gt;
 511         &lt;/xsl:if&gt;
 512         &lt;xsl:text&gt;) {
 513 &lt;/xsl:text&gt;
 514     &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 515       &lt;xsl:text&gt;    if (trace_flags) {
 516           log_trace(jvmti)(&quot;[-] %s %s&quot;,  func_name, 
 517                     JvmtiUtil::error_name(JVMTI_ERROR_WRONG_PHASE));
 518     }
 519 &lt;/xsl:text&gt;
 520     &lt;/xsl:if&gt;
 521     &lt;xsl:text&gt;    return JVMTI_ERROR_WRONG_PHASE;
 522   }&lt;/xsl:text&gt;
 523       &lt;/xsl:if&gt;
 524       &lt;xsl:if test=&quot;contains(@phase,&#39;start&#39;)&quot;&gt;
 525         &lt;xsl:text&gt;  if(JvmtiEnv::get_phase(env)!=JVMTI_PHASE_START &amp;amp;&amp;amp; JvmtiEnv::get_phase()!=JVMTI_PHASE_LIVE) {
 526 &lt;/xsl:text&gt;
 527     &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 528       &lt;xsl:text&gt;    if (trace_flags) {
 529           log_trace(jvmti)(&quot;[-] %s %s&quot;,  func_name, 
 530                     JvmtiUtil::error_name(JVMTI_ERROR_WRONG_PHASE));
 531     }
 532 &lt;/xsl:text&gt;
 533     &lt;/xsl:if&gt;
 534     &lt;xsl:text&gt;    return JVMTI_ERROR_WRONG_PHASE;
 535   }
 536   Thread* this_thread = Thread::current_or_null(); &lt;/xsl:text&gt;
 537       &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;transition&quot;/&gt;
 538       &lt;/xsl:if&gt;
 539     &lt;/xsl:otherwise&gt;
 540   &lt;/xsl:choose&gt;
 541 
 542   &lt;xsl:text&gt;
 543   JvmtiEnv* jvmti_env = JvmtiEnv::JvmtiEnv_from_jvmti_env(env);
 544   if (!jvmti_env-&gt;is_valid()) {
 545 &lt;/xsl:text&gt;
 546     &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 547       &lt;xsl:text&gt;    if (trace_flags) {
 548           log_trace(jvmti)(&quot;[%s] %s %s  env=&quot; PTR_FORMAT,  curr_thread_name, func_name, 
 549                     JvmtiUtil::error_name(JVMTI_ERROR_INVALID_ENVIRONMENT), p2i(env));
 550     }
 551 &lt;/xsl:text&gt;
 552     &lt;/xsl:if&gt;
 553     &lt;xsl:text&gt;    return JVMTI_ERROR_INVALID_ENVIRONMENT;
 554   }
 555 &lt;/xsl:text&gt;
 556 
 557   &lt;xsl:apply-templates select=&quot;capabilities/required&quot;/&gt;
 558   
 559   &lt;xsl:text&gt;  jvmtiError err;
 560 &lt;/xsl:text&gt;
 561   &lt;xsl:choose&gt;
 562     &lt;xsl:when test=&quot;count(@phase)=1 and not(contains(@phase,&#39;live&#39;)) and not(contains(@phase,&#39;start&#39;))&quot;&gt;    
 563       &lt;xsl:choose&gt;
 564         &lt;xsl:when test=&quot;count(@callbacksafe)=0 or not(contains(@callbacksafe,&#39;safe&#39;))&quot;&gt;
 565           &lt;xsl:text&gt;  if (Threads::number_of_threads() != 0) {
 566     Thread* this_thread = Thread::current_or_null();&lt;/xsl:text&gt;
 567         &lt;/xsl:when&gt;
 568         &lt;xsl:otherwise&gt;
 569 
 570 	  &lt;xsl:text&gt;  Thread* this_thread = NULL;
 571   bool transition;
 572   if (Threads::number_of_threads() == 0) {
 573     transition = false;
 574   } else {
 575     this_thread = Thread::current_or_null();
 576     transition = ((this_thread != NULL) &amp;amp;&amp;amp; !this_thread-&gt;is_Named_thread());
 577   }
 578   if (transition) {&lt;/xsl:text&gt;
 579 	&lt;/xsl:otherwise&gt;
 580 
 581       &lt;/xsl:choose&gt;
 582       &lt;!-- we allow use in early phases but there are threads now, --&gt;
 583       &lt;!-- so do thread transition --&gt;
 584       &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;transition&quot;&gt;
 585           &lt;xsl:with-param name=&quot;space&quot;&gt;
 586             &lt;xsl:text&gt;
 587     &lt;/xsl:text&gt;
 588           &lt;/xsl:with-param&gt;
 589       &lt;/xsl:apply-templates&gt;
 590       &lt;xsl:text&gt;
 591   &lt;/xsl:text&gt;
 592       &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;doCall&quot;/&gt;     
 593       &lt;xsl:text&gt;  } else {
 594   &lt;/xsl:text&gt;
 595       &lt;!-- we are pre-thread - no thread transition code --&gt;
 596       &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;doCall&quot;/&gt;     
 597       &lt;xsl:text&gt;  }
 598 &lt;/xsl:text&gt;
 599     &lt;/xsl:when&gt;
 600     &lt;xsl:otherwise&gt;
 601       &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;doCall&quot;/&gt;      
 602     &lt;/xsl:otherwise&gt;
 603   &lt;/xsl:choose&gt;
 604   &lt;xsl:text&gt;  return err;
 605 &lt;/xsl:text&gt;
 606 
 607   &lt;xsl:if test=&quot;not(contains(@jkernel,&#39;yes&#39;))&quot;&gt;
 608   &lt;xsl:text&gt;#endif // INCLUDE_JVMTI&amp;#xA;&lt;/xsl:text&gt;
 609   &lt;/xsl:if&gt;
 610 
 611   &lt;xsl:text&gt;}&amp;#xA;&lt;/xsl:text&gt;
 612 &lt;/xsl:template&gt;
 613 
 614 &lt;xsl:template match=&quot;function&quot; mode=&quot;doCall&quot;&gt;
 615   &lt;xsl:apply-templates select=&quot;parameters&quot; mode=&quot;dochecks&quot;/&gt;
 616   &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;traceBefore&quot;/&gt;  
 617   &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;genCall&quot;/&gt;
 618   &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;traceAfter&quot;/&gt;
 619 &lt;/xsl:template&gt;
 620 
 621 &lt;xsl:template match=&quot;function&quot; mode=&quot;genCall&quot;&gt;
 622   &lt;xsl:text&gt;  err = jvmti_env-&amp;gt;&lt;/xsl:text&gt;
 623   &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 624   &lt;xsl:text&gt;(&lt;/xsl:text&gt;
 625   &lt;xsl:apply-templates select=&quot;parameters&quot; mode=&quot;HotSpotValue&quot;/&gt;
 626   &lt;xsl:text&gt;);
 627 &lt;/xsl:text&gt;
 628 &lt;/xsl:template&gt;
 629 
 630 
 631 &lt;xsl:template match=&quot;function&quot; mode=&quot;traceSetUp&quot;&gt;
 632   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 633     &lt;xsl:text&gt;  SafeResourceMark rm;
 634   jint trace_flags = JvmtiTrace::trace_flags(&lt;/xsl:text&gt;
 635       &lt;xsl:value-of select=&quot;@num&quot;/&gt;
 636       &lt;xsl:text&gt;);
 637   const char *func_name = NULL;
 638   const char *curr_thread_name = NULL;
 639   if (trace_flags) {
 640     func_name = JvmtiTrace::function_name(&lt;/xsl:text&gt;
 641       &lt;xsl:value-of select=&quot;@num&quot;/&gt;
 642       &lt;xsl:text&gt;);
 643     curr_thread_name = JvmtiTrace::safe_get_current_thread_name();
 644   }
 645 &lt;/xsl:text&gt;
 646   &lt;/xsl:if&gt;
 647 &lt;/xsl:template&gt;
 648 
 649 
 650 &lt;xsl:template match=&quot;function&quot; mode=&quot;traceBefore&quot;&gt;
 651   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 652     &lt;xsl:text&gt;
 653   if ((trace_flags &amp;amp; JvmtiTrace::SHOW_IN) != 0) {
 654     &lt;/xsl:text&gt;
 655     &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;traceIn&quot;/&gt;
 656     &lt;xsl:text&gt;  }
 657 &lt;/xsl:text&gt;
 658   &lt;/xsl:if&gt;
 659 &lt;/xsl:template&gt;
 660 
 661 
 662 &lt;xsl:template match=&quot;param&quot; mode=&quot;traceError&quot;&gt;
 663   &lt;xsl:param name=&quot;err&quot;/&gt;
 664   &lt;xsl:param name=&quot;comment&quot;&gt;&lt;/xsl:param&gt;
 665   &lt;xsl:param name=&quot;extraValue&quot;&gt;&lt;/xsl:param&gt;
 666   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 667   &lt;xsl:text&gt;      if ((trace_flags &amp;amp; JvmtiTrace::SHOW_ERROR) != 0) {
 668         if ((trace_flags &amp;amp; JvmtiTrace::SHOW_IN) == 0) {
 669 &lt;/xsl:text&gt;
 670   &lt;xsl:apply-templates select=&quot;../..&quot; mode=&quot;traceIn&quot;&gt;
 671     &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;.&quot;/&gt;
 672   &lt;/xsl:apply-templates&gt;
 673   &lt;xsl:text&gt;      }
 674         log_error(jvmti)(&quot;[%s] %s } %s - erroneous arg is &lt;/xsl:text&gt;
 675     &lt;xsl:value-of select=&quot;@id&quot;/&gt;
 676     &lt;xsl:value-of select=&quot;$comment&quot;/&gt;
 677     &lt;xsl:text&gt;&quot;,  curr_thread_name, func_name, 
 678                   JvmtiUtil::error_name(&lt;/xsl:text&gt;
 679     &lt;xsl:value-of select=&quot;$err&quot;/&gt;
 680     &lt;xsl:text&gt;)&lt;/xsl:text&gt;
 681     &lt;xsl:value-of select=&quot;$extraValue&quot;/&gt;
 682     &lt;xsl:text&gt;);
 683       }
 684 &lt;/xsl:text&gt;
 685   &lt;/xsl:if&gt;
 686     &lt;xsl:text&gt;      return &lt;/xsl:text&gt;
 687     &lt;xsl:value-of select=&quot;$err&quot;/&gt;
 688     &lt;xsl:text&gt;;&lt;/xsl:text&gt;
 689 &lt;/xsl:template&gt;
 690 
 691 
 692 &lt;xsl:template match=&quot;function&quot; mode=&quot;traceAfter&quot;&gt;
 693   &lt;xsl:if test=&quot;$trace=&#39;Trace&#39;&quot;&gt;
 694     &lt;xsl:text&gt;  if ( err != JVMTI_ERROR_NONE &amp;amp;&amp;amp; (trace_flags &amp;amp; JvmtiTrace::SHOW_ERROR) != 0) {
 695       if ((trace_flags &amp;amp; JvmtiTrace::SHOW_IN) == 0) {
 696 &lt;/xsl:text&gt;
 697     &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;traceIn&quot;/&gt;
 698     &lt;xsl:text&gt;    }
 699     log_error(jvmti)(&quot;[%s] %s } %s&quot;,  curr_thread_name, func_name, 
 700                   JvmtiUtil::error_name(err));
 701   } else if ((trace_flags &amp;amp; JvmtiTrace::SHOW_OUT) != 0) {
 702     log_trace(jvmti)(&quot;[%s] %s }&quot;,  curr_thread_name, func_name);
 703   }
 704 &lt;/xsl:text&gt;
 705   &lt;/xsl:if&gt;
 706 &lt;/xsl:template&gt;
 707 
 708 &lt;xsl:template match=&quot;function&quot; mode=&quot;traceIn&quot;&gt;
 709   &lt;xsl:param name=&quot;endParam&quot;&gt;&lt;/xsl:param&gt;
 710   &lt;xsl:text&gt;          log_trace(jvmti)(&quot;[%s] %s { &lt;/xsl:text&gt;
 711   &lt;xsl:apply-templates select=&quot;parameters&quot; mode=&quot;traceInFormat&quot;&gt;
 712     &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;$endParam&quot;/&gt;    
 713   &lt;/xsl:apply-templates&gt;
 714   &lt;xsl:text&gt;&quot;, curr_thread_name, func_name&lt;/xsl:text&gt;
 715   &lt;xsl:apply-templates select=&quot;parameters&quot; mode=&quot;traceInValue&quot;&gt;
 716     &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;$endParam&quot;/&gt;    
 717   &lt;/xsl:apply-templates&gt;
 718   &lt;xsl:text&gt;);
 719 &lt;/xsl:text&gt;
 720 &lt;/xsl:template&gt;
 721 
 722 &lt;xsl:template match=&quot;parameters&quot; mode=&quot;dochecks&quot;&gt;
 723   &lt;xsl:apply-templates select=&quot;param&quot; mode=&quot;dochecks&quot;/&gt;
 724 &lt;/xsl:template&gt;
 725 
 726 &lt;xsl:template match=&quot;param&quot; mode=&quot;dochecks&quot;&gt;
 727   &lt;xsl:apply-templates select=&quot;child::*[position()=1]&quot; mode=&quot;dochecks&quot;&gt;
 728     &lt;xsl:with-param name=&quot;name&quot; select=&quot;@id&quot;/&gt;
 729   &lt;/xsl:apply-templates&gt;
 730 &lt;/xsl:template&gt;
 731 
 732 &lt;xsl:template match=&quot;outptr|outbuf|allocfieldbuf|ptrtype|inptr|inbuf|vmbuf|allocbuf|agentbuf|allocallocbuf&quot; mode=&quot;dochecks&quot;&gt;
 733   &lt;xsl:param name=&quot;name&quot;/&gt;
 734   &lt;xsl:if test=&quot;count(nullok)=0&quot;&gt;
 735     &lt;xsl:text&gt;  if (&lt;/xsl:text&gt;
 736     &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 737     &lt;xsl:text&gt; == NULL) {
 738 &lt;/xsl:text&gt;
 739     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 740       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_NULL_POINTER&lt;/xsl:with-param&gt;
 741     &lt;/xsl:apply-templates&gt;
 742     &lt;xsl:text&gt;
 743   }
 744 &lt;/xsl:text&gt;
 745   &lt;/xsl:if&gt;
 746 &lt;/xsl:template&gt;
 747 
 748 &lt;xsl:template match=&quot;jrawMonitorID&quot; mode=&quot;dochecks&quot;&gt;
 749   &lt;xsl:param name=&quot;name&quot;/&gt;
 750   &lt;xsl:text&gt;  JvmtiRawMonitor *rmonitor = (JvmtiRawMonitor *)&lt;/xsl:text&gt;
 751   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 752   &lt;xsl:text&gt;;
 753   if (rmonitor == NULL) {
 754 &lt;/xsl:text&gt;
 755     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 756       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_MONITOR&lt;/xsl:with-param&gt;
 757       &lt;xsl:with-param name=&quot;comment&quot;&gt; - raw monitor is NULL&lt;/xsl:with-param&gt;
 758     &lt;/xsl:apply-templates&gt;
 759     &lt;xsl:text&gt;
 760   }
 761   if (!rmonitor-&gt;is_valid()) {
 762 &lt;/xsl:text&gt;
 763     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 764       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_MONITOR&lt;/xsl:with-param&gt;
 765       &lt;xsl:with-param name=&quot;comment&quot;&gt; - not a raw monitor &quot; PTR_FORMAT &quot;&lt;/xsl:with-param&gt;
 766       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, p2i(rmonitor)&lt;/xsl:with-param&gt;
 767     &lt;/xsl:apply-templates&gt;
 768     &lt;xsl:text&gt;
 769   }
 770 &lt;/xsl:text&gt;
 771 &lt;/xsl:template&gt;
 772 
 773 &lt;xsl:template match=&quot;jthread&quot; mode=&quot;dochecksbody&quot;&gt;
 774   &lt;xsl:param name=&quot;name&quot;/&gt;
 775     &lt;xsl:text&gt;    err = JvmtiExport::cv_external_thread_to_JavaThread(tlh.list(), &lt;/xsl:text&gt;
 776     &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 777     &lt;xsl:text&gt;, &amp;amp;java_thread, NULL);
 778     if (err != JVMTI_ERROR_NONE) {
 779 &lt;/xsl:text&gt;
 780     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 781       &lt;xsl:with-param name=&quot;err&quot;&gt;err&lt;/xsl:with-param&gt;
 782       &lt;xsl:with-param name=&quot;comment&quot;&gt; - jthread did not convert to a JavaThread - jthread = &quot; PTR_FORMAT &quot;&lt;/xsl:with-param&gt;
 783       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)&lt;/xsl:with-param&gt;
 784     &lt;/xsl:apply-templates&gt;
 785     &lt;xsl:text&gt;
 786     }
 787 &lt;/xsl:text&gt;
 788 &lt;/xsl:template&gt;
 789 
 790 &lt;xsl:template match=&quot;jthread&quot; mode=&quot;dochecks&quot;&gt;
 791   &lt;xsl:param name=&quot;name&quot;/&gt;
 792   &lt;!-- If we convert and test threads --&gt;
 793   &lt;xsl:if test=&quot;count(@impl)=0 or not(contains(@impl,&#39;noconvert&#39;))&quot;&gt;
 794     &lt;xsl:text&gt;  JavaThread* java_thread = NULL;
 795   ThreadsListHandle tlh(this_thread);
 796 &lt;/xsl:text&gt;
 797     &lt;xsl:choose&gt;
 798       &lt;xsl:when test=&quot;count(@null)=0&quot;&gt;
 799         &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;dochecksbody&quot;&gt;
 800           &lt;xsl:with-param name=&quot;name&quot; select=&quot;$name&quot;/&gt;
 801         &lt;/xsl:apply-templates&gt;
 802       &lt;/xsl:when&gt;
 803       &lt;xsl:otherwise&gt;
 804         &lt;xsl:text&gt;  if (&lt;/xsl:text&gt;
 805         &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 806         &lt;xsl:text&gt; == NULL) {
 807     java_thread = current_thread;
 808   } else {
 809 &lt;/xsl:text&gt;
 810         &lt;xsl:apply-templates select=&quot;.&quot; mode=&quot;dochecksbody&quot;&gt;
 811           &lt;xsl:with-param name=&quot;name&quot; select=&quot;$name&quot;/&gt;
 812         &lt;/xsl:apply-templates&gt;
 813         &lt;xsl:text&gt;  }
 814 &lt;/xsl:text&gt;
 815       &lt;/xsl:otherwise&gt;
 816     &lt;/xsl:choose&gt;
 817   &lt;/xsl:if&gt;
 818 &lt;/xsl:template&gt;
 819 
 820 &lt;xsl:template match=&quot;jframeID&quot; mode=&quot;dochecks&quot;&gt;
 821   &lt;xsl:param name=&quot;name&quot;/&gt;
 822   &lt;xsl:text&gt;
 823   if (depth &amp;lt; 0) {
 824 &lt;/xsl:text&gt;
 825     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 826       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_ILLEGAL_ARGUMENT&lt;/xsl:with-param&gt;
 827       &lt;xsl:with-param name=&quot;comment&quot;&gt; - negative depth - jthread = &quot; INT32_FORMAT &quot;&lt;/xsl:with-param&gt;
 828       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, &lt;xsl:value-of select=&quot;$name&quot;/&gt;&lt;/xsl:with-param&gt;
 829     &lt;/xsl:apply-templates&gt;
 830     &lt;xsl:text&gt;
 831   }
 832 &lt;/xsl:text&gt;
 833 &lt;/xsl:template&gt;
 834 
 835 &lt;xsl:template match=&quot;jclass&quot; mode=&quot;dochecks&quot;&gt;
 836  &lt;xsl:param name=&quot;name&quot;/&gt;
 837  &lt;!-- for JVMTI a jclass/jmethodID becomes just jmethodID --&gt;
 838  &lt;xsl:if test=&quot;count(@method)=0&quot;&gt;
 839   &lt;xsl:text&gt;  oop k_mirror = JNIHandles::resolve_external_guard(&lt;/xsl:text&gt;  
 840   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 841   &lt;xsl:text&gt;);
 842   if (k_mirror == NULL) {
 843 &lt;/xsl:text&gt;
 844     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 845       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_CLASS&lt;/xsl:with-param&gt;
 846       &lt;xsl:with-param name=&quot;comment&quot;&gt; - resolved to NULL - jclass = &quot; PTR_FORMAT &quot;&lt;/xsl:with-param&gt;
 847       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)&lt;/xsl:with-param&gt;
 848     &lt;/xsl:apply-templates&gt;
 849     &lt;xsl:text&gt;
 850   }
 851   if (!k_mirror-&gt;is_a(SystemDictionary::Class_klass())) {
 852 &lt;/xsl:text&gt;
 853     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 854       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_CLASS&lt;/xsl:with-param&gt;
 855       &lt;xsl:with-param name=&quot;comment&quot;&gt; - not a class - jclass = &quot; PTR_FORMAT &quot;&lt;/xsl:with-param&gt;
 856       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)&lt;/xsl:with-param&gt;
 857     &lt;/xsl:apply-templates&gt;
 858     &lt;xsl:text&gt;
 859   }
 860 &lt;/xsl:text&gt;
 861   &lt;xsl:if test=&quot;count(@method|@field)=1&quot;&gt;
 862     &lt;xsl:text&gt;
 863   if (java_lang_Class::is_primitive(k_mirror)) {
 864 &lt;/xsl:text&gt;
 865     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 866       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_CLASS&lt;/xsl:with-param&gt;
 867       &lt;xsl:with-param name=&quot;comment&quot;&gt; - is a primitive class - jclass = &quot; PTR_FORMAT &quot;&lt;/xsl:with-param&gt;
 868       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)&lt;/xsl:with-param&gt;
 869     &lt;/xsl:apply-templates&gt;
 870     &lt;xsl:text&gt;
 871   }
 872   Klass* k_oop = java_lang_Class::as_Klass(k_mirror);
 873   if (k_oop == NULL) {
 874 &lt;/xsl:text&gt;
 875     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 876       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_CLASS&lt;/xsl:with-param&gt;
 877       &lt;xsl:with-param name=&quot;comment&quot;&gt; - no Klass* - jclass = &quot; PTR_FORMAT &quot;&lt;/xsl:with-param&gt;
 878       &lt;xsl:with-param name=&quot;extraValue&quot;&gt;, p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)&lt;/xsl:with-param&gt;
 879     &lt;/xsl:apply-templates&gt;
 880     &lt;xsl:text&gt;
 881   }
 882 &lt;/xsl:text&gt;
 883   &lt;/xsl:if&gt;
 884  &lt;/xsl:if&gt;
 885 &lt;/xsl:template&gt;
 886 
 887 
 888 &lt;xsl:template match=&quot;jmethodID&quot; mode=&quot;dochecks&quot;&gt;
 889   &lt;xsl:param name=&quot;name&quot;/&gt;
<a name="2" id="anc2"></a><span class="line-modified"> 890   &lt;xsl:text&gt;  Method* method_oop = Method::checked_resolve_jmethod_id(&lt;/xsl:text&gt;</span>
 891   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 892   &lt;xsl:text&gt;);&amp;#xA;&lt;/xsl:text&gt;
<a name="3" id="anc3"></a><span class="line-modified"> 893   &lt;xsl:text&gt;  if (method_oop == NULL) {&amp;#xA;&lt;/xsl:text&gt;</span>
 894   &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 895     &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_METHODID&lt;/xsl:with-param&gt;
 896     &lt;xsl:with-param name=&quot;comment&quot;&gt;&lt;/xsl:with-param&gt;
 897     &lt;xsl:with-param name=&quot;extraValue&quot;&gt;&lt;/xsl:with-param&gt;
 898   &lt;/xsl:apply-templates&gt;
 899   &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;
 900   &lt;xsl:text&gt;  }&amp;#xA;&lt;/xsl:text&gt;
 901   &lt;xsl:if test=&quot;count(@native)=1 and contains(@native,&#39;error&#39;)&quot;&gt;
<a name="4" id="anc4"></a><span class="line-modified"> 902     &lt;xsl:text&gt;  if (method_oop-&gt;is_native()) {&amp;#xA;&lt;/xsl:text&gt;   </span>
 903     &lt;xsl:text&gt;    return JVMTI_ERROR_NATIVE_METHOD;&amp;#xA;&lt;/xsl:text&gt;   
 904     &lt;xsl:text&gt;  }&amp;#xA;&lt;/xsl:text&gt;   
 905   &lt;/xsl:if&gt;
 906 &lt;/xsl:template&gt;
 907 
 908 
 909 &lt;xsl:template match=&quot;jfieldID&quot; mode=&quot;dochecks&quot;&gt;
 910   &lt;xsl:param name=&quot;name&quot;/&gt;
 911   &lt;xsl:text&gt;  ResourceMark rm_fdesc(current_thread);&amp;#xA;&lt;/xsl:text&gt;
 912   &lt;xsl:text&gt;  fieldDescriptor fdesc;&amp;#xA;&lt;/xsl:text&gt;
 913   &lt;xsl:text&gt;  if (!JvmtiEnv::get_field_descriptor(k_oop, &lt;/xsl:text&gt;
 914   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 915   &lt;xsl:text&gt;, &amp;amp;fdesc)) {&amp;#xA;&lt;/xsl:text&gt;
 916   &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 917     &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_INVALID_FIELDID&lt;/xsl:with-param&gt;
 918   &lt;/xsl:apply-templates&gt;
 919   &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;
 920   &lt;xsl:text&gt;  }&amp;#xA;&lt;/xsl:text&gt;
 921 &lt;/xsl:template&gt;
 922 
 923 
 924 &lt;xsl:template match=&quot;jint&quot; mode=&quot;dochecks&quot;&gt;
 925   &lt;xsl:param name=&quot;name&quot;/&gt;
 926   &lt;xsl:if test=&quot;count(@min)=1&quot;&gt;
 927     &lt;xsl:text&gt;  if (&lt;/xsl:text&gt;
 928     &lt;xsl:value-of select=&quot;$name&quot;/&gt;
 929     &lt;xsl:text&gt; &amp;lt; &lt;/xsl:text&gt;
 930     &lt;xsl:value-of select=&quot;@min&quot;/&gt;
 931     &lt;xsl:text&gt;) {
 932 &lt;/xsl:text&gt;
 933     &lt;xsl:apply-templates select=&quot;..&quot; mode=&quot;traceError&quot;&gt;     
 934       &lt;xsl:with-param name=&quot;err&quot;&gt;JVMTI_ERROR_ILLEGAL_ARGUMENT&lt;/xsl:with-param&gt;
 935     &lt;/xsl:apply-templates&gt;
 936     &lt;xsl:text&gt;
 937   }
 938 &lt;/xsl:text&gt;
 939   &lt;/xsl:if&gt;
 940 &lt;/xsl:template&gt;
 941 
 942 &lt;xsl:template match=&quot;jobject|jvalue|jthreadGroup|enum|jchar|jlong|jfloat|jdouble|jlocation|jboolean|char|uchar|size_t|void|struct&quot; mode=&quot;dochecks&quot;&gt;
 943 &lt;/xsl:template&gt;
 944 
 945 &lt;!-- iterate over parameters, stopping if specified is encountered --&gt;
 946 &lt;xsl:template name=&quot;traceInValueParamsUpTo&quot;&gt;
 947   &lt;xsl:param name=&quot;params&quot;/&gt;
 948   &lt;xsl:param name=&quot;endParam&quot;&gt;&lt;/xsl:param&gt;
 949   &lt;xsl:param name=&quot;index&quot; select=&quot;1&quot;/&gt;
 950   &lt;xsl:variable name=&quot;cParam&quot; select=&quot;$params[position()=$index]&quot;/&gt;
 951   &lt;xsl:if test=&quot;$cParam!=$endParam&quot;&gt;
 952     &lt;xsl:apply-templates select=&quot;$cParam&quot; mode=&quot;traceInValue&quot;/&gt;
 953     &lt;xsl:if test=&quot;count($params) &amp;gt; $index&quot;&gt;
 954       &lt;xsl:call-template name=&quot;traceInValueParamsUpTo&quot;&gt;
 955         &lt;xsl:with-param name=&quot;params&quot; select=&quot;$params&quot;/&gt;
 956         &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;$endParam&quot;/&gt;
 957         &lt;xsl:with-param name=&quot;index&quot; select=&quot;1+$index&quot;/&gt;
 958       &lt;/xsl:call-template&gt;
 959     &lt;/xsl:if&gt;
 960   &lt;/xsl:if&gt;
 961 &lt;/xsl:template&gt;
 962 
 963 &lt;xsl:template name=&quot;traceInFormatParamsUpTo&quot;&gt;
 964   &lt;xsl:param name=&quot;params&quot;/&gt;
 965   &lt;xsl:param name=&quot;endParam&quot;&gt;&lt;/xsl:param&gt;
 966   &lt;xsl:param name=&quot;index&quot; select=&quot;1&quot;/&gt;
 967   &lt;xsl:variable name=&quot;cParam&quot; select=&quot;$params[position()=$index]&quot;/&gt;
 968   &lt;xsl:if test=&quot;$cParam!=$endParam&quot;&gt;
 969     &lt;xsl:apply-templates select=&quot;$cParam&quot; mode=&quot;traceInFormat&quot;/&gt;
 970     &lt;xsl:if test=&quot;count($params) &amp;gt; $index&quot;&gt;
 971       &lt;xsl:call-template name=&quot;traceInFormatParamsUpTo&quot;&gt;
 972         &lt;xsl:with-param name=&quot;params&quot; select=&quot;$params&quot;/&gt;
 973         &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;$endParam&quot;/&gt;
 974         &lt;xsl:with-param name=&quot;index&quot; select=&quot;1+$index&quot;/&gt;
 975       &lt;/xsl:call-template&gt;
 976     &lt;/xsl:if&gt;
 977   &lt;/xsl:if&gt;
 978 &lt;/xsl:template&gt;
 979 
 980 &lt;xsl:template match=&quot;parameters&quot; mode=&quot;traceInFormat&quot;&gt;
 981   &lt;xsl:param name=&quot;endParam&quot;&gt;&lt;/xsl:param&gt;
 982   &lt;xsl:call-template name=&quot;traceInFormatParamsUpTo&quot;&gt;
 983     &lt;xsl:with-param name=&quot;params&quot; select=&quot;param&quot;/&gt;
 984     &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;$endParam&quot;/&gt;
 985   &lt;/xsl:call-template&gt;
 986 &lt;/xsl:template&gt;
 987 
 988 &lt;xsl:template match=&quot;parameters&quot; mode=&quot;traceInValue&quot;&gt;
 989   &lt;xsl:param name=&quot;endParam&quot;&gt;&lt;/xsl:param&gt;
 990   &lt;xsl:call-template name=&quot;traceInValueParamsUpTo&quot;&gt;
 991     &lt;xsl:with-param name=&quot;params&quot; select=&quot;param&quot;/&gt;
 992     &lt;xsl:with-param name=&quot;endParam&quot; select=&quot;$endParam&quot;/&gt;
 993   &lt;/xsl:call-template&gt;
 994 &lt;/xsl:template&gt;
 995 
 996 &lt;xsl:template match=&quot;param&quot; mode=&quot;traceInFormat&quot;&gt;
 997   &lt;xsl:apply-templates select=&quot;child::*[position()=1]&quot; mode=&quot;traceInFormat&quot;&gt;
 998     &lt;xsl:with-param name=&quot;name&quot; select=&quot;@id&quot;/&gt;
 999   &lt;/xsl:apply-templates&gt;
1000 &lt;/xsl:template&gt;
1001 
1002 &lt;xsl:template match=&quot;param&quot; mode=&quot;traceInValue&quot;&gt;
1003   &lt;xsl:apply-templates select=&quot;child::*[position()=1]&quot; mode=&quot;traceInValue&quot;&gt;
1004     &lt;xsl:with-param name=&quot;name&quot; select=&quot;@id&quot;/&gt;
1005   &lt;/xsl:apply-templates&gt;
1006 &lt;/xsl:template&gt;
1007 
1008 &lt;xsl:template match=&quot;outptr|outbuf|allocfieldbuf|vmbuf|allocbuf|agentbuf|allocallocbuf&quot; mode=&quot;traceInFormat&quot;&gt;
1009 &lt;/xsl:template&gt;
1010 
1011 &lt;xsl:template match=&quot;outptr|outbuf|allocfieldbuf|vmbuf|allocbuf|agentbuf|allocallocbuf&quot; mode=&quot;traceInValue&quot;&gt;
1012 &lt;/xsl:template&gt;
1013 
1014 &lt;xsl:template match=&quot;inbuf&quot; mode=&quot;traceInFormat&quot;&gt;
1015   &lt;xsl:param name=&quot;name&quot;/&gt;
1016   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1017   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1018   &lt;xsl:variable name=&quot;child&quot; select=&quot;child::*[position()=1]&quot;/&gt;
1019   &lt;xsl:choose&gt;g
1020     &lt;xsl:when test=&quot;name($child)=&#39;char&#39;&quot;&gt;
1021       &lt;xsl:text&gt;=&#39;%s&#39;&lt;/xsl:text&gt;
1022     &lt;/xsl:when&gt;
1023     &lt;xsl:otherwise&gt;
1024       &lt;xsl:text&gt;=&quot; PTR_FORMAT &quot;&lt;/xsl:text&gt;
1025     &lt;/xsl:otherwise&gt;
1026   &lt;/xsl:choose&gt;
1027 &lt;/xsl:template&gt;
1028 
1029 &lt;xsl:template match=&quot;inbuf&quot; mode=&quot;traceInValue&quot;&gt;
1030   &lt;xsl:param name=&quot;name&quot;/&gt;
1031   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1032   &lt;xsl:variable name=&quot;child&quot; select=&quot;child::*[position()=1]&quot;/&gt;
1033   &lt;xsl:choose&gt;
1034     &lt;xsl:when test=&quot;name($child)=&#39;char&#39;&quot;&gt;
1035       &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1036     &lt;/xsl:when&gt;
1037     &lt;xsl:otherwise&gt;
1038       p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)
1039     &lt;/xsl:otherwise&gt;
1040   &lt;/xsl:choose&gt;
1041 &lt;/xsl:template&gt;
1042 
1043 &lt;xsl:template match=&quot;ptrtype&quot; mode=&quot;traceInFormat&quot;&gt;
1044   &lt;xsl:param name=&quot;name&quot;/&gt;
1045   &lt;xsl:variable name=&quot;child&quot; select=&quot;child::*[position()=1]&quot;/&gt;
1046   &lt;xsl:choose&gt;
1047     &lt;xsl:when test=&quot;name($child)=&#39;jclass&#39;&quot;&gt;
1048       &lt;xsl:text&gt; &lt;/xsl:text&gt;
1049       &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1050       &lt;xsl:text&gt;=&quot; PTR_FORMAT &quot;&lt;/xsl:text&gt;
1051     &lt;/xsl:when&gt;
1052     &lt;xsl:otherwise&gt;
1053       &lt;xsl:apply-templates select=&quot;$child&quot; mode=&quot;traceInFormat&quot;/&gt; 
1054     &lt;/xsl:otherwise&gt;
1055   &lt;/xsl:choose&gt;
1056 &lt;/xsl:template&gt;
1057 
1058 &lt;xsl:template match=&quot;ptrtype&quot; mode=&quot;traceInValue&quot;&gt;
1059   &lt;xsl:param name=&quot;name&quot;/&gt;
1060   &lt;xsl:variable name=&quot;child&quot; select=&quot;child::*[position()=1]&quot;/&gt;
1061   &lt;xsl:choose&gt;
1062     &lt;xsl:when test=&quot;name($child)=&#39;jclass&#39;&quot;&gt;
1063       &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1064       p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)
1065     &lt;/xsl:when&gt;
1066     &lt;xsl:otherwise&gt;
1067       &lt;xsl:apply-templates select=&quot;$child&quot; mode=&quot;traceInValue&quot;/&gt;
1068     &lt;/xsl:otherwise&gt;
1069   &lt;/xsl:choose&gt; 
1070 &lt;/xsl:template&gt;
1071 
1072 &lt;xsl:template match=&quot;inptr&quot; mode=&quot;traceInFormat&quot;&gt;
1073   &lt;xsl:param name=&quot;name&quot;/&gt;
1074   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1075   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1076   &lt;xsl:text&gt;=&quot; PTR_FORMAT &quot;&lt;/xsl:text&gt;
1077 &lt;/xsl:template&gt;
1078 
1079 &lt;xsl:template match=&quot;inptr&quot; mode=&quot;traceInValue&quot;&gt;
1080   &lt;xsl:param name=&quot;name&quot;/&gt;
1081   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1082   p2i(&lt;xsl:value-of select=&quot;$name&quot;/&gt;)
1083 &lt;/xsl:template&gt;
1084 
1085 &lt;xsl:template match=&quot;jrawMonitorID|jfieldID&quot; mode=&quot;traceInFormat&quot;&gt;
1086   &lt;xsl:param name=&quot;name&quot;/&gt;
1087   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1088   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1089   &lt;xsl:text&gt;=%s&lt;/xsl:text&gt;
1090 &lt;/xsl:template&gt;
1091 
1092 &lt;xsl:template match=&quot;jclass&quot; mode=&quot;traceInFormat&quot;&gt;
1093   &lt;xsl:param name=&quot;name&quot;/&gt;
1094   &lt;!-- for JVMTI a jclass/jmethodID becomes just jmethodID --&gt;
1095   &lt;xsl:if test=&quot;count(@method)=0&quot;&gt;
1096     &lt;xsl:text&gt; &lt;/xsl:text&gt;
1097     &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1098     &lt;xsl:text&gt;=%s&lt;/xsl:text&gt;
1099   &lt;/xsl:if&gt;
1100 &lt;/xsl:template&gt;
1101 
1102 &lt;xsl:template match=&quot;jrawMonitorID&quot; mode=&quot;traceInValue&quot;&gt;
1103   &lt;xsl:param name=&quot;name&quot;/&gt;
1104   &lt;xsl:text&gt;, rmonitor-&gt;get_name()&lt;/xsl:text&gt;
1105 &lt;/xsl:template&gt;
1106 
1107 &lt;xsl:template match=&quot;jthread&quot; mode=&quot;traceInFormat&quot;&gt;
1108   &lt;xsl:param name=&quot;name&quot;/&gt;
1109   &lt;!-- If we convert and test threads --&gt;
1110   &lt;xsl:if test=&quot;count(@impl)=0 or not(contains(@impl,&#39;noconvert&#39;))&quot;&gt;
1111     &lt;xsl:text&gt; &lt;/xsl:text&gt;
1112     &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1113     &lt;xsl:text&gt;=%s&lt;/xsl:text&gt;
1114   &lt;/xsl:if&gt;
1115 &lt;/xsl:template&gt;
1116 
1117 &lt;xsl:template match=&quot;jthread&quot; mode=&quot;traceInValue&quot;&gt;
1118   &lt;xsl:param name=&quot;name&quot;/&gt;
1119   &lt;!-- If we convert and test threads --&gt;
1120   &lt;xsl:if test=&quot;count(@impl)=0 or not(contains(@impl,&#39;noconvert&#39;))&quot;&gt;
1121     &lt;xsl:text&gt;, 
1122                     JvmtiTrace::safe_get_thread_name(java_thread)&lt;/xsl:text&gt;  
1123   &lt;/xsl:if&gt;
1124 &lt;/xsl:template&gt;
1125 
1126 &lt;xsl:template match=&quot;jframeID&quot; mode=&quot;traceInFormat&quot;&gt;
1127   &lt;xsl:param name=&quot;name&quot;/&gt;
1128   &lt;xsl:text&gt;depth=%d&lt;/xsl:text&gt;
1129 &lt;/xsl:template&gt;
1130 
1131 &lt;xsl:template match=&quot;jframeID&quot; mode=&quot;traceInValue&quot;&gt;
1132   &lt;xsl:param name=&quot;name&quot;/&gt;
1133   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1134   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1135 &lt;/xsl:template&gt;
1136 
1137 &lt;xsl:template match=&quot;jclass&quot; mode=&quot;traceInValue&quot;&gt;
1138   &lt;!-- for JVMTI a jclass/jmethodID becomes just jmethodID --&gt;
1139   &lt;xsl:if test=&quot;count(@method)=0&quot;&gt;
1140     &lt;xsl:text&gt;, 
1141                     JvmtiTrace::get_class_name(k_mirror)&lt;/xsl:text&gt;
1142   &lt;/xsl:if&gt;
1143 &lt;/xsl:template&gt;
1144 
1145 &lt;xsl:template match=&quot;jmethodID&quot; mode=&quot;traceInFormat&quot;&gt;
1146   &lt;xsl:param name=&quot;name&quot;/&gt;
1147   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1148   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1149   &lt;xsl:text&gt;=%s.%s&lt;/xsl:text&gt;
1150 &lt;/xsl:template&gt;
1151 
1152 &lt;xsl:template match=&quot;jmethodID&quot; mode=&quot;traceInValue&quot;&gt;
1153   &lt;xsl:param name=&quot;name&quot;/&gt;
1154   &lt;xsl:text&gt;, 
<a name="5" id="anc5"></a><span class="line-modified">1155                     method_oop == NULL? &quot;NULL&quot; : method_oop-&gt;klass_name()-&gt;as_C_string(),</span>
<span class="line-modified">1156                     method_oop == NULL? &quot;NULL&quot; : method_oop-&gt;name()-&gt;as_C_string()</span>
1157              &lt;/xsl:text&gt;
1158 &lt;/xsl:template&gt;
1159 
1160 &lt;xsl:template match=&quot;jfieldID&quot; mode=&quot;traceInValue&quot;&gt;
1161   &lt;xsl:param name=&quot;name&quot;/&gt;
1162   &lt;xsl:text&gt;, fdesc.name()-&gt;as_C_string()&lt;/xsl:text&gt;
1163 &lt;/xsl:template&gt;
1164 
1165 &lt;xsl:template match=&quot;enum&quot; mode=&quot;traceInFormat&quot;&gt;
1166   &lt;xsl:param name=&quot;name&quot;/&gt;
1167   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1168   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1169   &lt;xsl:text&gt;=%d:%s&lt;/xsl:text&gt;
1170 &lt;/xsl:template&gt;
1171 
1172 &lt;xsl:template match=&quot;enum&quot; mode=&quot;traceInValue&quot;&gt;
1173   &lt;xsl:param name=&quot;name&quot;/&gt;
1174   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1175   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1176   &lt;xsl:text&gt;, 
1177                     &lt;/xsl:text&gt;
1178   &lt;xsl:choose&gt;
1179     &lt;xsl:when test=&quot;.=&#39;jvmtiError&#39;&quot;&gt;
1180       &lt;xsl:text&gt;JvmtiUtil::error_name(&lt;/xsl:text&gt;
1181       &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1182       &lt;xsl:text&gt;)
1183 &lt;/xsl:text&gt;
1184     &lt;/xsl:when&gt;
1185     &lt;xsl:otherwise&gt;
1186       &lt;xsl:choose&gt;
1187         &lt;xsl:when test=&quot;.=&#39;jvmtiEvent&#39;&quot;&gt;
1188           &lt;xsl:text&gt;JvmtiTrace::event_name(&lt;/xsl:text&gt;
1189           &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1190           &lt;xsl:text&gt;)
1191         &lt;/xsl:text&gt;
1192       &lt;/xsl:when&gt;
1193       &lt;xsl:otherwise&gt;
1194         &lt;xsl:text&gt;JvmtiTrace::enum_name(&lt;/xsl:text&gt;
1195         &lt;xsl:value-of select=&quot;.&quot;/&gt;
1196         &lt;xsl:text&gt;ConstantNames, &lt;/xsl:text&gt;
1197         &lt;xsl:value-of select=&quot;.&quot;/&gt;
1198         &lt;xsl:text&gt;ConstantValues, &lt;/xsl:text&gt;
1199         &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1200         &lt;xsl:text&gt;)&lt;/xsl:text&gt;
1201       &lt;/xsl:otherwise&gt;
1202     &lt;/xsl:choose&gt;
1203     &lt;/xsl:otherwise&gt;
1204   &lt;/xsl:choose&gt;
1205 &lt;/xsl:template&gt;
1206 
1207 &lt;xsl:template match=&quot;jint&quot; mode=&quot;traceInFormat&quot;&gt;
1208   &lt;xsl:param name=&quot;name&quot;/&gt;
1209   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1210   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1211   &lt;xsl:text&gt;=&quot; INT32_FORMAT &quot;&lt;/xsl:text&gt;
1212 &lt;/xsl:template&gt;
1213 
1214 &lt;xsl:template match=&quot;jlocation&quot; mode=&quot;traceInFormat&quot;&gt;
1215   &lt;xsl:param name=&quot;name&quot;/&gt;
1216   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1217   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1218   &lt;xsl:text&gt;=&quot; JLONG_FORMAT &quot;&lt;/xsl:text&gt;
1219 &lt;/xsl:template&gt;
1220 
1221 &lt;xsl:template match=&quot;jlong&quot; mode=&quot;traceInFormat&quot;&gt;
1222   &lt;xsl:param name=&quot;name&quot;/&gt;
1223   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1224   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1225   &lt;xsl:text&gt;=&quot; JLONG_FORMAT &quot;&lt;/xsl:text&gt;
1226 &lt;/xsl:template&gt;
1227 
1228 &lt;xsl:template match=&quot;size_t&quot; mode=&quot;traceInFormat&quot;&gt;
1229   &lt;xsl:param name=&quot;name&quot;/&gt;
1230   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1231   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1232   &lt;xsl:text&gt;=&quot; SIZE_FORMAT_HEX &quot;&lt;/xsl:text&gt;
1233 &lt;/xsl:template&gt;
1234 
1235 &lt;xsl:template match=&quot;jfloat|jdouble&quot; mode=&quot;traceInFormat&quot;&gt;
1236   &lt;xsl:param name=&quot;name&quot;/&gt;
1237   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1238   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1239   &lt;xsl:text&gt;=%f&lt;/xsl:text&gt;
1240 &lt;/xsl:template&gt;
1241 
1242 &lt;xsl:template match=&quot;char&quot; mode=&quot;traceInFormat&quot;&gt;
1243   &lt;xsl:param name=&quot;name&quot;/&gt;
1244   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1245   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1246   &lt;xsl:text&gt;=%c&lt;/xsl:text&gt;
1247 &lt;/xsl:template&gt;
1248 
1249 &lt;xsl:template match=&quot;uchar|jchar&quot; mode=&quot;traceInFormat&quot;&gt;
1250   &lt;xsl:param name=&quot;name&quot;/&gt;
1251   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1252   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1253   &lt;xsl:text&gt;=0x%x&lt;/xsl:text&gt;
1254 &lt;/xsl:template&gt;
1255 
1256 &lt;xsl:template match=&quot;jint|jlocation|jchar|jlong|jfloat|jdouble|char|uchar|size_t&quot; mode=&quot;traceInValue&quot;&gt;
1257   &lt;xsl:param name=&quot;name&quot;/&gt;
1258   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1259   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1260 &lt;/xsl:template&gt;
1261 
1262 
1263 &lt;xsl:template match=&quot;jboolean&quot; mode=&quot;traceInFormat&quot;&gt;
1264   &lt;xsl:param name=&quot;name&quot;/&gt;
1265   &lt;xsl:text&gt; &lt;/xsl:text&gt;
1266   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1267   &lt;xsl:text&gt;=%s&lt;/xsl:text&gt;
1268 &lt;/xsl:template&gt;
1269 
1270 &lt;xsl:template match=&quot;jboolean&quot; mode=&quot;traceInValue&quot;&gt;
1271   &lt;xsl:param name=&quot;name&quot;/&gt;
1272   &lt;xsl:text&gt;, &lt;/xsl:text&gt;
1273   &lt;xsl:value-of select=&quot;$name&quot;/&gt;
1274   &lt;xsl:text&gt;? &quot;true&quot; : &quot;false&quot;&lt;/xsl:text&gt;
1275 &lt;/xsl:template&gt;
1276 
1277 &lt;xsl:template match=&quot;jobject|jvalue|jthreadGroup|void|struct&quot; mode=&quot;traceInFormat&quot;&gt;
1278 &lt;/xsl:template&gt;
1279 
1280 &lt;xsl:template match=&quot;jobject|jvalue|jthreadGroup|void|struct&quot; mode=&quot;traceInValue&quot;&gt;
1281 &lt;/xsl:template&gt;
1282 
1283 
1284 
1285 &lt;/xsl:stylesheet&gt;
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>