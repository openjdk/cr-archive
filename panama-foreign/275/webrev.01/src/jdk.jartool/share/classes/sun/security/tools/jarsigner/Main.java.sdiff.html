<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jartool/share/classes/sun/security/tools/jarsigner/Main.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../jdk.internal.vm.ci/share/classes/jdk.vm.ci.hotspot/src/jdk/vm/ci/hotspot/HotSpotJVMCIRuntime.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../man/jar.1.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jartool/share/classes/sun/security/tools/jarsigner/Main.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1042                 e.printStackTrace();
1043             }
1044         } finally { // close the resource
1045             if (jf != null) {
1046                 jf.close();
1047             }
1048         }
1049 
1050         System.exit(1);
1051     }
1052 
1053     private void displayMessagesAndResult(boolean isSigning) {
1054         String result;
1055         List&lt;String&gt; errors = new ArrayList&lt;&gt;();
1056         List&lt;String&gt; warnings = new ArrayList&lt;&gt;();
1057         List&lt;String&gt; info = new ArrayList&lt;&gt;();
1058 
1059         boolean signerNotExpired = expireDate == null
1060                 || expireDate.after(new Date());
1061 
<span class="line-modified">1062         if (badKeyUsage || badExtendedKeyUsage || badNetscapeCertType ||</span>
<span class="line-modified">1063                 notYetValidCert || chainNotValidated || hasExpiredCert ||</span>
<span class="line-modified">1064                 hasUnsignedEntry || signerSelfSigned || (legacyAlg != 0) ||</span>
<span class="line-modified">1065                 (disabledAlg != 0) || aliasNotInStore || notSignedByAlias ||</span>
<span class="line-modified">1066                 tsaChainNotValidated ||</span>
<span class="line-removed">1067                 (hasExpiredTsaCert &amp;&amp; !signerNotExpired)) {</span>
<span class="line-removed">1068 </span>
<span class="line-removed">1069             if (strict) {</span>
<span class="line-removed">1070                 result = isSigning</span>
<span class="line-removed">1071                         ? rb.getString(&quot;jar.signed.with.signer.errors.&quot;)</span>
<span class="line-removed">1072                         : rb.getString(&quot;jar.verified.with.signer.errors.&quot;);</span>
<span class="line-removed">1073             } else {</span>
<span class="line-removed">1074                 result = isSigning</span>
<span class="line-removed">1075                         ? rb.getString(&quot;jar.signed.&quot;)</span>
<span class="line-removed">1076                         : rb.getString(&quot;jar.verified.&quot;);</span>
<span class="line-removed">1077             }</span>
1078 
<span class="line-modified">1079             if (badKeyUsage) {</span>
<span class="line-modified">1080                 errors.add(isSigning</span>
<span class="line-modified">1081                         ? rb.getString(&quot;The.signer.certificate.s.KeyUsage.extension.doesn.t.allow.code.signing.&quot;)</span>
<span class="line-modified">1082                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.s.KeyUsage.extension.doesn.t.allow.code.signing.&quot;));</span>
<span class="line-modified">1083             }</span>
1084 
<span class="line-modified">1085             if (badExtendedKeyUsage) {</span>
<span class="line-modified">1086                 errors.add(isSigning</span>
<span class="line-modified">1087                         ? rb.getString(&quot;The.signer.certificate.s.ExtendedKeyUsage.extension.doesn.t.allow.code.signing.&quot;)</span>
<span class="line-modified">1088                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.s.ExtendedKeyUsage.extension.doesn.t.allow.code.signing.&quot;));</span>
<span class="line-modified">1089             }</span>
1090 
<span class="line-modified">1091             if (badNetscapeCertType) {</span>
<span class="line-modified">1092                 errors.add(isSigning</span>
<span class="line-modified">1093                         ? rb.getString(&quot;The.signer.certificate.s.NetscapeCertType.extension.doesn.t.allow.code.signing.&quot;)</span>
<span class="line-modified">1094                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.s.NetscapeCertType.extension.doesn.t.allow.code.signing.&quot;));</span>
<span class="line-modified">1095             }</span>
1096 
<span class="line-modified">1097             // only in verifying</span>
<span class="line-modified">1098             if (hasUnsignedEntry) {</span>
<span class="line-modified">1099                 errors.add(rb.getString(</span>
<span class="line-modified">1100                         &quot;This.jar.contains.unsigned.entries.which.have.not.been.integrity.checked.&quot;));</span>
<span class="line-modified">1101             }</span>
<span class="line-removed">1102             if (hasExpiredCert) {</span>
<span class="line-removed">1103                 errors.add(isSigning</span>
<span class="line-removed">1104                         ? rb.getString(&quot;The.signer.certificate.has.expired.&quot;)</span>
<span class="line-removed">1105                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.has.expired.&quot;));</span>
<span class="line-removed">1106             }</span>
<span class="line-removed">1107             if (notYetValidCert) {</span>
<span class="line-removed">1108                 errors.add(isSigning</span>
<span class="line-removed">1109                         ? rb.getString(&quot;The.signer.certificate.is.not.yet.valid.&quot;)</span>
<span class="line-removed">1110                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.is.not.yet.valid.&quot;));</span>
<span class="line-removed">1111             }</span>
1112 
<span class="line-modified">1113             if (chainNotValidated) {</span>
<span class="line-modified">1114                 errors.add(String.format(isSigning</span>
<span class="line-modified">1115                                 ? rb.getString(&quot;The.signer.s.certificate.chain.is.invalid.reason.1&quot;)</span>
<span class="line-modified">1116                                 : rb.getString(&quot;This.jar.contains.entries.whose.certificate.chain.is.invalid.reason.1&quot;),</span>
<span class="line-modified">1117                         chainNotValidatedReason.getLocalizedMessage()));</span>
<span class="line-removed">1118             }</span>
1119 
<span class="line-modified">1120             if (hasExpiredTsaCert) {</span>
<span class="line-modified">1121                 errors.add(rb.getString(&quot;The.timestamp.has.expired.&quot;));</span>
<span class="line-modified">1122             }</span>
<span class="line-modified">1123             if (tsaChainNotValidated) {</span>
<span class="line-modified">1124                 errors.add(String.format(isSigning</span>
<span class="line-modified">1125                                 ? rb.getString(&quot;The.tsa.certificate.chain.is.invalid.reason.1&quot;)</span>
<span class="line-removed">1126                                 : rb.getString(&quot;This.jar.contains.entries.whose.tsa.certificate.chain.is.invalid.reason.1&quot;),</span>
<span class="line-removed">1127                         tsaChainNotValidatedReason.getLocalizedMessage()));</span>
<span class="line-removed">1128             }</span>
1129 
<span class="line-modified">1130             // only in verifying</span>
<span class="line-modified">1131             if (notSignedByAlias) {</span>
<span class="line-modified">1132                 errors.add(</span>
<span class="line-modified">1133                         rb.getString(&quot;This.jar.contains.signed.entries.which.is.not.signed.by.the.specified.alias.es.&quot;));</span>

























1134             }
1135 
<span class="line-modified">1136             // only in verifying</span>
<span class="line-modified">1137             if (aliasNotInStore) {</span>
<span class="line-modified">1138                 errors.add(rb.getString(&quot;This.jar.contains.signed.entries.that.s.not.signed.by.alias.in.this.keystore.&quot;));</span>

1139             }
1140 
<span class="line-modified">1141             if (signerSelfSigned) {</span>
<span class="line-modified">1142                 errors.add(isSigning</span>
<span class="line-modified">1143                         ? rb.getString(&quot;The.signer.s.certificate.is.self.signed.&quot;)</span>
<span class="line-modified">1144                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.is.self.signed.&quot;));</span>
1145             }
1146 
<span class="line-modified">1147             if (isSigning) {</span>
<span class="line-modified">1148                 if ((legacyAlg &amp; 1) == 1) {</span>
<span class="line-modified">1149                     warnings.add(String.format(</span>
<span class="line-modified">1150                             rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1151                             digestalg, &quot;-digestalg&quot;));</span>
<span class="line-removed">1152                 }</span>
1153 
<span class="line-modified">1154                 if ((disabledAlg &amp; 1) == 1) {</span>
<span class="line-modified">1155                     errors.add(String.format(</span>
<span class="line-modified">1156                             rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-modified">1157                             digestalg, &quot;-digestalg&quot;));</span>
<span class="line-modified">1158                 }</span>
1159 
<span class="line-modified">1160                 if ((legacyAlg &amp; 2) == 2) {</span>
<span class="line-modified">1161                     warnings.add(String.format(</span>
<span class="line-modified">1162                             rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1163                             sigalg, &quot;-sigalg&quot;));</span>
<span class="line-modified">1164                 }</span>
<span class="line-removed">1165                 if ((disabledAlg &amp; 2) == 2) {</span>
<span class="line-removed">1166                     errors.add(String.format(</span>
<span class="line-removed">1167                             rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-removed">1168                             sigalg, &quot;-sigalg&quot;));</span>
<span class="line-removed">1169                 }</span>
1170 
<span class="line-modified">1171                 if ((legacyAlg &amp; 4) == 4) {</span>
<span class="line-modified">1172                     warnings.add(String.format(</span>
<span class="line-modified">1173                             rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1174                             tSADigestAlg, &quot;-tsadigestalg&quot;));</span>
<span class="line-modified">1175                 }</span>
<span class="line-removed">1176                 if ((disabledAlg &amp; 4) == 4) {</span>
<span class="line-removed">1177                     errors.add(String.format(</span>
<span class="line-removed">1178                             rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-removed">1179                             tSADigestAlg, &quot;-tsadigestalg&quot;));</span>
<span class="line-removed">1180                 }</span>
1181 
<span class="line-modified">1182                 if ((legacyAlg &amp; 8) == 8) {</span>
<span class="line-modified">1183                     warnings.add(String.format(</span>
<span class="line-modified">1184                             rb.getString(&quot;The.1.signing.key.has.a.keysize.of.2.which.is.considered.a.security.risk..This.key.size.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1185                             privateKey.getAlgorithm(), KeyUtil.getKeySize(privateKey)));</span>
<span class="line-modified">1186                 }</span>
<span class="line-modified">1187                 if ((disabledAlg &amp; 8) == 8) {</span>
<span class="line-modified">1188                     errors.add(String.format(</span>
<span class="line-modified">1189                             rb.getString(&quot;The.1.signing.key.has.a.keysize.of.2.which.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-modified">1190                             privateKey.getAlgorithm(), KeyUtil.getKeySize(privateKey)));</span>
<span class="line-modified">1191                 }</span>
<span class="line-modified">1192             } else {</span>
<span class="line-removed">1193                 if ((legacyAlg &amp; 1) != 0) {</span>
<span class="line-removed">1194                     warnings.add(String.format(</span>
<span class="line-removed">1195                             rb.getString(&quot;The.digest.algorithm.1.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-removed">1196                             legacyDigestAlg));</span>
<span class="line-removed">1197                 }</span>
1198 
<span class="line-modified">1199                 if ((legacyAlg &amp; 2) == 2) {</span>
<span class="line-modified">1200                      warnings.add(String.format(</span>
<span class="line-modified">1201                              rb.getString(&quot;The.signature.algorithm.1.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1202                              legacySigAlg));</span>
<span class="line-modified">1203                 }</span>
1204 
<span class="line-modified">1205                 if ((legacyAlg &amp; 4) != 0) {</span>
<span class="line-modified">1206                     warnings.add(String.format(</span>
<span class="line-modified">1207                             rb.getString(&quot;The.timestamp.digest.algorithm.1.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1208                             legacyTsaDigestAlg));</span>
<span class="line-modified">1209                 }</span>
1210 
<span class="line-modified">1211                 if ((legacyAlg &amp; 8) == 8) {</span>
<span class="line-modified">1212                     warnings.add(String.format(</span>
<span class="line-modified">1213                             rb.getString(&quot;The.1.signing.key.has.a.keysize.of.2.which.is.considered.a.security.risk..This.key.size.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1214                             weakPublicKey.getAlgorithm(), KeyUtil.getKeySize(weakPublicKey)));</span>
<span class="line-removed">1215                 }</span>
1216             }
<span class="line-removed">1217         } else {</span>
<span class="line-removed">1218             result = isSigning ? rb.getString(&quot;jar.signed.&quot;) : rb.getString(&quot;jar.verified.&quot;);</span>
1219         }
1220 

1221         if (hasExpiredTsaCert) {
1222             // No need to warn about expiring if already expired
1223             hasExpiringTsaCert = false;
<span class="line-modified">1224         }</span>
<span class="line-modified">1225 </span>
<span class="line-modified">1226         if (hasExpiringCert ||</span>
<span class="line-modified">1227                 (hasExpiringTsaCert  &amp;&amp; expireDate != null) ||</span>
<span class="line-removed">1228                 (noTimestamp &amp;&amp; expireDate != null) ||</span>
<span class="line-removed">1229                 (hasExpiredTsaCert &amp;&amp; signerNotExpired) ||</span>
<span class="line-removed">1230                 permsDetected) {</span>
<span class="line-removed">1231 </span>
<span class="line-removed">1232             if (hasExpiredTsaCert &amp;&amp; signerNotExpired) {</span>
1233                 if (expireDate != null) {
1234                     warnings.add(String.format(
1235                             rb.getString(&quot;The.timestamp.expired.1.but.usable.2&quot;),
1236                             tsaExpireDate,
1237                             expireDate));
1238                 }
1239                 // Reset the flag so exit code is 0
1240                 hasExpiredTsaCert = false;
1241             }
<span class="line-modified">1242             if (hasExpiringCert) {</span>
<span class="line-modified">1243                 warnings.add(isSigning</span>
<span class="line-modified">1244                         ? rb.getString(&quot;The.signer.certificate.will.expire.within.six.months.&quot;)</span>
<span class="line-modified">1245                         : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.will.expire.within.six.months.&quot;));</span>
<span class="line-modified">1246             }</span>
<span class="line-modified">1247             if (hasExpiringTsaCert &amp;&amp; expireDate != null) {</span>
<span class="line-modified">1248                 if (expireDate.after(tsaExpireDate)) {</span>
<span class="line-modified">1249                     warnings.add(String.format(rb.getString(</span>
<span class="line-modified">1250                             &quot;The.timestamp.will.expire.within.one.year.on.1.but.2&quot;), tsaExpireDate, expireDate));</span>
<span class="line-modified">1251                 } else {</span>
<span class="line-modified">1252                     warnings.add(String.format(rb.getString(</span>
<span class="line-modified">1253                             &quot;The.timestamp.will.expire.within.one.year.on.1&quot;), tsaExpireDate));</span>
<span class="line-modified">1254                 }</span>
<span class="line-modified">1255             }</span>
<span class="line-modified">1256             if (noTimestamp &amp;&amp; expireDate != null) {</span>
<span class="line-removed">1257                 if (hasTimestampBlock) {</span>
<span class="line-removed">1258                     warnings.add(String.format(isSigning</span>
<span class="line-removed">1259                             ? rb.getString(&quot;invalid.timestamp.signing&quot;)</span>
<span class="line-removed">1260                             : rb.getString(&quot;bad.timestamp.verifying&quot;), expireDate));</span>
<span class="line-removed">1261                 } else {</span>
<span class="line-removed">1262                     warnings.add(String.format(isSigning</span>
<span class="line-removed">1263                             ? rb.getString(&quot;no.timestamp.signing&quot;)</span>
<span class="line-removed">1264                             : rb.getString(&quot;no.timestamp.verifying&quot;), expireDate));</span>
<span class="line-removed">1265                 }</span>
1266             }
<span class="line-modified">1267             if (permsDetected) {</span>
<span class="line-modified">1268                 warnings.add(rb.getString(&quot;posix.attributes.detected&quot;));</span>









1269             }
1270         }
1271 













1272         System.out.println(result);

1273         if (strict) {
1274             if (!errors.isEmpty()) {
1275                 System.out.println();
1276                 System.out.println(rb.getString(&quot;Error.&quot;));
1277                 errors.forEach(System.out::println);
1278             }
1279             if (!warnings.isEmpty()) {
1280                 System.out.println();
1281                 System.out.println(rb.getString(&quot;Warning.&quot;));
1282                 warnings.forEach(System.out::println);
1283             }
1284         } else {
1285             if (!errors.isEmpty() || !warnings.isEmpty()) {
1286                 System.out.println();
1287                 System.out.println(rb.getString(&quot;Warning.&quot;));
1288                 errors.forEach(System.out::println);
1289                 warnings.forEach(System.out::println);
1290             }
1291         }

1292         if (!isSigning &amp;&amp; (!errors.isEmpty() || !warnings.isEmpty())) {
1293             if (! (verbose != null &amp;&amp; showcerts)) {
1294                 System.out.println();
1295                 System.out.println(rb.getString(
1296                         &quot;Re.run.with.the.verbose.and.certs.options.for.more.details.&quot;));
1297             }
1298         }
1299 
1300         if (isSigning || verbose != null) {
1301             // Always print out expireDate, unless expired or expiring.
1302             if (!hasExpiringCert &amp;&amp; !hasExpiredCert
1303                     &amp;&amp; expireDate != null &amp;&amp; signerNotExpired) {
1304                 info.add(String.format(rb.getString(
1305                         &quot;The.signer.certificate.will.expire.on.1.&quot;), expireDate));
1306             }
1307             if (!noTimestamp) {
1308                 if (!hasExpiringTsaCert &amp;&amp; !hasExpiredTsaCert &amp;&amp; tsaExpireDate != null) {
1309                     if (signerNotExpired) {
1310                         info.add(String.format(rb.getString(
1311                                 &quot;The.timestamp.will.expire.on.1.&quot;), tsaExpireDate));
</pre>
</td>
<td>
<hr />
<pre>
1042                 e.printStackTrace();
1043             }
1044         } finally { // close the resource
1045             if (jf != null) {
1046                 jf.close();
1047             }
1048         }
1049 
1050         System.exit(1);
1051     }
1052 
1053     private void displayMessagesAndResult(boolean isSigning) {
1054         String result;
1055         List&lt;String&gt; errors = new ArrayList&lt;&gt;();
1056         List&lt;String&gt; warnings = new ArrayList&lt;&gt;();
1057         List&lt;String&gt; info = new ArrayList&lt;&gt;();
1058 
1059         boolean signerNotExpired = expireDate == null
1060                 || expireDate.after(new Date());
1061 
<span class="line-modified">1062         if (badKeyUsage) {</span>
<span class="line-modified">1063             errors.add(isSigning</span>
<span class="line-modified">1064                     ? rb.getString(&quot;The.signer.certificate.s.KeyUsage.extension.doesn.t.allow.code.signing.&quot;)</span>
<span class="line-modified">1065                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.s.KeyUsage.extension.doesn.t.allow.code.signing.&quot;));</span>
<span class="line-modified">1066         }</span>











1067 
<span class="line-modified">1068         if (badExtendedKeyUsage) {</span>
<span class="line-modified">1069             errors.add(isSigning</span>
<span class="line-modified">1070                     ? rb.getString(&quot;The.signer.certificate.s.ExtendedKeyUsage.extension.doesn.t.allow.code.signing.&quot;)</span>
<span class="line-modified">1071                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.s.ExtendedKeyUsage.extension.doesn.t.allow.code.signing.&quot;));</span>
<span class="line-modified">1072         }</span>
1073 
<span class="line-modified">1074         if (badNetscapeCertType) {</span>
<span class="line-modified">1075             errors.add(isSigning</span>
<span class="line-modified">1076                     ? rb.getString(&quot;The.signer.certificate.s.NetscapeCertType.extension.doesn.t.allow.code.signing.&quot;)</span>
<span class="line-modified">1077                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.s.NetscapeCertType.extension.doesn.t.allow.code.signing.&quot;));</span>
<span class="line-modified">1078         }</span>
1079 
<span class="line-modified">1080         // only in verifying</span>
<span class="line-modified">1081         if (hasUnsignedEntry) {</span>
<span class="line-modified">1082             errors.add(rb.getString(</span>
<span class="line-modified">1083                     &quot;This.jar.contains.unsigned.entries.which.have.not.been.integrity.checked.&quot;));</span>
<span class="line-modified">1084         }</span>
1085 
<span class="line-modified">1086         if (hasExpiredCert) {</span>
<span class="line-modified">1087             errors.add(isSigning</span>
<span class="line-modified">1088                     ? rb.getString(&quot;The.signer.certificate.has.expired.&quot;)</span>
<span class="line-modified">1089                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.has.expired.&quot;));</span>
<span class="line-modified">1090         }</span>










1091 
<span class="line-modified">1092         if (notYetValidCert) {</span>
<span class="line-modified">1093             errors.add(isSigning</span>
<span class="line-modified">1094                     ? rb.getString(&quot;The.signer.certificate.is.not.yet.valid.&quot;)</span>
<span class="line-modified">1095                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.is.not.yet.valid.&quot;));</span>
<span class="line-modified">1096         }</span>

1097 
<span class="line-modified">1098         if (chainNotValidated) {</span>
<span class="line-modified">1099             errors.add(String.format(isSigning</span>
<span class="line-modified">1100                             ? rb.getString(&quot;The.signer.s.certificate.chain.is.invalid.reason.1&quot;)</span>
<span class="line-modified">1101                             : rb.getString(&quot;This.jar.contains.entries.whose.certificate.chain.is.invalid.reason.1&quot;),</span>
<span class="line-modified">1102                     chainNotValidatedReason.getLocalizedMessage()));</span>
<span class="line-modified">1103         }</span>



1104 
<span class="line-modified">1105         if (tsaChainNotValidated) {</span>
<span class="line-modified">1106             errors.add(String.format(isSigning</span>
<span class="line-modified">1107                             ? rb.getString(&quot;The.tsa.certificate.chain.is.invalid.reason.1&quot;)</span>
<span class="line-modified">1108                             : rb.getString(&quot;This.jar.contains.entries.whose.tsa.certificate.chain.is.invalid.reason.1&quot;),</span>
<span class="line-added">1109                     tsaChainNotValidatedReason.getLocalizedMessage()));</span>
<span class="line-added">1110         }</span>
<span class="line-added">1111 </span>
<span class="line-added">1112         // only in verifying</span>
<span class="line-added">1113         if (notSignedByAlias) {</span>
<span class="line-added">1114             errors.add(</span>
<span class="line-added">1115                     rb.getString(&quot;This.jar.contains.signed.entries.which.is.not.signed.by.the.specified.alias.es.&quot;));</span>
<span class="line-added">1116         }</span>
<span class="line-added">1117 </span>
<span class="line-added">1118         // only in verifying</span>
<span class="line-added">1119         if (aliasNotInStore) {</span>
<span class="line-added">1120             errors.add(rb.getString(&quot;This.jar.contains.signed.entries.that.s.not.signed.by.alias.in.this.keystore.&quot;));</span>
<span class="line-added">1121         }</span>
<span class="line-added">1122 </span>
<span class="line-added">1123         if (signerSelfSigned) {</span>
<span class="line-added">1124             errors.add(isSigning</span>
<span class="line-added">1125                     ? rb.getString(&quot;The.signer.s.certificate.is.self.signed.&quot;)</span>
<span class="line-added">1126                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.is.self.signed.&quot;));</span>
<span class="line-added">1127         }</span>
<span class="line-added">1128 </span>
<span class="line-added">1129         if (isSigning) {</span>
<span class="line-added">1130             if ((legacyAlg &amp; 1) == 1) {</span>
<span class="line-added">1131                 warnings.add(String.format(</span>
<span class="line-added">1132                         rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-added">1133                         digestalg, &quot;-digestalg&quot;));</span>
1134             }
1135 
<span class="line-modified">1136             if ((disabledAlg &amp; 1) == 1) {</span>
<span class="line-modified">1137                 errors.add(String.format(</span>
<span class="line-modified">1138                         rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-added">1139                         digestalg, &quot;-digestalg&quot;));</span>
1140             }
1141 
<span class="line-modified">1142             if ((legacyAlg &amp; 2) == 2) {</span>
<span class="line-modified">1143                 warnings.add(String.format(</span>
<span class="line-modified">1144                         rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1145                         sigalg, &quot;-sigalg&quot;));</span>
1146             }
1147 
<span class="line-modified">1148             if ((disabledAlg &amp; 2) == 2) {</span>
<span class="line-modified">1149                 errors.add(String.format(</span>
<span class="line-modified">1150                         rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-modified">1151                         sigalg, &quot;-sigalg&quot;));</span>
<span class="line-modified">1152             }</span>

1153 
<span class="line-modified">1154             if ((legacyAlg &amp; 4) == 4) {</span>
<span class="line-modified">1155                 warnings.add(String.format(</span>
<span class="line-modified">1156                         rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1157                         tSADigestAlg, &quot;-tsadigestalg&quot;));</span>
<span class="line-modified">1158             }</span>
1159 
<span class="line-modified">1160             if ((disabledAlg &amp; 4) == 4) {</span>
<span class="line-modified">1161                 errors.add(String.format(</span>
<span class="line-modified">1162                         rb.getString(&quot;The.1.algorithm.specified.for.the.2.option.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-modified">1163                         tSADigestAlg, &quot;-tsadigestalg&quot;));</span>
<span class="line-modified">1164             }</span>





1165 
<span class="line-modified">1166             if ((legacyAlg &amp; 8) == 8) {</span>
<span class="line-modified">1167                 warnings.add(String.format(</span>
<span class="line-modified">1168                         rb.getString(&quot;The.1.signing.key.has.a.keysize.of.2.which.is.considered.a.security.risk..This.key.size.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1169                         privateKey.getAlgorithm(), KeyUtil.getKeySize(privateKey)));</span>
<span class="line-modified">1170             }</span>





1171 
<span class="line-modified">1172             if ((disabledAlg &amp; 8) == 8) {</span>
<span class="line-modified">1173                 errors.add(String.format(</span>
<span class="line-modified">1174                         rb.getString(&quot;The.1.signing.key.has.a.keysize.of.2.which.is.considered.a.security.risk.and.is.disabled.&quot;),</span>
<span class="line-modified">1175                         privateKey.getAlgorithm(), KeyUtil.getKeySize(privateKey)));</span>
<span class="line-modified">1176             }</span>
<span class="line-modified">1177         } else {</span>
<span class="line-modified">1178             if ((legacyAlg &amp; 1) != 0) {</span>
<span class="line-modified">1179                 warnings.add(String.format(</span>
<span class="line-modified">1180                         rb.getString(&quot;The.digest.algorithm.1.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1181                         legacyDigestAlg));</span>
<span class="line-modified">1182             }</span>





1183 
<span class="line-modified">1184             if ((legacyAlg &amp; 2) == 2) {</span>
<span class="line-modified">1185                 warnings.add(String.format(</span>
<span class="line-modified">1186                         rb.getString(&quot;The.signature.algorithm.1.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1187                         legacySigAlg));</span>
<span class="line-modified">1188             }</span>
1189 
<span class="line-modified">1190             if ((legacyAlg &amp; 4) != 0) {</span>
<span class="line-modified">1191                 warnings.add(String.format(</span>
<span class="line-modified">1192                         rb.getString(&quot;The.timestamp.digest.algorithm.1.is.considered.a.security.risk..This.algorithm.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1193                         legacyTsaDigestAlg));</span>
<span class="line-modified">1194             }</span>
1195 
<span class="line-modified">1196             if ((legacyAlg &amp; 8) == 8) {</span>
<span class="line-modified">1197                 warnings.add(String.format(</span>
<span class="line-modified">1198                         rb.getString(&quot;The.1.signing.key.has.a.keysize.of.2.which.is.considered.a.security.risk..This.key.size.will.be.disabled.in.a.future.update.&quot;),</span>
<span class="line-modified">1199                         weakPublicKey.getAlgorithm(), KeyUtil.getKeySize(weakPublicKey)));</span>

1200             }


1201         }
1202 
<span class="line-added">1203         // This check must be placed after all other &quot;errors.add()&quot; calls were done.</span>
1204         if (hasExpiredTsaCert) {
1205             // No need to warn about expiring if already expired
1206             hasExpiringTsaCert = false;
<span class="line-modified">1207             // If there are already another errors, we just say it expired.</span>
<span class="line-modified">1208             if (!signerNotExpired || !errors.isEmpty()) {</span>
<span class="line-modified">1209                 errors.add(rb.getString(&quot;The.timestamp.has.expired.&quot;));</span>
<span class="line-modified">1210             } else if (signerNotExpired) {</span>





1211                 if (expireDate != null) {
1212                     warnings.add(String.format(
1213                             rb.getString(&quot;The.timestamp.expired.1.but.usable.2&quot;),
1214                             tsaExpireDate,
1215                             expireDate));
1216                 }
1217                 // Reset the flag so exit code is 0
1218                 hasExpiredTsaCert = false;
1219             }
<span class="line-modified">1220         }</span>
<span class="line-modified">1221 </span>
<span class="line-modified">1222         if (hasExpiringCert) {</span>
<span class="line-modified">1223             warnings.add(isSigning</span>
<span class="line-modified">1224                     ? rb.getString(&quot;The.signer.certificate.will.expire.within.six.months.&quot;)</span>
<span class="line-modified">1225                     : rb.getString(&quot;This.jar.contains.entries.whose.signer.certificate.will.expire.within.six.months.&quot;));</span>
<span class="line-modified">1226         }</span>
<span class="line-modified">1227 </span>
<span class="line-modified">1228         if (hasExpiringTsaCert &amp;&amp; expireDate != null) {</span>
<span class="line-modified">1229             if (expireDate.after(tsaExpireDate)) {</span>
<span class="line-modified">1230                 warnings.add(String.format(rb.getString(</span>
<span class="line-modified">1231                         &quot;The.timestamp.will.expire.within.one.year.on.1.but.2&quot;), tsaExpireDate, expireDate));</span>
<span class="line-modified">1232             } else {</span>
<span class="line-modified">1233                 warnings.add(String.format(rb.getString(</span>
<span class="line-modified">1234                         &quot;The.timestamp.will.expire.within.one.year.on.1&quot;), tsaExpireDate));</span>









1235             }
<span class="line-modified">1236         }</span>
<span class="line-modified">1237 </span>
<span class="line-added">1238         if (noTimestamp &amp;&amp; expireDate != null) {</span>
<span class="line-added">1239             if (hasTimestampBlock) {</span>
<span class="line-added">1240                 warnings.add(String.format(isSigning</span>
<span class="line-added">1241                         ? rb.getString(&quot;invalid.timestamp.signing&quot;)</span>
<span class="line-added">1242                         : rb.getString(&quot;bad.timestamp.verifying&quot;), expireDate));</span>
<span class="line-added">1243             } else {</span>
<span class="line-added">1244                 warnings.add(String.format(isSigning</span>
<span class="line-added">1245                         ? rb.getString(&quot;no.timestamp.signing&quot;)</span>
<span class="line-added">1246                         : rb.getString(&quot;no.timestamp.verifying&quot;), expireDate));</span>
1247             }
1248         }
1249 
<span class="line-added">1250         if (permsDetected) {</span>
<span class="line-added">1251             warnings.add(rb.getString(&quot;posix.attributes.detected&quot;));</span>
<span class="line-added">1252         }</span>
<span class="line-added">1253 </span>
<span class="line-added">1254         if ((strict) &amp;&amp; (!errors.isEmpty())) {</span>
<span class="line-added">1255             result = isSigning</span>
<span class="line-added">1256                     ? rb.getString(&quot;jar.signed.with.signer.errors.&quot;)</span>
<span class="line-added">1257                     : rb.getString(&quot;jar.verified.with.signer.errors.&quot;);</span>
<span class="line-added">1258         } else {</span>
<span class="line-added">1259             result = isSigning</span>
<span class="line-added">1260                     ? rb.getString(&quot;jar.signed.&quot;)</span>
<span class="line-added">1261                     : rb.getString(&quot;jar.verified.&quot;);</span>
<span class="line-added">1262         }</span>
1263         System.out.println(result);
<span class="line-added">1264 </span>
1265         if (strict) {
1266             if (!errors.isEmpty()) {
1267                 System.out.println();
1268                 System.out.println(rb.getString(&quot;Error.&quot;));
1269                 errors.forEach(System.out::println);
1270             }
1271             if (!warnings.isEmpty()) {
1272                 System.out.println();
1273                 System.out.println(rb.getString(&quot;Warning.&quot;));
1274                 warnings.forEach(System.out::println);
1275             }
1276         } else {
1277             if (!errors.isEmpty() || !warnings.isEmpty()) {
1278                 System.out.println();
1279                 System.out.println(rb.getString(&quot;Warning.&quot;));
1280                 errors.forEach(System.out::println);
1281                 warnings.forEach(System.out::println);
1282             }
1283         }
<span class="line-added">1284 </span>
1285         if (!isSigning &amp;&amp; (!errors.isEmpty() || !warnings.isEmpty())) {
1286             if (! (verbose != null &amp;&amp; showcerts)) {
1287                 System.out.println();
1288                 System.out.println(rb.getString(
1289                         &quot;Re.run.with.the.verbose.and.certs.options.for.more.details.&quot;));
1290             }
1291         }
1292 
1293         if (isSigning || verbose != null) {
1294             // Always print out expireDate, unless expired or expiring.
1295             if (!hasExpiringCert &amp;&amp; !hasExpiredCert
1296                     &amp;&amp; expireDate != null &amp;&amp; signerNotExpired) {
1297                 info.add(String.format(rb.getString(
1298                         &quot;The.signer.certificate.will.expire.on.1.&quot;), expireDate));
1299             }
1300             if (!noTimestamp) {
1301                 if (!hasExpiringTsaCert &amp;&amp; !hasExpiredTsaCert &amp;&amp; tsaExpireDate != null) {
1302                     if (signerNotExpired) {
1303                         info.add(String.format(rb.getString(
1304                                 &quot;The.timestamp.will.expire.on.1.&quot;), tsaExpireDate));
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../jdk.internal.vm.ci/share/classes/jdk.vm.ci.hotspot/src/jdk/vm/ci/hotspot/HotSpotJVMCIRuntime.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../man/jar.1.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>