<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/interpreter/Bytecodes.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2001, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot.interpreter;
 26 
 27 import java.util.*;
 28 import sun.jvm.hotspot.oops.*;
 29 import sun.jvm.hotspot.runtime.*;
 30 import sun.jvm.hotspot.utilities.*;
 31 import sun.jvm.hotspot.utilities.Observable;
 32 import sun.jvm.hotspot.utilities.Observer;
 33 
 34 // Bytecodes specifies all bytecodes used in the VM and
 35 // provides utility functions to get bytecode attributes.
 36 
 37 public class Bytecodes {
 38   public static final int _illegal    =  -1;
 39 
 40   // Java bytecodes
 41   public static final int _nop                  =   0; // 0x00
 42   public static final int _aconst_null          =   1; // 0x01
 43   public static final int _iconst_m1            =   2; // 0x02
 44   public static final int _iconst_0             =   3; // 0x03
 45   public static final int _iconst_1             =   4; // 0x04
 46   public static final int _iconst_2             =   5; // 0x05
 47   public static final int _iconst_3             =   6; // 0x06
 48   public static final int _iconst_4             =   7; // 0x07
 49   public static final int _iconst_5             =   8; // 0x08
 50   public static final int _lconst_0             =   9; // 0x09
 51   public static final int _lconst_1             =  10; // 0x0a
 52   public static final int _fconst_0             =  11; // 0x0b
 53   public static final int _fconst_1             =  12; // 0x0c
 54   public static final int _fconst_2             =  13; // 0x0d
 55   public static final int _dconst_0             =  14; // 0x0e
 56   public static final int _dconst_1             =  15; // 0x0f
 57   public static final int _bipush               =  16; // 0x10
 58   public static final int _sipush               =  17; // 0x11
 59   public static final int _ldc                  =  18; // 0x12
 60   public static final int _ldc_w                =  19; // 0x13
 61   public static final int _ldc2_w               =  20; // 0x14
 62   public static final int _iload                =  21; // 0x15
 63   public static final int _lload                =  22; // 0x16
 64   public static final int _fload                =  23; // 0x17
 65   public static final int _dload                =  24; // 0x18
 66   public static final int _aload                =  25; // 0x19
 67   public static final int _iload_0              =  26; // 0x1a
 68   public static final int _iload_1              =  27; // 0x1b
 69   public static final int _iload_2              =  28; // 0x1c
 70   public static final int _iload_3              =  29; // 0x1d
 71   public static final int _lload_0              =  30; // 0x1e
 72   public static final int _lload_1              =  31; // 0x1f
 73   public static final int _lload_2              =  32; // 0x20
 74   public static final int _lload_3              =  33; // 0x21
 75   public static final int _fload_0              =  34; // 0x22
 76   public static final int _fload_1              =  35; // 0x23
 77   public static final int _fload_2              =  36; // 0x24
 78   public static final int _fload_3              =  37; // 0x25
 79   public static final int _dload_0              =  38; // 0x26
 80   public static final int _dload_1              =  39; // 0x27
 81   public static final int _dload_2              =  40; // 0x28
 82   public static final int _dload_3              =  41; // 0x29
 83   public static final int _aload_0              =  42; // 0x2a
 84   public static final int _aload_1              =  43; // 0x2b
 85   public static final int _aload_2              =  44; // 0x2c
 86   public static final int _aload_3              =  45; // 0x2d
 87   public static final int _iaload               =  46; // 0x2e
 88   public static final int _laload               =  47; // 0x2f
 89   public static final int _faload               =  48; // 0x30
 90   public static final int _daload               =  49; // 0x31
 91   public static final int _aaload               =  50; // 0x32
 92   public static final int _baload               =  51; // 0x33
 93   public static final int _caload               =  52; // 0x34
 94   public static final int _saload               =  53; // 0x35
 95   public static final int _istore               =  54; // 0x36
 96   public static final int _lstore               =  55; // 0x37
 97   public static final int _fstore               =  56; // 0x38
 98   public static final int _dstore               =  57; // 0x39
 99   public static final int _astore               =  58; // 0x3a
100   public static final int _istore_0             =  59; // 0x3b
101   public static final int _istore_1             =  60; // 0x3c
102   public static final int _istore_2             =  61; // 0x3d
103   public static final int _istore_3             =  62; // 0x3e
104   public static final int _lstore_0             =  63; // 0x3f
105   public static final int _lstore_1             =  64; // 0x40
106   public static final int _lstore_2             =  65; // 0x41
107   public static final int _lstore_3             =  66; // 0x42
108   public static final int _fstore_0             =  67; // 0x43
109   public static final int _fstore_1             =  68; // 0x44
110   public static final int _fstore_2             =  69; // 0x45
111   public static final int _fstore_3             =  70; // 0x46
112   public static final int _dstore_0             =  71; // 0x47
113   public static final int _dstore_1             =  72; // 0x48
114   public static final int _dstore_2             =  73; // 0x49
115   public static final int _dstore_3             =  74; // 0x4a
116   public static final int _astore_0             =  75; // 0x4b
117   public static final int _astore_1             =  76; // 0x4c
118   public static final int _astore_2             =  77; // 0x4d
119   public static final int _astore_3             =  78; // 0x4e
120   public static final int _iastore              =  79; // 0x4f
121   public static final int _lastore              =  80; // 0x50
122   public static final int _fastore              =  81; // 0x51
123   public static final int _dastore              =  82; // 0x52
124   public static final int _aastore              =  83; // 0x53
125   public static final int _bastore              =  84; // 0x54
126   public static final int _castore              =  85; // 0x55
127   public static final int _sastore              =  86; // 0x56
128   public static final int _pop                  =  87; // 0x57
129   public static final int _pop2                 =  88; // 0x58
130   public static final int _dup                  =  89; // 0x59
131   public static final int _dup_x1               =  90; // 0x5a
132   public static final int _dup_x2               =  91; // 0x5b
133   public static final int _dup2                 =  92; // 0x5c
134   public static final int _dup2_x1              =  93; // 0x5d
135   public static final int _dup2_x2              =  94; // 0x5e
136   public static final int _swap                 =  95; // 0x5f
137   public static final int _iadd                 =  96; // 0x60
138   public static final int _ladd                 =  97; // 0x61
139   public static final int _fadd                 =  98; // 0x62
140   public static final int _dadd                 =  99; // 0x63
141   public static final int _isub                 = 100; // 0x64
142   public static final int _lsub                 = 101; // 0x65
143   public static final int _fsub                 = 102; // 0x66
144   public static final int _dsub                 = 103; // 0x67
145   public static final int _imul                 = 104; // 0x68
146   public static final int _lmul                 = 105; // 0x69
147   public static final int _fmul                 = 106; // 0x6a
148   public static final int _dmul                 = 107; // 0x6b
149   public static final int _idiv                 = 108; // 0x6c
150   public static final int _ldiv                 = 109; // 0x6d
151   public static final int _fdiv                 = 110; // 0x6e
152   public static final int _ddiv                 = 111; // 0x6f
153   public static final int _irem                 = 112; // 0x70
154   public static final int _lrem                 = 113; // 0x71
155   public static final int _frem                 = 114; // 0x72
156   public static final int _drem                 = 115; // 0x73
157   public static final int _ineg                 = 116; // 0x74
158   public static final int _lneg                 = 117; // 0x75
159   public static final int _fneg                 = 118; // 0x76
160   public static final int _dneg                 = 119; // 0x77
161   public static final int _ishl                 = 120; // 0x78
162   public static final int _lshl                 = 121; // 0x79
163   public static final int _ishr                 = 122; // 0x7a
164   public static final int _lshr                 = 123; // 0x7b
165   public static final int _iushr                = 124; // 0x7c
166   public static final int _lushr                = 125; // 0x7d
167   public static final int _iand                 = 126; // 0x7e
168   public static final int _land                 = 127; // 0x7f
169   public static final int _ior                  = 128; // 0x80
170   public static final int _lor                  = 129; // 0x81
171   public static final int _ixor                 = 130; // 0x82
172   public static final int _lxor                 = 131; // 0x83
173   public static final int _iinc                 = 132; // 0x84
174   public static final int _i2l                  = 133; // 0x85
175   public static final int _i2f                  = 134; // 0x86
176   public static final int _i2d                  = 135; // 0x87
177   public static final int _l2i                  = 136; // 0x88
178   public static final int _l2f                  = 137; // 0x89
179   public static final int _l2d                  = 138; // 0x8a
180   public static final int _f2i                  = 139; // 0x8b
181   public static final int _f2l                  = 140; // 0x8c
182   public static final int _f2d                  = 141; // 0x8d
183   public static final int _d2i                  = 142; // 0x8e
184   public static final int _d2l                  = 143; // 0x8f
185   public static final int _d2f                  = 144; // 0x90
186   public static final int _i2b                  = 145; // 0x91
187   public static final int _i2c                  = 146; // 0x92
188   public static final int _i2s                  = 147; // 0x93
189   public static final int _lcmp                 = 148; // 0x94
190   public static final int _fcmpl                = 149; // 0x95
191   public static final int _fcmpg                = 150; // 0x96
192   public static final int _dcmpl                = 151; // 0x97
193   public static final int _dcmpg                = 152; // 0x98
194   public static final int _ifeq                 = 153; // 0x99
195   public static final int _ifne                 = 154; // 0x9a
196   public static final int _iflt                 = 155; // 0x9b
197   public static final int _ifge                 = 156; // 0x9c
198   public static final int _ifgt                 = 157; // 0x9d
199   public static final int _ifle                 = 158; // 0x9e
200   public static final int _if_icmpeq            = 159; // 0x9f
201   public static final int _if_icmpne            = 160; // 0xa0
202   public static final int _if_icmplt            = 161; // 0xa1
203   public static final int _if_icmpge            = 162; // 0xa2
204   public static final int _if_icmpgt            = 163; // 0xa3
205   public static final int _if_icmple            = 164; // 0xa4
206   public static final int _if_acmpeq            = 165; // 0xa5
207   public static final int _if_acmpne            = 166; // 0xa6
208   public static final int _goto                 = 167; // 0xa7
209   public static final int _jsr                  = 168; // 0xa8
210   public static final int _ret                  = 169; // 0xa9
211   public static final int _tableswitch          = 170; // 0xaa
212   public static final int _lookupswitch         = 171; // 0xab
213   public static final int _ireturn              = 172; // 0xac
214   public static final int _lreturn              = 173; // 0xad
215   public static final int _freturn              = 174; // 0xae
216   public static final int _dreturn              = 175; // 0xaf
217   public static final int _areturn              = 176; // 0xb0
218   public static final int _return               = 177; // 0xb1
219   public static final int _getstatic            = 178; // 0xb2
220   public static final int _putstatic            = 179; // 0xb3
221   public static final int _getfield             = 180; // 0xb4
222   public static final int _putfield             = 181; // 0xb5
223   public static final int _invokevirtual        = 182; // 0xb6
224   public static final int _invokespecial        = 183; // 0xb7
225   public static final int _invokestatic         = 184; // 0xb8
226   public static final int _invokeinterface      = 185; // 0xb9
227   public static final int _invokedynamic        = 186; // 0xba
228   public static final int _new                  = 187; // 0xbb
229   public static final int _newarray             = 188; // 0xbc
230   public static final int _anewarray            = 189; // 0xbd
231   public static final int _arraylength          = 190; // 0xbe
232   public static final int _athrow               = 191; // 0xbf
233   public static final int _checkcast            = 192; // 0xc0
234   public static final int _instanceof           = 193; // 0xc1
235   public static final int _monitorenter         = 194; // 0xc2
236   public static final int _monitorexit          = 195; // 0xc3
237   public static final int _wide                 = 196; // 0xc4
238   public static final int _multianewarray       = 197; // 0xc5
239   public static final int _ifnull               = 198; // 0xc6
240   public static final int _ifnonnull            = 199; // 0xc7
241   public static final int _goto_w               = 200; // 0xc8
242   public static final int _jsr_w                = 201; // 0xc9
243   public static final int _breakpoint           = 202; // 0xca
<a name="1" id="anc1"></a>

244 
<a name="2" id="anc2"></a><span class="line-modified">245   public static final int number_of_java_codes  = 203;</span>
246 
247   // JVM bytecodes
248   public static final int _fast_agetfield       = number_of_java_codes;
<a name="3" id="anc3"></a><span class="line-modified">249   public static final int _fast_bgetfield       = 204;</span>
<span class="line-modified">250   public static final int _fast_cgetfield       = 205;</span>
<span class="line-modified">251   public static final int _fast_dgetfield       = 206;</span>
<span class="line-modified">252   public static final int _fast_fgetfield       = 207;</span>
<span class="line-modified">253   public static final int _fast_igetfield       = 208;</span>
<span class="line-modified">254   public static final int _fast_lgetfield       = 209;</span>
<span class="line-modified">255   public static final int _fast_sgetfield       = 210;</span>
<span class="line-modified">256   public static final int _fast_aputfield       = 211;</span>
<span class="line-modified">257   public static final int _fast_bputfield       = 212;</span>
<span class="line-modified">258   public static final int _fast_zputfield       = 213;</span>
<span class="line-modified">259   public static final int _fast_cputfield       = 214;</span>
<span class="line-modified">260   public static final int _fast_dputfield       = 215;</span>
<span class="line-modified">261   public static final int _fast_fputfield       = 216;</span>
<span class="line-modified">262   public static final int _fast_iputfield       = 217;</span>
<span class="line-modified">263   public static final int _fast_lputfield       = 218;</span>
<span class="line-modified">264   public static final int _fast_sputfield       = 219;</span>
<span class="line-modified">265   public static final int _fast_aload_0         = 220;</span>
<span class="line-modified">266   public static final int _fast_iaccess_0       = 221;</span>
<span class="line-modified">267   public static final int _fast_aaccess_0       = 222;</span>
<span class="line-modified">268   public static final int _fast_faccess_0       = 223;</span>
<span class="line-modified">269   public static final int _fast_iload           = 224;</span>
<span class="line-modified">270   public static final int _fast_iload2          = 225;</span>
<span class="line-modified">271   public static final int _fast_icaload         = 226;</span>
<span class="line-modified">272   public static final int _fast_invokevfinal    = 227;</span>
<span class="line-modified">273   public static final int _fast_linearswitch    = 228;</span>
<span class="line-modified">274   public static final int _fast_binaryswitch    = 229;</span>
<span class="line-modified">275   public static final int _fast_aldc            = 230;</span>
<span class="line-modified">276   public static final int _fast_aldc_w          = 231;</span>
<span class="line-modified">277   public static final int _return_register_finalizer = 232;</span>
<span class="line-modified">278   public static final int _invokehandle         = 233;</span>


279 
280   // Bytecodes rewritten at CDS dump time
<a name="4" id="anc4"></a><span class="line-modified">281   public static final int _nofast_getfield      = 234;</span>
<span class="line-modified">282   public static final int _nofast_putfield      = 235;</span>
<span class="line-modified">283   public static final int _nofast_aload_0       = 236;</span>
<span class="line-modified">284   public static final int _nofast_iload         = 237;</span>
<span class="line-modified">285   public static final int _shouldnotreachhere   = 238; // For debugging</span>
286 
<a name="5" id="anc5"></a><span class="line-modified">287   public static final int number_of_codes       = 239;</span>
288 
289   // Flag bits derived from format strings, can_trap, can_rewrite, etc.:
290   // semantic flags:
291   static final int  _bc_can_trap      = 1&lt;&lt;0;     // bytecode execution can trap or block
292   static final int  _bc_can_rewrite   = 1&lt;&lt;1;     // bytecode execution has an alternate form
293 
294   // format bits (determined only by the format string):
295   static final int  _fmt_has_c        = 1&lt;&lt;2;     // constant, such as sipush &quot;bcc&quot;
296   static final int  _fmt_has_j        = 1&lt;&lt;3;     // constant pool cache index, such as getfield &quot;bjj&quot;
297   static final int  _fmt_has_k        = 1&lt;&lt;4;     // constant pool index, such as ldc &quot;bk&quot;
298   static final int  _fmt_has_i        = 1&lt;&lt;5;     // local index, such as iload
299   static final int  _fmt_has_o        = 1&lt;&lt;6;     // offset, such as ifeq
300   static final int  _fmt_has_nbo      = 1&lt;&lt;7;     // contains native-order field(s)
301   static final int  _fmt_has_u2       = 1&lt;&lt;8;     // contains double-byte field(s)
302   static final int  _fmt_has_u4       = 1&lt;&lt;9;     // contains quad-byte field
303   static final int  _fmt_not_variable = 1&lt;&lt;10;    // not of variable length (simple or wide)
304   static final int  _fmt_not_simple   = 1&lt;&lt;11;    // either wide or variable length
305   static final int  _all_fmt_bits     = (_fmt_not_simple*2 - _fmt_has_c);
306 
307   // Example derived format syndromes:
308   static final int  _fmt_b      = _fmt_not_variable;
309   static final int  _fmt_bc     = _fmt_b | _fmt_has_c;
310   static final int  _fmt_bi     = _fmt_b | _fmt_has_i;
311   static final int  _fmt_bkk    = _fmt_b | _fmt_has_k | _fmt_has_u2;
312   static final int  _fmt_bJJ    = _fmt_b | _fmt_has_j | _fmt_has_u2 | _fmt_has_nbo;
313   static final int  _fmt_bo2    = _fmt_b | _fmt_has_o | _fmt_has_u2;
314   static final int  _fmt_bo4    = _fmt_b | _fmt_has_o | _fmt_has_u4;
315 
316 
317   public static int specialLengthAt(Method method, int bci) {
318     int code = codeAt(method, bci);
319     switch (code) {
320     case _wide:
321       return wideLengthFor(method.getBytecodeOrBPAt(bci + 1));
322     case _tableswitch:
323       {
324         int alignedBCI = Bits.roundTo(bci + 1, jintSize);
325         int lo = method.getBytecodeIntArg(alignedBCI + 1*jintSize);
326         int hi = method.getBytecodeIntArg(alignedBCI + 2*jintSize);
327         return (alignedBCI - bci) + (3 + hi - lo + 1)*jintSize;
328       }
329 
330     case _lookupswitch:      // fall through
331     case _fast_binaryswitch: // fall through
332     case _fast_linearswitch:
333       {
334         int alignedBCI = Bits.roundTo(bci + 1, jintSize);
335         int npairs = method.getBytecodeIntArg(alignedBCI + jintSize);
336         return (alignedBCI - bci) + (2 + 2*npairs)*jintSize;
337       }
338 
339     }
340     throw new RuntimeException(&quot;should not reach here&quot;);
341   }
342 
343   // Conversion
344   public static void check(int code) {
345     if (Assert.ASSERTS_ENABLED) {
346       Assert.that(isDefined(code), &quot;illegal code &quot; + code);
347     }
348   }
349   public static void wideCheck(int code) {
350     if (Assert.ASSERTS_ENABLED) {
351       Assert.that(wideIsDefined(code), &quot;illegal code &quot; + code);
352     }
353   }
354 
355   /** Fetches a bytecode, hiding breakpoints as necessary */
356   public static int codeAt(Method method, int bci) {
357     int res = codeOrBPAt(method, bci);
358     if (res == _breakpoint) {
359       res = method.getOrigBytecodeAt(bci);
360     }
361     return res;
362   }
363 
364   /** Fetches a bytecode or a breakpoint */
365   public static int codeOrBPAt(Method method, int bci) {
366     return method.getBytecodeOrBPAt(bci);
367   }
368 
369   public static boolean isActiveBreakpointAt(Method method, int bci) {
370     return (codeOrBPAt(method, bci) == _breakpoint);
371   }
372 
373   // find a bytecode, behind a breakpoint if necessary:
374   // FIXME: not yet implementable
375   //   static Code       non_breakpoint_code_at(address bcp, Method* method = null);
376 
377   // Bytecode attributes
378   public static boolean   isDefined    (int code) { return 0 &lt;= code &amp;&amp; code &lt; number_of_codes &amp;&amp; flags(code, false) != 0; }
379   public static boolean   wideIsDefined(int code) { return isDefined(code) &amp;&amp; flags(code, true) != 0; }
380   public static String    name         (int code) { check(code);      return _name          [code]; }
381   public static String    format       (int code) { check(code);      return _format        [code]; }
382   public static String    wideFormat   (int code) { wideCheck(code);  return _wide_format   [code]; }
383   public static int       resultType   (int code) { check(code);      return _result_type   [code]; }
384   public static int       depth        (int code) { check(code);      return _depth         [code]; }
385   public static int       lengthFor    (int code) { check(code);      return _lengths       [code] &amp; 0xF; }
386   public static int       wideLengthFor(int code) { check(code);      return _lengths       [code] &gt;&gt; 4; }
387   public static boolean   canTrap      (int code) { check(code);      return has_all_flags(code, _bc_can_trap, false); }
388   public static int       javaCode     (int code) { check(code);      return _java_code     [code]; }
389   public static boolean   canRewrite   (int code) { check(code);      return has_all_flags(code, _bc_can_rewrite, false); }
390   public static boolean   native_byte_order(int code)  { check(code);      return has_all_flags(code, _fmt_has_nbo, false); }
391   public static boolean   uses_cp_cache  (int code)    { check(code);      return has_all_flags(code, _fmt_has_j, false); }
392   public static int       lengthAt     (Method method, int bci) { int l = lengthFor(codeAt(method, bci)); return l &gt; 0 ? l : specialLengthAt(method, bci); }
393   public static int       javaLengthAt (Method method, int bci) { int l = lengthFor(javaCode(codeAt(method, bci))); return l &gt; 0 ? l : specialLengthAt(method, bci); }
394   public static boolean   isJavaCode   (int code) { return 0 &lt;= code &amp;&amp; code &lt; number_of_java_codes; }
395   public static boolean   isFastCode   (int code) { return number_of_java_codes &lt;= code &amp;&amp; code &lt; number_of_codes; }
396 
397   public static boolean   isAload      (int code) { return (code == _aload  || code == _aload_0  || code == _aload_1
398                                                                             || code == _aload_2  || code == _aload_3); }
399   public static boolean   isAstore     (int code) { return (code == _astore || code == _astore_0 || code == _astore_1
400                                                                             || code == _astore_2 || code == _astore_3); }
401 
402   public static boolean   isZeroConst  (int code) { return (code == _aconst_null || code == _iconst_0
403                                                                                  || code == _fconst_0 || code == _dconst_0); }
404 
405   static int         flags          (int code, boolean is_wide) {
406     assert code == (code &amp; 0xff) : &quot;must be a byte&quot;;
407     return _flags[code + (is_wide ? 256 : 0)];
408   }
409   static int         format_bits    (int code, boolean is_wide) { return flags(code, is_wide) &amp; _all_fmt_bits; }
410   static boolean     has_all_flags  (int code, int test_flags, boolean is_wide) {
411     return (flags(code, is_wide) &amp; test_flags) == test_flags;
412   }
413 
414   static char compute_flags(String format) {
415     return compute_flags(format, 0);
416   }
417   static char compute_flags(String format, int more_flags) {
418     if (format == null)  return 0;  // not even more_flags
419     int flags = more_flags;
420     int fp = 0;
421     if (format.length() == 0) {
422       flags |= _fmt_not_simple; // but variable
423     } else {
424       switch (format.charAt(fp)) {
425       case &#39;b&#39;:
426         flags |= _fmt_not_variable;  // but simple
427         ++fp;  // skip &#39;b&#39;
428         break;
429       case &#39;w&#39;:
430         flags |= _fmt_not_variable | _fmt_not_simple;
431         ++fp;  // skip &#39;w&#39;
432       assert(format.charAt(fp) == &#39;b&#39;) : &quot;wide format must start with &#39;wb&#39;&quot;;
433         ++fp;  // skip &#39;b&#39;
434         break;
435       }
436     }
437 
438     boolean has_nbo = false, has_jbo = false;
439     int has_size = 0;
440     while (fp &lt; format.length()) {
441       int this_flag = 0;
442       char fc = format.charAt(fp++);
443       switch (fc) {
444       case &#39;_&#39;: continue;         // ignore these
445 
446       case &#39;j&#39;: this_flag = _fmt_has_j; has_jbo = true; break;
447       case &#39;k&#39;: this_flag = _fmt_has_k; has_jbo = true; break;
448       case &#39;i&#39;: this_flag = _fmt_has_i; has_jbo = true; break;
449       case &#39;c&#39;: this_flag = _fmt_has_c; has_jbo = true; break;
450       case &#39;o&#39;: this_flag = _fmt_has_o; has_jbo = true; break;
451 
452         // uppercase versions mark native byte order (from Rewriter)
453         // actually, only the &#39;J&#39; case happens currently
454       case &#39;J&#39;: this_flag = _fmt_has_j; has_nbo = true; break;
455       case &#39;K&#39;: this_flag = _fmt_has_k; has_nbo = true; break;
456       case &#39;I&#39;: this_flag = _fmt_has_i; has_nbo = true; break;
457       case &#39;C&#39;: this_flag = _fmt_has_c; has_nbo = true; break;
458       case &#39;O&#39;: this_flag = _fmt_has_o; has_nbo = true; break;
459       default:  assert false : &quot;bad char in format&quot;;
460       }
461 
462       flags |= this_flag;
463 
464       assert !(has_jbo &amp;&amp; has_nbo) : &quot;mixed byte orders in format&quot;;
465       if (has_nbo)
466         flags |= _fmt_has_nbo;
467 
468       int this_size = 1;
469       if (fp &lt; format.length() &amp;&amp; format.charAt(fp) == fc) {
470         // advance beyond run of the same characters
471         this_size = 2;
472         while (fp  + 1 &lt; format.length() &amp;&amp; format.charAt(++fp) == fc)  this_size++;
473         switch (this_size) {
474         case 2: flags |= _fmt_has_u2; break;
475         case 4: flags |= _fmt_has_u4; break;
476         default: assert false : &quot;bad rep count in format&quot;;
477         }
478       }
479       assert has_size == 0 ||                     // no field yet
480         this_size == has_size ||             // same size
481         this_size &lt; has_size &amp;&amp; fp == format.length() : // last field can be short
482              &quot;mixed field sizes in format&quot;;
483       has_size = this_size;
484     }
485 
486     assert flags == (char)flags : &quot;change _format_flags&quot;;
487     return (char)flags;
488   }
489 
490 
491   //----------------------------------------------------------------------
492   // Internals only below this point
493   //
494 
495   private static String[]    _name;
496   private static String[]    _format;
497   private static String[]    _wide_format;
498   private static int[]       _result_type;
499   private static byte[]      _depth;
500   private static byte[]      _lengths;
501   private static int[]       _java_code;
502   private static char[]      _flags;
503 
504   static {
505     _name           = new String [number_of_codes];
506     _format         = new String [number_of_codes];
507     _wide_format    = new String [number_of_codes];
508     _result_type    = new int    [number_of_codes]; // See BasicType.java
509     _depth          = new byte   [number_of_codes];
510     _lengths        = new byte   [number_of_codes];
511     _java_code      = new int    [number_of_codes];
512     _flags          = new char[256 * 2]; // all second page for wide formats
513 
514     // In case we want to fetch this information from the VM in the
515     // future
516     VM.registerVMInitializedObserver(new Observer() {
517         public void update(Observable o, Object data) {
518           initialize();
519         }
520       });
521   }
522 
523   private static final int jintSize    =   4;
524 
525   //  private static String[]    _name           = new String [number_of_codes];
526   //  private static String[]    _format         = new String [number_of_codes];
527   //  private static String[]    _wide_format    = new String [number_of_codes];
528   //  private static int[]       _result_type    = new int    [number_of_codes]; // See BasicType.java
529   //  private static byte[]      _depth          = new byte   [number_of_codes];
530   //  private static byte[]      _length         = new byte   [number_of_codes];
531   //  private static boolean[]   _can_trap       = new boolean[number_of_codes];
532   //  private static int[]       _java_code      = new int    [number_of_codes];
533   //  private static boolean[]   _can_rewrite    = new boolean[number_of_codes];
534 
535   // Initialization
536   private static void initialize() {
537     if (Assert.ASSERTS_ENABLED) {
538       Assert.that(number_of_codes &lt;= 256, &quot;too many bytecodes&quot;);
539     }
540 
541     // Format strings interpretation:
542     //
543     // b: bytecode
544     // c: signed constant, Java byte-ordering
545     // i: unsigned index , Java byte-ordering
546     // j: unsigned index , native byte-ordering
547     // o: branch offset  , Java byte-ordering
548     // _: unused/ignored
549     // w: wide bytecode
550     //
551     // Note: Right now the format strings are used for 2 purposes:
552     //       1. to specify the length of the bytecode
553     //          (= number of characters in format string)
554     //       2. to specify the bytecode attributes
555     //
556     //       The bytecode attributes are currently used only for bytecode tracing
557     //       (see BytecodeTracer); thus if more specific format information is
558     //       used, one would also have to adjust the bytecode tracer.
559     //
560     // Note: For bytecodes with variable length, the format string is the empty string.
561 
562     // Note 1: null for the format string means the bytecode doesn&#39;t exist
563     //         in that form.
564     //
565     // Note 2: The result type is T_ILLEGAL for bytecodes where the top of stack
566     //         type after execution is not only determined by the bytecode itself.
567 
568     //  Java bytecodes
569     //  bytecode               bytecode name           format   wide f.   result tp                stk traps
570     def(_nop                 , &quot;nop&quot;                 , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, false);
571     def(_aconst_null         , &quot;aconst_null&quot;         , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
572     def(_iconst_m1           , &quot;iconst_m1&quot;           , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
573     def(_iconst_0            , &quot;iconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
574     def(_iconst_1            , &quot;iconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
575     def(_iconst_2            , &quot;iconst_2&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
576     def(_iconst_3            , &quot;iconst_3&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
577     def(_iconst_4            , &quot;iconst_4&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
578     def(_iconst_5            , &quot;iconst_5&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
579     def(_lconst_0            , &quot;lconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
580     def(_lconst_1            , &quot;lconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
581     def(_fconst_0            , &quot;fconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
582     def(_fconst_1            , &quot;fconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
583     def(_fconst_2            , &quot;fconst_2&quot;            , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
584     def(_dconst_0            , &quot;dconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
585     def(_dconst_1            , &quot;dconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
586     def(_bipush              , &quot;bipush&quot;              , &quot;bc&quot;   , null    , BasicType.getTInt()    ,  1, false);
587     def(_sipush              , &quot;sipush&quot;              , &quot;bcc&quot;  , null    , BasicType.getTInt()    ,  1, false);
588     def(_ldc                 , &quot;ldc&quot;                 , &quot;bk&quot;   , null    , BasicType.getTIllegal(),  1, true );
589     def(_ldc_w               , &quot;ldc_w&quot;               , &quot;bkk&quot;  , null    , BasicType.getTIllegal(),  1, true );
590     def(_ldc2_w              , &quot;ldc2_w&quot;              , &quot;bkk&quot;  , null    , BasicType.getTIllegal(),  2, true );
591     def(_iload               , &quot;iload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTInt()    ,  1, false);
592     def(_lload               , &quot;lload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTLong()   ,  2, false);
593     def(_fload               , &quot;fload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTFloat()  ,  1, false);
594     def(_dload               , &quot;dload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTDouble() ,  2, false);
595     def(_aload               , &quot;aload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTObject() ,  1, false);
596     def(_iload_0             , &quot;iload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
597     def(_iload_1             , &quot;iload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
598     def(_iload_2             , &quot;iload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
599     def(_iload_3             , &quot;iload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
600     def(_lload_0             , &quot;lload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
601     def(_lload_1             , &quot;lload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
602     def(_lload_2             , &quot;lload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
603     def(_lload_3             , &quot;lload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
604     def(_fload_0             , &quot;fload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
605     def(_fload_1             , &quot;fload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
606     def(_fload_2             , &quot;fload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
607     def(_fload_3             , &quot;fload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
608     def(_dload_0             , &quot;dload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
609     def(_dload_1             , &quot;dload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
610     def(_dload_2             , &quot;dload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
611     def(_dload_3             , &quot;dload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
612     def(_aload_0             , &quot;aload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, true ); // rewriting in interpreter
613     def(_aload_1             , &quot;aload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
614     def(_aload_2             , &quot;aload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
615     def(_aload_3             , &quot;aload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
616     def(_iaload              , &quot;iaload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
617     def(_laload              , &quot;laload&quot;              , &quot;b&quot;    , null    , BasicType.getTLong()   ,  0, true );
618     def(_faload              , &quot;faload&quot;              , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, true );
619     def(_daload              , &quot;daload&quot;              , &quot;b&quot;    , null    , BasicType.getTDouble() ,  0, true );
620     def(_aaload              , &quot;aaload&quot;              , &quot;b&quot;    , null    , BasicType.getTObject() , -1, true );
621     def(_baload              , &quot;baload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
622     def(_caload              , &quot;caload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
623     def(_saload              , &quot;saload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
624     def(_istore              , &quot;istore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -1, false);
625     def(_lstore              , &quot;lstore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -2, false);
626     def(_fstore              , &quot;fstore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -1, false);
627     def(_dstore              , &quot;dstore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -2, false);
628     def(_astore              , &quot;astore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -1, false);
629     def(_istore_0            , &quot;istore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
630     def(_istore_1            , &quot;istore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
631     def(_istore_2            , &quot;istore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
632     def(_istore_3            , &quot;istore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
633     def(_lstore_0            , &quot;lstore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
634     def(_lstore_1            , &quot;lstore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
635     def(_lstore_2            , &quot;lstore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
636     def(_lstore_3            , &quot;lstore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
637     def(_fstore_0            , &quot;fstore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
638     def(_fstore_1            , &quot;fstore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
639     def(_fstore_2            , &quot;fstore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
640     def(_fstore_3            , &quot;fstore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
641     def(_dstore_0            , &quot;dstore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
642     def(_dstore_1            , &quot;dstore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
643     def(_dstore_2            , &quot;dstore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
644     def(_dstore_3            , &quot;dstore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
645     def(_astore_0            , &quot;astore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
646     def(_astore_1            , &quot;astore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
647     def(_astore_2            , &quot;astore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
648     def(_astore_3            , &quot;astore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
649     def(_iastore             , &quot;iastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
650     def(_lastore             , &quot;lastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -4, true );
651     def(_fastore             , &quot;fastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
652     def(_dastore             , &quot;dastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -4, true );
653     def(_aastore             , &quot;aastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
654     def(_bastore             , &quot;bastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
655     def(_castore             , &quot;castore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
656     def(_sastore             , &quot;sastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
657     def(_pop                 , &quot;pop&quot;                 , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
658     def(_pop2                , &quot;pop2&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
659     def(_dup                 , &quot;dup&quot;                 , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  1, false);
660     def(_dup_x1              , &quot;dup_x1&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  1, false);
661     def(_dup_x2              , &quot;dup_x2&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  1, false);
662     def(_dup2                , &quot;dup2&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  2, false);
663     def(_dup2_x1             , &quot;dup2_x1&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  2, false);
664     def(_dup2_x2             , &quot;dup2_x2&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  2, false);
665     def(_swap                , &quot;swap&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, false);
666     def(_iadd                , &quot;iadd&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
667     def(_ladd                , &quot;ladd&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
668     def(_fadd                , &quot;fadd&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
669     def(_dadd                , &quot;dadd&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
670     def(_isub                , &quot;isub&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
671     def(_lsub                , &quot;lsub&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
672     def(_fsub                , &quot;fsub&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
673     def(_dsub                , &quot;dsub&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
674     def(_imul                , &quot;imul&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
675     def(_lmul                , &quot;lmul&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
676     def(_fmul                , &quot;fmul&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
677     def(_dmul                , &quot;dmul&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
678     def(_idiv                , &quot;idiv&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
679     def(_ldiv                , &quot;ldiv&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, true );
680     def(_fdiv                , &quot;fdiv&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
681     def(_ddiv                , &quot;ddiv&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
682     def(_irem                , &quot;irem&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
683     def(_lrem                , &quot;lrem&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, true );
684     def(_frem                , &quot;frem&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
685     def(_drem                , &quot;drem&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
686     def(_ineg                , &quot;ineg&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    ,  0, false);
687     def(_lneg                , &quot;lneg&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   ,  0, false);
688     def(_fneg                , &quot;fneg&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  0, false);
689     def(_dneg                , &quot;dneg&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() ,  0, false);
690     def(_ishl                , &quot;ishl&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
691     def(_lshl                , &quot;lshl&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -1, false);
692     def(_ishr                , &quot;ishr&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
693     def(_lshr                , &quot;lshr&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -1, false);
694     def(_iushr               , &quot;iushr&quot;               , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
695     def(_lushr               , &quot;lushr&quot;               , &quot;b&quot;    , null    , BasicType.getTLong()   , -1, false);
696     def(_iand                , &quot;iand&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
697     def(_land                , &quot;land&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
698     def(_ior                 , &quot;ior&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
699     def(_lor                 , &quot;lor&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
700     def(_ixor                , &quot;ixor&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
701     def(_lxor                , &quot;lxor&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
702     def(_iinc                , &quot;iinc&quot;                , &quot;bic&quot;  , &quot;wbiicc&quot;, BasicType.getTVoid()   ,  0, false);
703     def(_i2l                 , &quot;i2l&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   ,  1, false);
704     def(_i2f                 , &quot;i2f&quot;                 , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  0, false);
705     def(_i2d                 , &quot;i2d&quot;                 , &quot;b&quot;    , null    , BasicType.getTDouble() ,  1, false);
706     def(_l2i                 , &quot;l2i&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
707     def(_l2f                 , &quot;l2f&quot;                 , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
708     def(_l2d                 , &quot;l2d&quot;                 , &quot;b&quot;    , null    , BasicType.getTDouble() ,  0, false);
709     def(_f2i                 , &quot;f2i&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    ,  0, false);
710     def(_f2l                 , &quot;f2l&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   ,  1, false);
711     def(_f2d                 , &quot;f2d&quot;                 , &quot;b&quot;    , null    , BasicType.getTDouble() ,  1, false);
712     def(_d2i                 , &quot;d2i&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
713     def(_d2l                 , &quot;d2l&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   ,  0, false);
714     def(_d2f                 , &quot;d2f&quot;                 , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
715     def(_i2b                 , &quot;i2b&quot;                 , &quot;b&quot;    , null    , BasicType.getTByte()   ,  0, false);
716     def(_i2c                 , &quot;i2c&quot;                 , &quot;b&quot;    , null    , BasicType.getTChar()   ,  0, false);
717     def(_i2s                 , &quot;i2s&quot;                 , &quot;b&quot;    , null    , BasicType.getTShort()  ,  0, false);
718     def(_lcmp                , &quot;lcmp&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, false);
719     def(_fcmpl               , &quot;fcmpl&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
720     def(_fcmpg               , &quot;fcmpg&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
721     def(_dcmpl               , &quot;dcmpl&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, false);
722     def(_dcmpg               , &quot;dcmpg&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, false);
723     def(_ifeq                , &quot;ifeq&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
724     def(_ifne                , &quot;ifne&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
725     def(_iflt                , &quot;iflt&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
726     def(_ifge                , &quot;ifge&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
727     def(_ifgt                , &quot;ifgt&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
728     def(_ifle                , &quot;ifle&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
729     def(_if_icmpeq           , &quot;if_icmpeq&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
730     def(_if_icmpne           , &quot;if_icmpne&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
731     def(_if_icmplt           , &quot;if_icmplt&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
732     def(_if_icmpge           , &quot;if_icmpge&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
733     def(_if_icmpgt           , &quot;if_icmpgt&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
734     def(_if_icmple           , &quot;if_icmple&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
735     def(_if_acmpeq           , &quot;if_acmpeq&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
736     def(_if_acmpne           , &quot;if_acmpne&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
737     def(_goto                , &quot;goto&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   ,  0, false);
738     def(_jsr                 , &quot;jsr&quot;                 , &quot;boo&quot;  , null    , BasicType.getTInt()    ,  0, false);
739     def(_ret                 , &quot;ret&quot;                 , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   ,  0, false);
740     def(_tableswitch         , &quot;tableswitch&quot;         , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false); // may have backward branches
741     def(_lookupswitch        , &quot;lookupswitch&quot;        , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false); // rewriting in interpreter
742     def(_ireturn             , &quot;ireturn&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
743     def(_lreturn             , &quot;lreturn&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, true );
744     def(_freturn             , &quot;freturn&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, true );
745     def(_dreturn             , &quot;dreturn&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, true );
746     def(_areturn             , &quot;areturn&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() , -1, true );
747     def(_return              , &quot;return&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, true );
748     def(_getstatic           , &quot;getstatic&quot;           , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(),  1, true );
749     def(_putstatic           , &quot;putstatic&quot;           , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true );
750     def(_getfield            , &quot;getfield&quot;            , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(),  0, true );
751     def(_putfield            , &quot;putfield&quot;            , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -2, true );
752     def(_invokevirtual       , &quot;invokevirtual&quot;       , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true );
753     def(_invokespecial       , &quot;invokespecial&quot;       , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true );
754     def(_invokestatic        , &quot;invokestatic&quot;        , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(),  0, true );
755     def(_invokeinterface     , &quot;invokeinterface&quot;     , &quot;bJJ__&quot;, null    , BasicType.getTIllegal(), -1, true );
756     def(_invokedynamic       , &quot;invokedynamic&quot;       , &quot;bJJJJ&quot;, null    , BasicType.getTIllegal(),  0, true );
757     def(_new                 , &quot;new&quot;                 , &quot;bkk&quot;  , null    , BasicType.getTObject() ,  1, true );
758     def(_newarray            , &quot;newarray&quot;            , &quot;bc&quot;   , null    , BasicType.getTObject() ,  0, true );
759     def(_anewarray           , &quot;anewarray&quot;           , &quot;bkk&quot;  , null    , BasicType.getTObject() ,  0, true );
760     def(_arraylength         , &quot;arraylength&quot;         , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, true );
761     def(_athrow              , &quot;athrow&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, true );
762     def(_checkcast           , &quot;checkcast&quot;           , &quot;bkk&quot;  , null    , BasicType.getTObject() ,  0, true );
763     def(_instanceof          , &quot;instanceof&quot;          , &quot;bkk&quot;  , null    , BasicType.getTInt()    ,  0, true );
764     def(_monitorenter        , &quot;monitorenter&quot;        , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, true );
765     def(_monitorexit         , &quot;monitorexit&quot;         , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, true );
766     def(_wide                , &quot;wide&quot;                , &quot;&quot;     , null    , BasicType.getTVoid()   ,  0, false);
767     def(_multianewarray      , &quot;multianewarray&quot;      , &quot;bkkc&quot; , null    , BasicType.getTObject() ,  1, true );
768     def(_ifnull              , &quot;ifnull&quot;              , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
769     def(_ifnonnull           , &quot;ifnonnull&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
770     def(_goto_w              , &quot;goto_w&quot;              , &quot;boooo&quot;, null    , BasicType.getTVoid()   ,  0, false);
771     def(_jsr_w               , &quot;jsr_w&quot;               , &quot;boooo&quot;, null    , BasicType.getTInt()    ,  0, false);
772     def(_breakpoint          , &quot;breakpoint&quot;          , &quot;&quot;     , null    , BasicType.getTVoid()   ,  0, true );
773 
774     //  JVM bytecodes
775     //  bytecode               bytecode name           format   wide f.   result tp               stk traps  std code
776 
777     def(_fast_agetfield      , &quot;fast_agetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTObject() ,  0, true , _getfield       );
778     def(_fast_bgetfield      , &quot;fast_bgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _getfield       );
779     def(_fast_cgetfield      , &quot;fast_cgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTChar()   ,  0, true , _getfield       );
780     def(_fast_dgetfield      , &quot;fast_dgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTDouble() ,  0, true , _getfield       );
781     def(_fast_fgetfield      , &quot;fast_fgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTFloat()  ,  0, true , _getfield       );
782     def(_fast_igetfield      , &quot;fast_igetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _getfield       );
783     def(_fast_lgetfield      , &quot;fast_lgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTLong()   ,  0, true , _getfield       );
784     def(_fast_sgetfield      , &quot;fast_sgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTShort()  ,  0, true , _getfield       );
785 
786     def(_fast_aputfield      , &quot;fast_aputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTObject() ,  0, true , _putfield       );
787     def(_fast_bputfield      , &quot;fast_bputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _putfield       );
788     def(_fast_zputfield      , &quot;fast_zputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _putfield       );
789     def(_fast_cputfield      , &quot;fast_cputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTChar()   ,  0, true , _putfield       );
790     def(_fast_dputfield      , &quot;fast_dputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTDouble() ,  0, true , _putfield       );
791     def(_fast_fputfield      , &quot;fast_fputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTFloat()  ,  0, true , _putfield       );
792     def(_fast_iputfield      , &quot;fast_iputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _putfield       );
793     def(_fast_lputfield      , &quot;fast_lputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTLong()   ,  0, true , _putfield       );
794     def(_fast_sputfield      , &quot;fast_sputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTShort()  ,  0, true , _putfield       );
795 
796     def(_fast_aload_0        , &quot;fast_aload_0&quot;        , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, true , _aload_0        );
797     def(_fast_iaccess_0      , &quot;fast_iaccess_0&quot;      , &quot;b_JJ&quot; , null    , BasicType.getTInt()    ,  1, true , _aload_0        );
798     def(_fast_aaccess_0      , &quot;fast_aaccess_0&quot;      , &quot;b_JJ&quot; , null    , BasicType.getTObject() ,  1, true , _aload_0        );
799     def(_fast_faccess_0      , &quot;fast_faccess_0&quot;      , &quot;b_JJ&quot; , null    , BasicType.getTObject() ,  1, true , _aload_0        );
800 
801     def(_fast_iload          , &quot;fast_iload&quot;          , &quot;bi&quot;   , null    , BasicType.getTInt()    ,  1, false, _iload          );
802     def(_fast_iload2         , &quot;fast_iload2&quot;         , &quot;bi_i&quot; , null    , BasicType.getTInt()    ,  2, false, _iload          );
803     def(_fast_icaload        , &quot;fast_icaload&quot;        , &quot;bi_&quot;  , null    , BasicType.getTInt()    ,  0, false, _iload          );
804 
805     // Faster method invocation.
806     def(_fast_invokevfinal   , &quot;fast_invokevfinal&quot;   , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true, _invokevirtual   );
807 
808     def(_fast_linearswitch   , &quot;fast_linearswitch&quot;   , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false, _lookupswitch   );
809     def(_fast_binaryswitch   , &quot;fast_binaryswitch&quot;   , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false, _lookupswitch   );
810     def(_fast_aldc           , &quot;fast_aldc&quot;           , &quot;bj&quot;   , null    , BasicType.getTObject(),   1, true,  _ldc            );
811     def(_fast_aldc_w         , &quot;fast_aldc_w&quot;         , &quot;bJJ&quot;  , null    , BasicType.getTObject(),   1, true,  _ldc_w          );
812 
813     def(_return_register_finalizer, &quot;return_register_finalizer&quot;, &quot;b&quot;    , null    , BasicType.getTVoid()   , 0, true, _return );
814 
815     // special handling of signature-polymorphic methods
816     def(_invokehandle        , &quot;invokehandle&quot;        , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true, _invokevirtual   );
817 
818     // CDS specific. Bytecodes rewritten at CDS dump time
819     def(_nofast_getfield     , &quot;_nofast_getfield&quot;    , &quot;bJJ&quot;  , null    , BasicType.getTIllegal() , 0, true,  _getfield );
820     def(_nofast_putfield     , &quot;_nofast_putfield&quot;    , &quot;bJJ&quot;  , null    , BasicType.getTIllegal() ,-2, true,  _putfield );
821     def(_nofast_aload_0      , &quot;_nofast_aload_0&quot;     , &quot;b&quot;    , null    , BasicType.getTObject()  , 1, true,  _aload_0  );
822     def(_nofast_iload        , &quot;_nofast_iload&quot;       , &quot;bi&quot;   , null    , BasicType.getTInt()     , 1, false, _iload    );
823 
824     def(_shouldnotreachhere  , &quot;_shouldnotreachhere&quot; , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, false);
825 
826     if (Assert.ASSERTS_ENABLED) {
827       // compare can_trap information for each bytecode with the
828       // can_trap information for the corresponding base bytecode
829       // (if a rewritten bytecode can trap, so must the base bytecode)
830       for (int i = 0; i &lt; number_of_codes; i++) {
831         if (isDefined(i)) {
832           int j = javaCode(i);
833           if (canTrap(i) &amp;&amp; !canTrap(j)) {
834             Assert.that(false, name(i) + &quot; can trap =&gt; &quot; + name(j) + &quot; can trap, too&quot;);
835           }
836         }
837       }
838     }
839   }
840 
841   private static void def(int code, String name, String format, String wide_format, int result_type, int depth, boolean can_trap) {
842     def(code, name, format, wide_format, result_type, depth, can_trap, code);
843   }
844 
845   private static void def(int code, String name, String format, String wide_format, int result_type, int depth, boolean can_trap, int java_code) {
846     if (Assert.ASSERTS_ENABLED) {
847       Assert.that(wide_format == null || format != null, &quot;short form must exist if there&#39;s a wide form&quot;);
848     }
849     int len  = (format      != null ? format.length()      : 0);
850     int wlen = (wide_format != null ? wide_format.length() : 0);
851     _name          [code] = name;
852     _result_type   [code] = result_type;
853     _depth         [code] = (byte) depth;
854     _lengths       [code] = (byte)((wlen &lt;&lt; 4) | (len &amp; 0xF));
855     _java_code     [code] = java_code;
856     _format        [code] = format;
857     _wide_format   [code] = wide_format;
858     int bc_flags = 0;
859     if (can_trap)           bc_flags |= _bc_can_trap;
860     if (java_code != code)  bc_flags |= _bc_can_rewrite;
861     _flags[code+0*256] = compute_flags(format,      bc_flags);
862     _flags[code+1*256] = compute_flags(wide_format, bc_flags);
863   }
864 }
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>