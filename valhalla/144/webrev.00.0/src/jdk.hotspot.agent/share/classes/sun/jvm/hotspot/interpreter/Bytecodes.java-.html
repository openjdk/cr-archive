<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.hotspot.agent/share/classes/sun/jvm/hotspot/interpreter/Bytecodes.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2001, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 package sun.jvm.hotspot.interpreter;
 26 
 27 import java.util.*;
 28 import sun.jvm.hotspot.oops.*;
 29 import sun.jvm.hotspot.runtime.*;
 30 import sun.jvm.hotspot.utilities.*;
 31 import sun.jvm.hotspot.utilities.Observable;
 32 import sun.jvm.hotspot.utilities.Observer;
 33 
 34 // Bytecodes specifies all bytecodes used in the VM and
 35 // provides utility functions to get bytecode attributes.
 36 
 37 public class Bytecodes {
 38   public static final int _illegal    =  -1;
 39 
 40   // Java bytecodes
 41   public static final int _nop                  =   0; // 0x00
 42   public static final int _aconst_null          =   1; // 0x01
 43   public static final int _iconst_m1            =   2; // 0x02
 44   public static final int _iconst_0             =   3; // 0x03
 45   public static final int _iconst_1             =   4; // 0x04
 46   public static final int _iconst_2             =   5; // 0x05
 47   public static final int _iconst_3             =   6; // 0x06
 48   public static final int _iconst_4             =   7; // 0x07
 49   public static final int _iconst_5             =   8; // 0x08
 50   public static final int _lconst_0             =   9; // 0x09
 51   public static final int _lconst_1             =  10; // 0x0a
 52   public static final int _fconst_0             =  11; // 0x0b
 53   public static final int _fconst_1             =  12; // 0x0c
 54   public static final int _fconst_2             =  13; // 0x0d
 55   public static final int _dconst_0             =  14; // 0x0e
 56   public static final int _dconst_1             =  15; // 0x0f
 57   public static final int _bipush               =  16; // 0x10
 58   public static final int _sipush               =  17; // 0x11
 59   public static final int _ldc                  =  18; // 0x12
 60   public static final int _ldc_w                =  19; // 0x13
 61   public static final int _ldc2_w               =  20; // 0x14
 62   public static final int _iload                =  21; // 0x15
 63   public static final int _lload                =  22; // 0x16
 64   public static final int _fload                =  23; // 0x17
 65   public static final int _dload                =  24; // 0x18
 66   public static final int _aload                =  25; // 0x19
 67   public static final int _iload_0              =  26; // 0x1a
 68   public static final int _iload_1              =  27; // 0x1b
 69   public static final int _iload_2              =  28; // 0x1c
 70   public static final int _iload_3              =  29; // 0x1d
 71   public static final int _lload_0              =  30; // 0x1e
 72   public static final int _lload_1              =  31; // 0x1f
 73   public static final int _lload_2              =  32; // 0x20
 74   public static final int _lload_3              =  33; // 0x21
 75   public static final int _fload_0              =  34; // 0x22
 76   public static final int _fload_1              =  35; // 0x23
 77   public static final int _fload_2              =  36; // 0x24
 78   public static final int _fload_3              =  37; // 0x25
 79   public static final int _dload_0              =  38; // 0x26
 80   public static final int _dload_1              =  39; // 0x27
 81   public static final int _dload_2              =  40; // 0x28
 82   public static final int _dload_3              =  41; // 0x29
 83   public static final int _aload_0              =  42; // 0x2a
 84   public static final int _aload_1              =  43; // 0x2b
 85   public static final int _aload_2              =  44; // 0x2c
 86   public static final int _aload_3              =  45; // 0x2d
 87   public static final int _iaload               =  46; // 0x2e
 88   public static final int _laload               =  47; // 0x2f
 89   public static final int _faload               =  48; // 0x30
 90   public static final int _daload               =  49; // 0x31
 91   public static final int _aaload               =  50; // 0x32
 92   public static final int _baload               =  51; // 0x33
 93   public static final int _caload               =  52; // 0x34
 94   public static final int _saload               =  53; // 0x35
 95   public static final int _istore               =  54; // 0x36
 96   public static final int _lstore               =  55; // 0x37
 97   public static final int _fstore               =  56; // 0x38
 98   public static final int _dstore               =  57; // 0x39
 99   public static final int _astore               =  58; // 0x3a
100   public static final int _istore_0             =  59; // 0x3b
101   public static final int _istore_1             =  60; // 0x3c
102   public static final int _istore_2             =  61; // 0x3d
103   public static final int _istore_3             =  62; // 0x3e
104   public static final int _lstore_0             =  63; // 0x3f
105   public static final int _lstore_1             =  64; // 0x40
106   public static final int _lstore_2             =  65; // 0x41
107   public static final int _lstore_3             =  66; // 0x42
108   public static final int _fstore_0             =  67; // 0x43
109   public static final int _fstore_1             =  68; // 0x44
110   public static final int _fstore_2             =  69; // 0x45
111   public static final int _fstore_3             =  70; // 0x46
112   public static final int _dstore_0             =  71; // 0x47
113   public static final int _dstore_1             =  72; // 0x48
114   public static final int _dstore_2             =  73; // 0x49
115   public static final int _dstore_3             =  74; // 0x4a
116   public static final int _astore_0             =  75; // 0x4b
117   public static final int _astore_1             =  76; // 0x4c
118   public static final int _astore_2             =  77; // 0x4d
119   public static final int _astore_3             =  78; // 0x4e
120   public static final int _iastore              =  79; // 0x4f
121   public static final int _lastore              =  80; // 0x50
122   public static final int _fastore              =  81; // 0x51
123   public static final int _dastore              =  82; // 0x52
124   public static final int _aastore              =  83; // 0x53
125   public static final int _bastore              =  84; // 0x54
126   public static final int _castore              =  85; // 0x55
127   public static final int _sastore              =  86; // 0x56
128   public static final int _pop                  =  87; // 0x57
129   public static final int _pop2                 =  88; // 0x58
130   public static final int _dup                  =  89; // 0x59
131   public static final int _dup_x1               =  90; // 0x5a
132   public static final int _dup_x2               =  91; // 0x5b
133   public static final int _dup2                 =  92; // 0x5c
134   public static final int _dup2_x1              =  93; // 0x5d
135   public static final int _dup2_x2              =  94; // 0x5e
136   public static final int _swap                 =  95; // 0x5f
137   public static final int _iadd                 =  96; // 0x60
138   public static final int _ladd                 =  97; // 0x61
139   public static final int _fadd                 =  98; // 0x62
140   public static final int _dadd                 =  99; // 0x63
141   public static final int _isub                 = 100; // 0x64
142   public static final int _lsub                 = 101; // 0x65
143   public static final int _fsub                 = 102; // 0x66
144   public static final int _dsub                 = 103; // 0x67
145   public static final int _imul                 = 104; // 0x68
146   public static final int _lmul                 = 105; // 0x69
147   public static final int _fmul                 = 106; // 0x6a
148   public static final int _dmul                 = 107; // 0x6b
149   public static final int _idiv                 = 108; // 0x6c
150   public static final int _ldiv                 = 109; // 0x6d
151   public static final int _fdiv                 = 110; // 0x6e
152   public static final int _ddiv                 = 111; // 0x6f
153   public static final int _irem                 = 112; // 0x70
154   public static final int _lrem                 = 113; // 0x71
155   public static final int _frem                 = 114; // 0x72
156   public static final int _drem                 = 115; // 0x73
157   public static final int _ineg                 = 116; // 0x74
158   public static final int _lneg                 = 117; // 0x75
159   public static final int _fneg                 = 118; // 0x76
160   public static final int _dneg                 = 119; // 0x77
161   public static final int _ishl                 = 120; // 0x78
162   public static final int _lshl                 = 121; // 0x79
163   public static final int _ishr                 = 122; // 0x7a
164   public static final int _lshr                 = 123; // 0x7b
165   public static final int _iushr                = 124; // 0x7c
166   public static final int _lushr                = 125; // 0x7d
167   public static final int _iand                 = 126; // 0x7e
168   public static final int _land                 = 127; // 0x7f
169   public static final int _ior                  = 128; // 0x80
170   public static final int _lor                  = 129; // 0x81
171   public static final int _ixor                 = 130; // 0x82
172   public static final int _lxor                 = 131; // 0x83
173   public static final int _iinc                 = 132; // 0x84
174   public static final int _i2l                  = 133; // 0x85
175   public static final int _i2f                  = 134; // 0x86
176   public static final int _i2d                  = 135; // 0x87
177   public static final int _l2i                  = 136; // 0x88
178   public static final int _l2f                  = 137; // 0x89
179   public static final int _l2d                  = 138; // 0x8a
180   public static final int _f2i                  = 139; // 0x8b
181   public static final int _f2l                  = 140; // 0x8c
182   public static final int _f2d                  = 141; // 0x8d
183   public static final int _d2i                  = 142; // 0x8e
184   public static final int _d2l                  = 143; // 0x8f
185   public static final int _d2f                  = 144; // 0x90
186   public static final int _i2b                  = 145; // 0x91
187   public static final int _i2c                  = 146; // 0x92
188   public static final int _i2s                  = 147; // 0x93
189   public static final int _lcmp                 = 148; // 0x94
190   public static final int _fcmpl                = 149; // 0x95
191   public static final int _fcmpg                = 150; // 0x96
192   public static final int _dcmpl                = 151; // 0x97
193   public static final int _dcmpg                = 152; // 0x98
194   public static final int _ifeq                 = 153; // 0x99
195   public static final int _ifne                 = 154; // 0x9a
196   public static final int _iflt                 = 155; // 0x9b
197   public static final int _ifge                 = 156; // 0x9c
198   public static final int _ifgt                 = 157; // 0x9d
199   public static final int _ifle                 = 158; // 0x9e
200   public static final int _if_icmpeq            = 159; // 0x9f
201   public static final int _if_icmpne            = 160; // 0xa0
202   public static final int _if_icmplt            = 161; // 0xa1
203   public static final int _if_icmpge            = 162; // 0xa2
204   public static final int _if_icmpgt            = 163; // 0xa3
205   public static final int _if_icmple            = 164; // 0xa4
206   public static final int _if_acmpeq            = 165; // 0xa5
207   public static final int _if_acmpne            = 166; // 0xa6
208   public static final int _goto                 = 167; // 0xa7
209   public static final int _jsr                  = 168; // 0xa8
210   public static final int _ret                  = 169; // 0xa9
211   public static final int _tableswitch          = 170; // 0xaa
212   public static final int _lookupswitch         = 171; // 0xab
213   public static final int _ireturn              = 172; // 0xac
214   public static final int _lreturn              = 173; // 0xad
215   public static final int _freturn              = 174; // 0xae
216   public static final int _dreturn              = 175; // 0xaf
217   public static final int _areturn              = 176; // 0xb0
218   public static final int _return               = 177; // 0xb1
219   public static final int _getstatic            = 178; // 0xb2
220   public static final int _putstatic            = 179; // 0xb3
221   public static final int _getfield             = 180; // 0xb4
222   public static final int _putfield             = 181; // 0xb5
223   public static final int _invokevirtual        = 182; // 0xb6
224   public static final int _invokespecial        = 183; // 0xb7
225   public static final int _invokestatic         = 184; // 0xb8
226   public static final int _invokeinterface      = 185; // 0xb9
227   public static final int _invokedynamic        = 186; // 0xba
228   public static final int _new                  = 187; // 0xbb
229   public static final int _newarray             = 188; // 0xbc
230   public static final int _anewarray            = 189; // 0xbd
231   public static final int _arraylength          = 190; // 0xbe
232   public static final int _athrow               = 191; // 0xbf
233   public static final int _checkcast            = 192; // 0xc0
234   public static final int _instanceof           = 193; // 0xc1
235   public static final int _monitorenter         = 194; // 0xc2
236   public static final int _monitorexit          = 195; // 0xc3
237   public static final int _wide                 = 196; // 0xc4
238   public static final int _multianewarray       = 197; // 0xc5
239   public static final int _ifnull               = 198; // 0xc6
240   public static final int _ifnonnull            = 199; // 0xc7
241   public static final int _goto_w               = 200; // 0xc8
242   public static final int _jsr_w                = 201; // 0xc9
243   public static final int _breakpoint           = 202; // 0xca
244   public static final int _defaultvalue         = 203; // 0xcb
245   public static final int _withfield            = 204; // 0xcc
246 
247   public static final int number_of_java_codes  = 205;
248 
249   // JVM bytecodes
250   public static final int _fast_agetfield       = number_of_java_codes;
251     public static final int _fast_qgetfield       = 206;
252   public static final int _fast_bgetfield       = 207;
253   public static final int _fast_cgetfield       = 208;
254   public static final int _fast_dgetfield       = 209;
255   public static final int _fast_fgetfield       = 210;
256   public static final int _fast_igetfield       = 211;
257   public static final int _fast_lgetfield       = 212;
258   public static final int _fast_sgetfield       = 213;
259   public static final int _fast_aputfield       = 214;
260   public static final int _fast_qputfield       = 215;
261   public static final int _fast_bputfield       = 216;
262   public static final int _fast_zputfield       = 217;
263   public static final int _fast_cputfield       = 218;
264   public static final int _fast_dputfield       = 219;
265   public static final int _fast_fputfield       = 220;
266   public static final int _fast_iputfield       = 221;
267   public static final int _fast_lputfield       = 222;
268   public static final int _fast_sputfield       = 223;
269   public static final int _fast_aload_0         = 224;
270   public static final int _fast_iaccess_0       = 225;
271   public static final int _fast_aaccess_0       = 226;
272   public static final int _fast_faccess_0       = 227;
273   public static final int _fast_iload           = 228;
274   public static final int _fast_iload2          = 229;
275   public static final int _fast_icaload         = 230;
276   public static final int _fast_invokevfinal    = 231;
277   public static final int _fast_linearswitch    = 232;
278   public static final int _fast_binaryswitch    = 233;
279   public static final int _fast_aldc            = 234;
280   public static final int _fast_aldc_w          = 235;
281   public static final int _return_register_finalizer = 236;
282   public static final int _invokehandle         = 237;
283 
284   // Bytecodes rewritten at CDS dump time
285   public static final int _nofast_getfield      = 238;
286   public static final int _nofast_putfield      = 239;
287   public static final int _nofast_aload_0       = 240;
288   public static final int _nofast_iload         = 241;
289   public static final int _shouldnotreachhere   = 242; // For debugging
290 
291   public static final int number_of_codes       = 243;
292 
293   // Flag bits derived from format strings, can_trap, can_rewrite, etc.:
294   // semantic flags:
295   static final int  _bc_can_trap      = 1&lt;&lt;0;     // bytecode execution can trap or block
296   static final int  _bc_can_rewrite   = 1&lt;&lt;1;     // bytecode execution has an alternate form
297 
298   // format bits (determined only by the format string):
299   static final int  _fmt_has_c        = 1&lt;&lt;2;     // constant, such as sipush &quot;bcc&quot;
300   static final int  _fmt_has_j        = 1&lt;&lt;3;     // constant pool cache index, such as getfield &quot;bjj&quot;
301   static final int  _fmt_has_k        = 1&lt;&lt;4;     // constant pool index, such as ldc &quot;bk&quot;
302   static final int  _fmt_has_i        = 1&lt;&lt;5;     // local index, such as iload
303   static final int  _fmt_has_o        = 1&lt;&lt;6;     // offset, such as ifeq
304   static final int  _fmt_has_nbo      = 1&lt;&lt;7;     // contains native-order field(s)
305   static final int  _fmt_has_u2       = 1&lt;&lt;8;     // contains double-byte field(s)
306   static final int  _fmt_has_u4       = 1&lt;&lt;9;     // contains quad-byte field
307   static final int  _fmt_not_variable = 1&lt;&lt;10;    // not of variable length (simple or wide)
308   static final int  _fmt_not_simple   = 1&lt;&lt;11;    // either wide or variable length
309   static final int  _all_fmt_bits     = (_fmt_not_simple*2 - _fmt_has_c);
310 
311   // Example derived format syndromes:
312   static final int  _fmt_b      = _fmt_not_variable;
313   static final int  _fmt_bc     = _fmt_b | _fmt_has_c;
314   static final int  _fmt_bi     = _fmt_b | _fmt_has_i;
315   static final int  _fmt_bkk    = _fmt_b | _fmt_has_k | _fmt_has_u2;
316   static final int  _fmt_bJJ    = _fmt_b | _fmt_has_j | _fmt_has_u2 | _fmt_has_nbo;
317   static final int  _fmt_bo2    = _fmt_b | _fmt_has_o | _fmt_has_u2;
318   static final int  _fmt_bo4    = _fmt_b | _fmt_has_o | _fmt_has_u4;
319 
320 
321   public static int specialLengthAt(Method method, int bci) {
322     int code = codeAt(method, bci);
323     switch (code) {
324     case _wide:
325       return wideLengthFor(method.getBytecodeOrBPAt(bci + 1));
326     case _tableswitch:
327       {
328         int alignedBCI = Bits.roundTo(bci + 1, jintSize);
329         int lo = method.getBytecodeIntArg(alignedBCI + 1*jintSize);
330         int hi = method.getBytecodeIntArg(alignedBCI + 2*jintSize);
331         return (alignedBCI - bci) + (3 + hi - lo + 1)*jintSize;
332       }
333 
334     case _lookupswitch:      // fall through
335     case _fast_binaryswitch: // fall through
336     case _fast_linearswitch:
337       {
338         int alignedBCI = Bits.roundTo(bci + 1, jintSize);
339         int npairs = method.getBytecodeIntArg(alignedBCI + jintSize);
340         return (alignedBCI - bci) + (2 + 2*npairs)*jintSize;
341       }
342 
343     }
344     throw new RuntimeException(&quot;should not reach here&quot;);
345   }
346 
347   // Conversion
348   public static void check(int code) {
349     if (Assert.ASSERTS_ENABLED) {
350       Assert.that(isDefined(code), &quot;illegal code &quot; + code);
351     }
352   }
353   public static void wideCheck(int code) {
354     if (Assert.ASSERTS_ENABLED) {
355       Assert.that(wideIsDefined(code), &quot;illegal code &quot; + code);
356     }
357   }
358 
359   /** Fetches a bytecode, hiding breakpoints as necessary */
360   public static int codeAt(Method method, int bci) {
361     int res = codeOrBPAt(method, bci);
362     if (res == _breakpoint) {
363       res = method.getOrigBytecodeAt(bci);
364     }
365     return res;
366   }
367 
368   /** Fetches a bytecode or a breakpoint */
369   public static int codeOrBPAt(Method method, int bci) {
370     return method.getBytecodeOrBPAt(bci);
371   }
372 
373   public static boolean isActiveBreakpointAt(Method method, int bci) {
374     return (codeOrBPAt(method, bci) == _breakpoint);
375   }
376 
377   // find a bytecode, behind a breakpoint if necessary:
378   // FIXME: not yet implementable
379   //   static Code       non_breakpoint_code_at(address bcp, Method* method = null);
380 
381   // Bytecode attributes
382   public static boolean   isDefined    (int code) { return 0 &lt;= code &amp;&amp; code &lt; number_of_codes &amp;&amp; flags(code, false) != 0; }
383   public static boolean   wideIsDefined(int code) { return isDefined(code) &amp;&amp; flags(code, true) != 0; }
384   public static String    name         (int code) { check(code);      return _name          [code]; }
385   public static String    format       (int code) { check(code);      return _format        [code]; }
386   public static String    wideFormat   (int code) { wideCheck(code);  return _wide_format   [code]; }
387   public static int       resultType   (int code) { check(code);      return _result_type   [code]; }
388   public static int       depth        (int code) { check(code);      return _depth         [code]; }
389   public static int       lengthFor    (int code) { check(code);      return _lengths       [code] &amp; 0xF; }
390   public static int       wideLengthFor(int code) { check(code);      return _lengths       [code] &gt;&gt; 4; }
391   public static boolean   canTrap      (int code) { check(code);      return has_all_flags(code, _bc_can_trap, false); }
392   public static int       javaCode     (int code) { check(code);      return _java_code     [code]; }
393   public static boolean   canRewrite   (int code) { check(code);      return has_all_flags(code, _bc_can_rewrite, false); }
394   public static boolean   native_byte_order(int code)  { check(code);      return has_all_flags(code, _fmt_has_nbo, false); }
395   public static boolean   uses_cp_cache  (int code)    { check(code);      return has_all_flags(code, _fmt_has_j, false); }
396   public static int       lengthAt     (Method method, int bci) { int l = lengthFor(codeAt(method, bci)); return l &gt; 0 ? l : specialLengthAt(method, bci); }
397   public static int       javaLengthAt (Method method, int bci) { int l = lengthFor(javaCode(codeAt(method, bci))); return l &gt; 0 ? l : specialLengthAt(method, bci); }
398   public static boolean   isJavaCode   (int code) { return 0 &lt;= code &amp;&amp; code &lt; number_of_java_codes; }
399   public static boolean   isFastCode   (int code) { return number_of_java_codes &lt;= code &amp;&amp; code &lt; number_of_codes; }
400 
401   public static boolean   isAload      (int code) { return (code == _aload  || code == _aload_0  || code == _aload_1
402                                                                             || code == _aload_2  || code == _aload_3); }
403   public static boolean   isAstore     (int code) { return (code == _astore || code == _astore_0 || code == _astore_1
404                                                                             || code == _astore_2 || code == _astore_3); }
405 
406   public static boolean   isZeroConst  (int code) { return (code == _aconst_null || code == _iconst_0
407                                                                                  || code == _fconst_0 || code == _dconst_0); }
408 
409   static int         flags          (int code, boolean is_wide) {
410     assert code == (code &amp; 0xff) : &quot;must be a byte&quot;;
411     return _flags[code + (is_wide ? 256 : 0)];
412   }
413   static int         format_bits    (int code, boolean is_wide) { return flags(code, is_wide) &amp; _all_fmt_bits; }
414   static boolean     has_all_flags  (int code, int test_flags, boolean is_wide) {
415     return (flags(code, is_wide) &amp; test_flags) == test_flags;
416   }
417 
418   static char compute_flags(String format) {
419     return compute_flags(format, 0);
420   }
421   static char compute_flags(String format, int more_flags) {
422     if (format == null)  return 0;  // not even more_flags
423     int flags = more_flags;
424     int fp = 0;
425     if (format.length() == 0) {
426       flags |= _fmt_not_simple; // but variable
427     } else {
428       switch (format.charAt(fp)) {
429       case &#39;b&#39;:
430         flags |= _fmt_not_variable;  // but simple
431         ++fp;  // skip &#39;b&#39;
432         break;
433       case &#39;w&#39;:
434         flags |= _fmt_not_variable | _fmt_not_simple;
435         ++fp;  // skip &#39;w&#39;
436       assert(format.charAt(fp) == &#39;b&#39;) : &quot;wide format must start with &#39;wb&#39;&quot;;
437         ++fp;  // skip &#39;b&#39;
438         break;
439       }
440     }
441 
442     boolean has_nbo = false, has_jbo = false;
443     int has_size = 0;
444     while (fp &lt; format.length()) {
445       int this_flag = 0;
446       char fc = format.charAt(fp++);
447       switch (fc) {
448       case &#39;_&#39;: continue;         // ignore these
449 
450       case &#39;j&#39;: this_flag = _fmt_has_j; has_jbo = true; break;
451       case &#39;k&#39;: this_flag = _fmt_has_k; has_jbo = true; break;
452       case &#39;i&#39;: this_flag = _fmt_has_i; has_jbo = true; break;
453       case &#39;c&#39;: this_flag = _fmt_has_c; has_jbo = true; break;
454       case &#39;o&#39;: this_flag = _fmt_has_o; has_jbo = true; break;
455 
456         // uppercase versions mark native byte order (from Rewriter)
457         // actually, only the &#39;J&#39; case happens currently
458       case &#39;J&#39;: this_flag = _fmt_has_j; has_nbo = true; break;
459       case &#39;K&#39;: this_flag = _fmt_has_k; has_nbo = true; break;
460       case &#39;I&#39;: this_flag = _fmt_has_i; has_nbo = true; break;
461       case &#39;C&#39;: this_flag = _fmt_has_c; has_nbo = true; break;
462       case &#39;O&#39;: this_flag = _fmt_has_o; has_nbo = true; break;
463       default:  assert false : &quot;bad char in format&quot;;
464       }
465 
466       flags |= this_flag;
467 
468       assert !(has_jbo &amp;&amp; has_nbo) : &quot;mixed byte orders in format&quot;;
469       if (has_nbo)
470         flags |= _fmt_has_nbo;
471 
472       int this_size = 1;
473       if (fp &lt; format.length() &amp;&amp; format.charAt(fp) == fc) {
474         // advance beyond run of the same characters
475         this_size = 2;
476         while (fp  + 1 &lt; format.length() &amp;&amp; format.charAt(++fp) == fc)  this_size++;
477         switch (this_size) {
478         case 2: flags |= _fmt_has_u2; break;
479         case 4: flags |= _fmt_has_u4; break;
480         default: assert false : &quot;bad rep count in format&quot;;
481         }
482       }
483       assert has_size == 0 ||                     // no field yet
484         this_size == has_size ||             // same size
485         this_size &lt; has_size &amp;&amp; fp == format.length() : // last field can be short
486              &quot;mixed field sizes in format&quot;;
487       has_size = this_size;
488     }
489 
490     assert flags == (char)flags : &quot;change _format_flags&quot;;
491     return (char)flags;
492   }
493 
494 
495   //----------------------------------------------------------------------
496   // Internals only below this point
497   //
498 
499   private static String[]    _name;
500   private static String[]    _format;
501   private static String[]    _wide_format;
502   private static int[]       _result_type;
503   private static byte[]      _depth;
504   private static byte[]      _lengths;
505   private static int[]       _java_code;
506   private static char[]      _flags;
507 
508   static {
509     _name           = new String [number_of_codes];
510     _format         = new String [number_of_codes];
511     _wide_format    = new String [number_of_codes];
512     _result_type    = new int    [number_of_codes]; // See BasicType.java
513     _depth          = new byte   [number_of_codes];
514     _lengths        = new byte   [number_of_codes];
515     _java_code      = new int    [number_of_codes];
516     _flags          = new char[256 * 2]; // all second page for wide formats
517 
518     // In case we want to fetch this information from the VM in the
519     // future
520     VM.registerVMInitializedObserver(new Observer() {
521         public void update(Observable o, Object data) {
522           initialize();
523         }
524       });
525   }
526 
527   private static final int jintSize    =   4;
528 
529   //  private static String[]    _name           = new String [number_of_codes];
530   //  private static String[]    _format         = new String [number_of_codes];
531   //  private static String[]    _wide_format    = new String [number_of_codes];
532   //  private static int[]       _result_type    = new int    [number_of_codes]; // See BasicType.java
533   //  private static byte[]      _depth          = new byte   [number_of_codes];
534   //  private static byte[]      _length         = new byte   [number_of_codes];
535   //  private static boolean[]   _can_trap       = new boolean[number_of_codes];
536   //  private static int[]       _java_code      = new int    [number_of_codes];
537   //  private static boolean[]   _can_rewrite    = new boolean[number_of_codes];
538 
539   // Initialization
540   private static void initialize() {
541     if (Assert.ASSERTS_ENABLED) {
542       Assert.that(number_of_codes &lt;= 256, &quot;too many bytecodes&quot;);
543     }
544 
545     // Format strings interpretation:
546     //
547     // b: bytecode
548     // c: signed constant, Java byte-ordering
549     // i: unsigned index , Java byte-ordering
550     // j: unsigned index , native byte-ordering
551     // o: branch offset  , Java byte-ordering
552     // _: unused/ignored
553     // w: wide bytecode
554     //
555     // Note: Right now the format strings are used for 2 purposes:
556     //       1. to specify the length of the bytecode
557     //          (= number of characters in format string)
558     //       2. to specify the bytecode attributes
559     //
560     //       The bytecode attributes are currently used only for bytecode tracing
561     //       (see BytecodeTracer); thus if more specific format information is
562     //       used, one would also have to adjust the bytecode tracer.
563     //
564     // Note: For bytecodes with variable length, the format string is the empty string.
565 
566     // Note 1: null for the format string means the bytecode doesn&#39;t exist
567     //         in that form.
568     //
569     // Note 2: The result type is T_ILLEGAL for bytecodes where the top of stack
570     //         type after execution is not only determined by the bytecode itself.
571 
572     //  Java bytecodes
573     //  bytecode               bytecode name           format   wide f.   result tp                stk traps
574     def(_nop                 , &quot;nop&quot;                 , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, false);
575     def(_aconst_null         , &quot;aconst_null&quot;         , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
576     def(_iconst_m1           , &quot;iconst_m1&quot;           , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
577     def(_iconst_0            , &quot;iconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
578     def(_iconst_1            , &quot;iconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
579     def(_iconst_2            , &quot;iconst_2&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
580     def(_iconst_3            , &quot;iconst_3&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
581     def(_iconst_4            , &quot;iconst_4&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
582     def(_iconst_5            , &quot;iconst_5&quot;            , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
583     def(_lconst_0            , &quot;lconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
584     def(_lconst_1            , &quot;lconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
585     def(_fconst_0            , &quot;fconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
586     def(_fconst_1            , &quot;fconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
587     def(_fconst_2            , &quot;fconst_2&quot;            , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
588     def(_dconst_0            , &quot;dconst_0&quot;            , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
589     def(_dconst_1            , &quot;dconst_1&quot;            , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
590     def(_bipush              , &quot;bipush&quot;              , &quot;bc&quot;   , null    , BasicType.getTInt()    ,  1, false);
591     def(_sipush              , &quot;sipush&quot;              , &quot;bcc&quot;  , null    , BasicType.getTInt()    ,  1, false);
592     def(_ldc                 , &quot;ldc&quot;                 , &quot;bk&quot;   , null    , BasicType.getTIllegal(),  1, true );
593     def(_ldc_w               , &quot;ldc_w&quot;               , &quot;bkk&quot;  , null    , BasicType.getTIllegal(),  1, true );
594     def(_ldc2_w              , &quot;ldc2_w&quot;              , &quot;bkk&quot;  , null    , BasicType.getTIllegal(),  2, true );
595     def(_iload               , &quot;iload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTInt()    ,  1, false);
596     def(_lload               , &quot;lload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTLong()   ,  2, false);
597     def(_fload               , &quot;fload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTFloat()  ,  1, false);
598     def(_dload               , &quot;dload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTDouble() ,  2, false);
599     def(_aload               , &quot;aload&quot;               , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTObject() ,  1, false);
600     def(_iload_0             , &quot;iload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
601     def(_iload_1             , &quot;iload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
602     def(_iload_2             , &quot;iload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
603     def(_iload_3             , &quot;iload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    ,  1, false);
604     def(_lload_0             , &quot;lload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
605     def(_lload_1             , &quot;lload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
606     def(_lload_2             , &quot;lload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
607     def(_lload_3             , &quot;lload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   ,  2, false);
608     def(_fload_0             , &quot;fload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
609     def(_fload_1             , &quot;fload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
610     def(_fload_2             , &quot;fload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
611     def(_fload_3             , &quot;fload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  1, false);
612     def(_dload_0             , &quot;dload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
613     def(_dload_1             , &quot;dload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
614     def(_dload_2             , &quot;dload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
615     def(_dload_3             , &quot;dload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() ,  2, false);
616     def(_aload_0             , &quot;aload_0&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, true ); // rewriting in interpreter
617     def(_aload_1             , &quot;aload_1&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
618     def(_aload_2             , &quot;aload_2&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
619     def(_aload_3             , &quot;aload_3&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, false);
620     def(_iaload              , &quot;iaload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
621     def(_laload              , &quot;laload&quot;              , &quot;b&quot;    , null    , BasicType.getTLong()   ,  0, true );
622     def(_faload              , &quot;faload&quot;              , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, true );
623     def(_daload              , &quot;daload&quot;              , &quot;b&quot;    , null    , BasicType.getTDouble() ,  0, true );
624     def(_aaload              , &quot;aaload&quot;              , &quot;b&quot;    , null    , BasicType.getTObject() , -1, true );
625     def(_baload              , &quot;baload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
626     def(_caload              , &quot;caload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
627     def(_saload              , &quot;saload&quot;              , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
628     def(_istore              , &quot;istore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -1, false);
629     def(_lstore              , &quot;lstore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -2, false);
630     def(_fstore              , &quot;fstore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -1, false);
631     def(_dstore              , &quot;dstore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -2, false);
632     def(_astore              , &quot;astore&quot;              , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   , -1, false);
633     def(_istore_0            , &quot;istore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
634     def(_istore_1            , &quot;istore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
635     def(_istore_2            , &quot;istore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
636     def(_istore_3            , &quot;istore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
637     def(_lstore_0            , &quot;lstore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
638     def(_lstore_1            , &quot;lstore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
639     def(_lstore_2            , &quot;lstore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
640     def(_lstore_3            , &quot;lstore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
641     def(_fstore_0            , &quot;fstore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
642     def(_fstore_1            , &quot;fstore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
643     def(_fstore_2            , &quot;fstore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
644     def(_fstore_3            , &quot;fstore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
645     def(_dstore_0            , &quot;dstore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
646     def(_dstore_1            , &quot;dstore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
647     def(_dstore_2            , &quot;dstore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
648     def(_dstore_3            , &quot;dstore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
649     def(_astore_0            , &quot;astore_0&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
650     def(_astore_1            , &quot;astore_1&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
651     def(_astore_2            , &quot;astore_2&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
652     def(_astore_3            , &quot;astore_3&quot;            , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
653     def(_iastore             , &quot;iastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
654     def(_lastore             , &quot;lastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -4, true );
655     def(_fastore             , &quot;fastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
656     def(_dastore             , &quot;dastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -4, true );
657     def(_aastore             , &quot;aastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
658     def(_bastore             , &quot;bastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
659     def(_castore             , &quot;castore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
660     def(_sastore             , &quot;sastore&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, true );
661     def(_pop                 , &quot;pop&quot;                 , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
662     def(_pop2                , &quot;pop2&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   , -2, false);
663     def(_dup                 , &quot;dup&quot;                 , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  1, false);
664     def(_dup_x1              , &quot;dup_x1&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  1, false);
665     def(_dup_x2              , &quot;dup_x2&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  1, false);
666     def(_dup2                , &quot;dup2&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  2, false);
667     def(_dup2_x1             , &quot;dup2_x1&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  2, false);
668     def(_dup2_x2             , &quot;dup2_x2&quot;             , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  2, false);
669     def(_swap                , &quot;swap&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, false);
670     def(_iadd                , &quot;iadd&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
671     def(_ladd                , &quot;ladd&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
672     def(_fadd                , &quot;fadd&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
673     def(_dadd                , &quot;dadd&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
674     def(_isub                , &quot;isub&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
675     def(_lsub                , &quot;lsub&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
676     def(_fsub                , &quot;fsub&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
677     def(_dsub                , &quot;dsub&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
678     def(_imul                , &quot;imul&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
679     def(_lmul                , &quot;lmul&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
680     def(_fmul                , &quot;fmul&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
681     def(_dmul                , &quot;dmul&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
682     def(_idiv                , &quot;idiv&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
683     def(_ldiv                , &quot;ldiv&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, true );
684     def(_fdiv                , &quot;fdiv&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
685     def(_ddiv                , &quot;ddiv&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
686     def(_irem                , &quot;irem&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
687     def(_lrem                , &quot;lrem&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, true );
688     def(_frem                , &quot;frem&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
689     def(_drem                , &quot;drem&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, false);
690     def(_ineg                , &quot;ineg&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    ,  0, false);
691     def(_lneg                , &quot;lneg&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   ,  0, false);
692     def(_fneg                , &quot;fneg&quot;                , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  0, false);
693     def(_dneg                , &quot;dneg&quot;                , &quot;b&quot;    , null    , BasicType.getTDouble() ,  0, false);
694     def(_ishl                , &quot;ishl&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
695     def(_lshl                , &quot;lshl&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -1, false);
696     def(_ishr                , &quot;ishr&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
697     def(_lshr                , &quot;lshr&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -1, false);
698     def(_iushr               , &quot;iushr&quot;               , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
699     def(_lushr               , &quot;lushr&quot;               , &quot;b&quot;    , null    , BasicType.getTLong()   , -1, false);
700     def(_iand                , &quot;iand&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
701     def(_land                , &quot;land&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
702     def(_ior                 , &quot;ior&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
703     def(_lor                 , &quot;lor&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
704     def(_ixor                , &quot;ixor&quot;                , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
705     def(_lxor                , &quot;lxor&quot;                , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, false);
706     def(_iinc                , &quot;iinc&quot;                , &quot;bic&quot;  , &quot;wbiicc&quot;, BasicType.getTVoid()   ,  0, false);
707     def(_i2l                 , &quot;i2l&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   ,  1, false);
708     def(_i2f                 , &quot;i2f&quot;                 , &quot;b&quot;    , null    , BasicType.getTFloat()  ,  0, false);
709     def(_i2d                 , &quot;i2d&quot;                 , &quot;b&quot;    , null    , BasicType.getTDouble() ,  1, false);
710     def(_l2i                 , &quot;l2i&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
711     def(_l2f                 , &quot;l2f&quot;                 , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
712     def(_l2d                 , &quot;l2d&quot;                 , &quot;b&quot;    , null    , BasicType.getTDouble() ,  0, false);
713     def(_f2i                 , &quot;f2i&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    ,  0, false);
714     def(_f2l                 , &quot;f2l&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   ,  1, false);
715     def(_f2d                 , &quot;f2d&quot;                 , &quot;b&quot;    , null    , BasicType.getTDouble() ,  1, false);
716     def(_d2i                 , &quot;d2i&quot;                 , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, false);
717     def(_d2l                 , &quot;d2l&quot;                 , &quot;b&quot;    , null    , BasicType.getTLong()   ,  0, false);
718     def(_d2f                 , &quot;d2f&quot;                 , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, false);
719     def(_i2b                 , &quot;i2b&quot;                 , &quot;b&quot;    , null    , BasicType.getTByte()   ,  0, false);
720     def(_i2c                 , &quot;i2c&quot;                 , &quot;b&quot;    , null    , BasicType.getTChar()   ,  0, false);
721     def(_i2s                 , &quot;i2s&quot;                 , &quot;b&quot;    , null    , BasicType.getTShort()  ,  0, false);
722     def(_lcmp                , &quot;lcmp&quot;                , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, false);
723     def(_fcmpl               , &quot;fcmpl&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
724     def(_fcmpg               , &quot;fcmpg&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, false);
725     def(_dcmpl               , &quot;dcmpl&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, false);
726     def(_dcmpg               , &quot;dcmpg&quot;               , &quot;b&quot;    , null    , BasicType.getTVoid()   , -3, false);
727     def(_ifeq                , &quot;ifeq&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
728     def(_ifne                , &quot;ifne&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
729     def(_iflt                , &quot;iflt&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
730     def(_ifge                , &quot;ifge&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
731     def(_ifgt                , &quot;ifgt&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
732     def(_ifle                , &quot;ifle&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
733     def(_if_icmpeq           , &quot;if_icmpeq&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
734     def(_if_icmpne           , &quot;if_icmpne&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
735     def(_if_icmplt           , &quot;if_icmplt&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
736     def(_if_icmpge           , &quot;if_icmpge&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
737     def(_if_icmpgt           , &quot;if_icmpgt&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
738     def(_if_icmple           , &quot;if_icmple&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
739     def(_if_acmpeq           , &quot;if_acmpeq&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
740     def(_if_acmpne           , &quot;if_acmpne&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -2, false);
741     def(_goto                , &quot;goto&quot;                , &quot;boo&quot;  , null    , BasicType.getTVoid()   ,  0, false);
742     def(_jsr                 , &quot;jsr&quot;                 , &quot;boo&quot;  , null    , BasicType.getTInt()    ,  0, false);
743     def(_ret                 , &quot;ret&quot;                 , &quot;bi&quot;   , &quot;wbii&quot;  , BasicType.getTVoid()   ,  0, false);
744     def(_tableswitch         , &quot;tableswitch&quot;         , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false); // may have backward branches
745     def(_lookupswitch        , &quot;lookupswitch&quot;        , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false); // rewriting in interpreter
746     def(_ireturn             , &quot;ireturn&quot;             , &quot;b&quot;    , null    , BasicType.getTInt()    , -1, true );
747     def(_lreturn             , &quot;lreturn&quot;             , &quot;b&quot;    , null    , BasicType.getTLong()   , -2, true );
748     def(_freturn             , &quot;freturn&quot;             , &quot;b&quot;    , null    , BasicType.getTFloat()  , -1, true );
749     def(_dreturn             , &quot;dreturn&quot;             , &quot;b&quot;    , null    , BasicType.getTDouble() , -2, true );
750     def(_areturn             , &quot;areturn&quot;             , &quot;b&quot;    , null    , BasicType.getTObject() , -1, true );
751     def(_return              , &quot;return&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, true );
752     def(_getstatic           , &quot;getstatic&quot;           , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(),  1, true );
753     def(_putstatic           , &quot;putstatic&quot;           , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true );
754     def(_getfield            , &quot;getfield&quot;            , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(),  0, true );
755     def(_putfield            , &quot;putfield&quot;            , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -2, true );
756     def(_invokevirtual       , &quot;invokevirtual&quot;       , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true );
757     def(_invokespecial       , &quot;invokespecial&quot;       , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true );
758     def(_invokestatic        , &quot;invokestatic&quot;        , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(),  0, true );
759     def(_invokeinterface     , &quot;invokeinterface&quot;     , &quot;bJJ__&quot;, null    , BasicType.getTIllegal(), -1, true );
760     def(_invokedynamic       , &quot;invokedynamic&quot;       , &quot;bJJJJ&quot;, null    , BasicType.getTIllegal(),  0, true );
761     def(_new                 , &quot;new&quot;                 , &quot;bkk&quot;  , null    , BasicType.getTObject() ,  1, true );
762     def(_newarray            , &quot;newarray&quot;            , &quot;bc&quot;   , null    , BasicType.getTObject() ,  0, true );
763     def(_anewarray           , &quot;anewarray&quot;           , &quot;bkk&quot;  , null    , BasicType.getTObject() ,  0, true );
764     def(_arraylength         , &quot;arraylength&quot;         , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, true );
765     def(_athrow              , &quot;athrow&quot;              , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, true );
766     def(_checkcast           , &quot;checkcast&quot;           , &quot;bkk&quot;  , null    , BasicType.getTObject() ,  0, true );
767     def(_instanceof          , &quot;instanceof&quot;          , &quot;bkk&quot;  , null    , BasicType.getTInt()    ,  0, true );
768     def(_monitorenter        , &quot;monitorenter&quot;        , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, true );
769     def(_monitorexit         , &quot;monitorexit&quot;         , &quot;b&quot;    , null    , BasicType.getTVoid()   , -1, true );
770     def(_wide                , &quot;wide&quot;                , &quot;&quot;     , null    , BasicType.getTVoid()   ,  0, false);
771     def(_multianewarray      , &quot;multianewarray&quot;      , &quot;bkkc&quot; , null    , BasicType.getTObject() ,  1, true );
772     def(_ifnull              , &quot;ifnull&quot;              , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
773     def(_ifnonnull           , &quot;ifnonnull&quot;           , &quot;boo&quot;  , null    , BasicType.getTVoid()   , -1, false);
774     def(_goto_w              , &quot;goto_w&quot;              , &quot;boooo&quot;, null    , BasicType.getTVoid()   ,  0, false);
775     def(_jsr_w               , &quot;jsr_w&quot;               , &quot;boooo&quot;, null    , BasicType.getTInt()    ,  0, false);
776     def(_breakpoint          , &quot;breakpoint&quot;          , &quot;&quot;     , null    , BasicType.getTVoid()   ,  0, true );
777 
778     //  JVM bytecodes
779     //  bytecode               bytecode name           format   wide f.   result tp               stk traps  std code
780 
781     def(_fast_agetfield      , &quot;fast_agetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTObject() ,  0, true , _getfield       );
782     def(_fast_bgetfield      , &quot;fast_bgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _getfield       );
783     def(_fast_cgetfield      , &quot;fast_cgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTChar()   ,  0, true , _getfield       );
784     def(_fast_dgetfield      , &quot;fast_dgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTDouble() ,  0, true , _getfield       );
785     def(_fast_fgetfield      , &quot;fast_fgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTFloat()  ,  0, true , _getfield       );
786     def(_fast_igetfield      , &quot;fast_igetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _getfield       );
787     def(_fast_lgetfield      , &quot;fast_lgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTLong()   ,  0, true , _getfield       );
788     def(_fast_sgetfield      , &quot;fast_sgetfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTShort()  ,  0, true , _getfield       );
789 
790     def(_fast_aputfield      , &quot;fast_aputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTObject() ,  0, true , _putfield       );
791     def(_fast_bputfield      , &quot;fast_bputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _putfield       );
792     def(_fast_zputfield      , &quot;fast_zputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _putfield       );
793     def(_fast_cputfield      , &quot;fast_cputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTChar()   ,  0, true , _putfield       );
794     def(_fast_dputfield      , &quot;fast_dputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTDouble() ,  0, true , _putfield       );
795     def(_fast_fputfield      , &quot;fast_fputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTFloat()  ,  0, true , _putfield       );
796     def(_fast_iputfield      , &quot;fast_iputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTInt()    ,  0, true , _putfield       );
797     def(_fast_lputfield      , &quot;fast_lputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTLong()   ,  0, true , _putfield       );
798     def(_fast_sputfield      , &quot;fast_sputfield&quot;      , &quot;bJJ&quot;  , null    , BasicType.getTShort()  ,  0, true , _putfield       );
799 
800     def(_fast_aload_0        , &quot;fast_aload_0&quot;        , &quot;b&quot;    , null    , BasicType.getTObject() ,  1, true , _aload_0        );
801     def(_fast_iaccess_0      , &quot;fast_iaccess_0&quot;      , &quot;b_JJ&quot; , null    , BasicType.getTInt()    ,  1, true , _aload_0        );
802     def(_fast_aaccess_0      , &quot;fast_aaccess_0&quot;      , &quot;b_JJ&quot; , null    , BasicType.getTObject() ,  1, true , _aload_0        );
803     def(_fast_faccess_0      , &quot;fast_faccess_0&quot;      , &quot;b_JJ&quot; , null    , BasicType.getTObject() ,  1, true , _aload_0        );
804 
805     def(_fast_iload          , &quot;fast_iload&quot;          , &quot;bi&quot;   , null    , BasicType.getTInt()    ,  1, false, _iload          );
806     def(_fast_iload2         , &quot;fast_iload2&quot;         , &quot;bi_i&quot; , null    , BasicType.getTInt()    ,  2, false, _iload          );
807     def(_fast_icaload        , &quot;fast_icaload&quot;        , &quot;bi_&quot;  , null    , BasicType.getTInt()    ,  0, false, _iload          );
808 
809     // Faster method invocation.
810     def(_fast_invokevfinal   , &quot;fast_invokevfinal&quot;   , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true, _invokevirtual   );
811 
812     def(_fast_linearswitch   , &quot;fast_linearswitch&quot;   , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false, _lookupswitch   );
813     def(_fast_binaryswitch   , &quot;fast_binaryswitch&quot;   , &quot;&quot;     , null    , BasicType.getTVoid()   , -1, false, _lookupswitch   );
814     def(_fast_aldc           , &quot;fast_aldc&quot;           , &quot;bj&quot;   , null    , BasicType.getTObject(),   1, true,  _ldc            );
815     def(_fast_aldc_w         , &quot;fast_aldc_w&quot;         , &quot;bJJ&quot;  , null    , BasicType.getTObject(),   1, true,  _ldc_w          );
816 
817     def(_return_register_finalizer, &quot;return_register_finalizer&quot;, &quot;b&quot;    , null    , BasicType.getTVoid()   , 0, true, _return );
818 
819     // special handling of signature-polymorphic methods
820     def(_invokehandle        , &quot;invokehandle&quot;        , &quot;bJJ&quot;  , null    , BasicType.getTIllegal(), -1, true, _invokevirtual   );
821 
822     // CDS specific. Bytecodes rewritten at CDS dump time
823     def(_nofast_getfield     , &quot;_nofast_getfield&quot;    , &quot;bJJ&quot;  , null    , BasicType.getTIllegal() , 0, true,  _getfield );
824     def(_nofast_putfield     , &quot;_nofast_putfield&quot;    , &quot;bJJ&quot;  , null    , BasicType.getTIllegal() ,-2, true,  _putfield );
825     def(_nofast_aload_0      , &quot;_nofast_aload_0&quot;     , &quot;b&quot;    , null    , BasicType.getTIllegal() , 1, true,  _aload_0  );
826     def(_nofast_iload        , &quot;_nofast_iload&quot;       , &quot;bi&quot;   , null    , BasicType.getTIllegal() , 1, false, _iload    );
827 
828     def(_shouldnotreachhere  , &quot;_shouldnotreachhere&quot; , &quot;b&quot;    , null    , BasicType.getTVoid()   ,  0, false);
829 
830     if (Assert.ASSERTS_ENABLED) {
831       // compare can_trap information for each bytecode with the
832       // can_trap information for the corresponding base bytecode
833       // (if a rewritten bytecode can trap, so must the base bytecode)
834       for (int i = 0; i &lt; number_of_codes; i++) {
835         if (isDefined(i)) {
836           int j = javaCode(i);
837           if (canTrap(i) &amp;&amp; !canTrap(j)) {
838             Assert.that(false, name(i) + &quot; can trap =&gt; &quot; + name(j) + &quot; can trap, too&quot;);
839           }
840         }
841       }
842     }
843   }
844 
845   private static void def(int code, String name, String format, String wide_format, int result_type, int depth, boolean can_trap) {
846     def(code, name, format, wide_format, result_type, depth, can_trap, code);
847   }
848 
849   private static void def(int code, String name, String format, String wide_format, int result_type, int depth, boolean can_trap, int java_code) {
850     if (Assert.ASSERTS_ENABLED) {
851       Assert.that(wide_format == null || format != null, &quot;short form must exist if there&#39;s a wide form&quot;);
852     }
853     int len  = (format      != null ? format.length()      : 0);
854     int wlen = (wide_format != null ? wide_format.length() : 0);
855     _name          [code] = name;
856     _result_type   [code] = result_type;
857     _depth         [code] = (byte) depth;
858     _lengths       [code] = (byte)((wlen &lt;&lt; 4) | (len &amp; 0xF));
859     _java_code     [code] = java_code;
860     _format        [code] = format;
861     _wide_format   [code] = wide_format;
862     int bc_flags = 0;
863     if (can_trap)           bc_flags |= _bc_can_trap;
864     if (java_code != code)  bc_flags |= _bc_can_rewrite;
865     _flags[code+0*256] = compute_flags(format,      bc_flags);
866     _flags[code+1*256] = compute_flags(wide_format, bc_flags);
867   }
868 }
    </pre>
  </body>
</html>