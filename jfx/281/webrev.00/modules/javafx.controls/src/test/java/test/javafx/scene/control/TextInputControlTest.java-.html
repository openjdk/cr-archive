<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.controls/src/test/java/test/javafx/scene/control/TextInputControlTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import javafx.beans.InvalidationListener;
  29 import javafx.beans.Observable;
  30 import javafx.beans.property.BooleanProperty;
  31 import javafx.beans.property.SimpleBooleanProperty;
  32 import javafx.beans.property.SimpleStringProperty;
  33 import javafx.beans.property.StringProperty;
  34 import javafx.beans.value.ChangeListener;
  35 import javafx.beans.value.ObservableValue;
  36 import javafx.css.CssMetaData;
  37 import javafx.css.StyleableProperty;
  38 import javafx.event.EventHandler;
  39 import javafx.scene.Scene;
  40 import javafx.scene.input.KeyCode;
  41 import javafx.scene.input.KeyEvent;
  42 import javafx.scene.input.Clipboard;
  43 import javafx.scene.input.ClipboardContent;
  44 import javafx.scene.text.Font;
  45 import javafx.scene.layout.StackPane;
  46 import javafx.stage.Stage;
  47 import java.util.Arrays;
  48 import java.util.Collection;
  49 import javafx.scene.control.IndexRange;
  50 import javafx.scene.control.PasswordField;
  51 import javafx.scene.control.TextArea;
  52 import javafx.scene.control.TextField;
  53 import javafx.scene.control.TextInputControl;
  54 import com.sun.javafx.tk.Toolkit;
  55 
  56 import org.junit.After;
  57 import org.junit.Before;
  58 import org.junit.Test;
  59 import org.junit.runner.RunWith;
  60 import org.junit.runners.Parameterized;
  61 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  62 import test.com.sun.javafx.pgstub.StubToolkit;
  63 import static org.junit.Assert.assertEquals;
  64 import static org.junit.Assert.assertFalse;
  65 import static org.junit.Assert.assertNull;
  66 import static org.junit.Assert.assertTrue;
  67 import static org.junit.Assert.fail;
  68 /**
  69  */
  70 @RunWith(Parameterized.class)
  71 public class TextInputControlTest {
  72     @SuppressWarnings(&quot;rawtypes&quot;)
  73     @Parameterized.Parameters public static Collection implementations() {
  74         return Arrays.asList(new Object[][]{
  75                 {TextField.class},
  76                 {PasswordField.class},
  77                 {TextArea.class}
  78         });
  79     }
  80 
  81     private TextInputControl textInput;
  82     private Class type;
  83 
  84     public TextInputControlTest(Class type) {
  85         this.type = type;
  86     }
  87 
  88     @Before public void setup() throws Exception {
  89         textInput = (TextInputControl) type.newInstance();
  90         setUncaughtExceptionHandler();
  91     }
  92 
  93     @After public void cleanup() {
  94         removeUncaughtExceptionHandler();
  95     }
  96 
  97     private void setUncaughtExceptionHandler() {
  98         Thread.currentThread().setUncaughtExceptionHandler((thread, throwable) -&gt; {
  99             if (throwable instanceof RuntimeException) {
 100                 throw (RuntimeException)throwable;
 101             } else {
 102                 Thread.currentThread().getThreadGroup().uncaughtException(thread, throwable);
 103             }
 104         });
 105     }
 106 
 107     private void removeUncaughtExceptionHandler() {
 108         Thread.currentThread().setUncaughtExceptionHandler(null);
 109     }
 110 
 111     /******************************************************
 112      * Test the default states                            *
 113      *****************************************************/
 114 
 115     @Test public void textDefaultsToEmptyString() {
 116         assertEquals(&quot;&quot;, textInput.getText());
 117     }
 118 
 119     @Test public void editableDefaultsToTrue() {
 120         assertTrue(textInput.isEditable());
 121     }
 122 
 123     @Test public void anchorDefaultsToZero() {
 124         assertEquals(0, textInput.getAnchor());
 125     }
 126 
 127     @Test public void caretPositionDefaultsToZero() {
 128         assertEquals(0, textInput.getCaretPosition());
 129     }
 130 
 131     @Test public void lengthDefaultsToZero() {
 132         assertEquals(0, textInput.getLength());
 133     }
 134 
 135     @Test public void selectedTextDefaultsToEmptyString() {
 136         assertEquals(&quot;&quot;, textInput.getSelectedText());
 137     }
 138 
 139     @Test public void selectionDefaultsToEmpty() {
 140         assertEquals(0, textInput.getSelection().getLength());
 141     }
 142 
 143     @Test public void selectionStartDefaultsToZero() {
 144         assertEquals(0, textInput.getSelection().getStart());
 145     }
 146 
 147     @Test public void selectionEndDefaultsToZero() {
 148         assertEquals(0, textInput.getSelection().getEnd());
 149     }
 150 
 151     /*********************************************************************
 152      * Tests for CSS                                                     *
 153      ********************************************************************/
 154 
 155     @Test public void fontSetFromCSS() {
 156         textInput.setStyle(&quot;-fx-font: 24 Helvetica&quot;);
 157         Scene s = new Scene(textInput);
 158         textInput.applyCss();
 159         assertEquals(Font.font(&quot;Helvetica&quot;, 24), textInput.getFont());
 160     }
 161 
 162     /******************************************************
 163      * Test for text                                      *
 164      *****************************************************/
 165 
 166     @Test public void settingTextUpdatesTheText() {
 167         textInput.setText(&quot;This is a test&quot;);
 168         assertEquals(&quot;This is a test&quot;, textInput.getText());
 169         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 170     }
 171 
 172     @Test public void textCanBeNull() {
 173         textInput.setText(null);
 174         assertNull(textInput.getText());
 175     }
 176 
 177     @Test public void textCanBeSwitchedBetweenNullAndAValue() {
 178         textInput.setText(null);
 179         textInput.setText(&quot;Test&quot;);
 180         assertEquals(&quot;Test&quot;, textInput.getText());
 181     }
 182 
 183     @Test public void textCanBeSwitchedFromAValueToNull() {
 184         textInput.setText(&quot;Test&quot;);
 185         textInput.setText(null);
 186         assertNull(textInput.getText());
 187     }
 188 
 189     @Test public void textIsNullThenBoundThenUnboundAndShouldReturnTheValueWhenBound() {
 190         textInput.setText(null);
 191         StringProperty other = new SimpleStringProperty(&quot;Peppers&quot;);
 192         textInput.textProperty().bind(other);
 193         textInput.textProperty().unbind();
 194         assertEquals(&quot;Peppers&quot;, textInput.getText());
 195     }
 196 
 197     @Test public void textHasValueThenIsBoundToNullShouldReturnNullFromGet() {
 198         textInput.setText(&quot;Value&quot;);
 199         StringProperty other = new SimpleStringProperty(null);
 200         textInput.textProperty().bind(other);
 201         assertNull(textInput.getText());
 202     }
 203 
 204     @Test public void textHasValueThenIsBoundToNullAndUnboundShouldReturnNullFromGet() {
 205         textInput.setText(&quot;Value&quot;);
 206         StringProperty other = new SimpleStringProperty(null);
 207         textInput.textProperty().bind(other);
 208         textInput.textProperty().unbind();
 209         assertNull(textInput.getText());
 210     }
 211 
 212     @Test public void textHasValueThenIsBoundToNullAndUnboundThenSetShouldReturnNewValueFromGet() {
 213         textInput.setText(&quot;Value&quot;);
 214         StringProperty other = new SimpleStringProperty(null);
 215         textInput.textProperty().bind(other);
 216         textInput.textProperty().unbind();
 217         textInput.setText(&quot;New Value&quot;);
 218         assertEquals(&quot;New Value&quot;, textInput.getText());
 219     }
 220 
 221     @Test public void textCanBeBound() {
 222         StringProperty other = new SimpleStringProperty(&quot;Apples&quot;);
 223         textInput.textProperty().bind(other);
 224         assertEquals(&quot;Apples&quot;, textInput.getText());
 225         other.set(&quot;Oranges&quot;);
 226         assertEquals(&quot;Oranges&quot;, textInput.getText());
 227     }
 228 
 229     @Test public void cannotSpecifyTextViaCSS() {
 230         try {
 231             CssMetaData styleable = ((StyleableProperty)textInput.textProperty()).getCssMetaData();
 232             assertNull(styleable);
 233         } catch (ClassCastException ignored) {
 234             // pass!
 235         } catch (Exception e) {
 236             org.junit.Assert.fail(e.toString());
 237         }
 238     }
 239 
 240     @Test public void settingTextNotifiesOfChange() {
 241         final boolean[] passed = new boolean[] { false };
 242         textInput.textProperty().addListener((observable, oldValue, newValue) -&gt; {
 243             passed[0] = true;
 244         });
 245         textInput.setText(&quot;Apples&quot;);
 246         assertTrue(passed[0]);
 247     }
 248 
 249     // Test for JDK-8212102
 250     @Test public void testControlCharacters() {
 251         try {
 252             String cc = &quot;\r\n\n&quot;;
 253             String str = &quot;123456&quot;;
 254 
 255             textInput.setText(cc);
 256 
 257             textInput.setText(str);
 258             textInput.replaceText(0, 6, cc);
 259 
 260             textInput.setText(str);
 261             textInput.replaceText(new IndexRange(0, 6), cc);
 262 
 263             textInput.setText(str);
 264             textInput.selectAll();
 265             textInput.replaceSelection(cc);
 266 
 267             textInput.setText(str);
 268             textInput.selectRange(0, 6);
 269             textInput.replaceSelection(cc);
 270 
 271         } catch (Exception e) {
 272             fail(&quot;Control characters(\\r\\n) caused Exception: &quot; + e);
 273         }
 274     }
 275 
 276     @Test public void controlCharactersAreOmitted_setText_getText() {
 277         String s = &quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;;
 278         textInput.setText(s);
 279         assertEquals(&quot;This is a test&quot;, textInput.getText());
 280     }
 281 
 282     @Test public void controlCharactersAreOmitted_setText_textProperty_get() {
 283         String s = &quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;;
 284         textInput.setText(s);
 285         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 286     }
 287 
 288     @Test public void controlCharactersAreOmitted_bound_getText() {
 289         StringProperty other = new SimpleStringProperty(&quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;);
 290         textInput.textProperty().bind(other);
 291         assertEquals(&quot;This is a test&quot;, textInput.getText());
 292         other.set(&quot;Bro&quot; + &#39;\5&#39; + &quot;ken&quot;);
 293         assertEquals(&quot;Broken&quot;, textInput.getText());
 294     }
 295 
 296     @Test public void controlCharactersAreOmitted_bound_textProperty_get() {
 297         StringProperty other = new SimpleStringProperty(&quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;);
 298         textInput.textProperty().bind(other);
 299         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 300         other.set(&quot;Bro&quot; + &#39;\5&#39; + &quot;ken&quot;);
 301         assertEquals(&quot;Broken&quot;, textInput.textProperty().get());
 302     }
 303 
 304     // selection is changed when text is changed??
 305     // anchor and caret position updated when selection is changed due to text change??
 306     // selected text is updated when selection changes due to a text change??
 307     // length is updated when text changes
 308 
 309     /******************************************************
 310      * Test for editable                                  *
 311      *****************************************************/
 312 
 313     @Test public void settingEditableValueShouldWork() {
 314         textInput.setEditable(false);
 315         assertFalse(textInput.isEditable());
 316     }
 317 
 318     @Test public void settingEditableAndThenCreatingAModelAndReadingTheValueStillWorks() {
 319         textInput.setEditable(false);
 320         assertFalse(textInput.editableProperty().get());
 321     }
 322 
 323     @Test public void editableCanBeBound() {
 324         BooleanProperty other = new SimpleBooleanProperty(false);
 325         textInput.editableProperty().bind(other);
 326         assertFalse(textInput.isEditable());
 327         other.set(true);
 328         assertTrue(textInput.isEditable());
 329     }
 330 
 331     @Test public void cannotSpecifyEditableViaCSS() {
 332         try {
 333             CssMetaData styleable = ((StyleableProperty)textInput.editableProperty()).getCssMetaData();
 334             assertNull(styleable);
 335         } catch (ClassCastException ignored) {
 336             // pass!
 337         } catch (Exception e) {
 338             org.junit.Assert.fail(e.toString());
 339         }
 340     }
 341 
 342     @Test public void settingEditableNotifiesOfChange() {
 343         final boolean[] passed = new boolean[] { false };
 344         textInput.editableProperty().addListener((observable, oldValue, newValue) -&gt; {
 345             passed[0] = true;
 346         });
 347         textInput.setEditable(false);
 348         assertTrue(passed[0]);
 349     }
 350 
 351     /******************************************************
 352      * Test for anchor                                    *
 353      *****************************************************/
 354 
 355     @Test public void anchorIsSetWhenSelectionChanges() {
 356         textInput.setText(&quot;The quick brown fox&quot;);
 357         textInput.selectRange(4, 9);
 358         assertEquals(4, textInput.getAnchor());
 359     }
 360 
 361     @Test public void anchorIsSetWhenSelectionChanges2() {
 362         textInput.setText(&quot;The quick brown fox&quot;);
 363         textInput.selectRange(9, 4);
 364         assertEquals(9, textInput.getAnchor());
 365     }
 366 
 367     // updated when text changes
 368     @Test public void anchorIsSetToCaretPositionWhenTextChanges() {
 369         textInput.setText(&quot;The quick brown fox&quot;);
 370         textInput.selectRange(4, 9);
 371         textInput.setText(&quot;Gone&quot;);
 372         assertEquals(textInput.getCaretPosition(), textInput.getAnchor());
 373     }
 374 
 375     /******************************************************
 376      * Test for caretPosition                             *
 377      *****************************************************/
 378 
 379     @Test public void caretPositionIsSetWhenSelectionChanges() {
 380         textInput.setText(&quot;The quick brown fox&quot;);
 381         textInput.selectRange(4, 9);
 382         assertEquals(9, textInput.getCaretPosition());
 383     }
 384 
 385     @Test public void caretPositionIsSetWhenSelectionChanges2() {
 386         textInput.setText(&quot;The quick brown fox&quot;);
 387         textInput.selectRange(9, 4);
 388         assertEquals(4, textInput.getCaretPosition());
 389     }
 390 
 391     @Test
 392     public void caretAndAnchorPositionAfterSettingText() {
 393         textInput.setText(&quot;The quick brown fox&quot;);
 394         assertEquals(0, textInput.getCaretPosition());
 395         assertEquals(0, textInput.getAnchor());
 396     }
 397 
 398     // Test for JDK-8178417
 399     @Test public void caretPositionUndo() {
 400         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
 401         StackPane root = new StackPane();
 402         Scene scene = new Scene(root);
 403         Stage stage = new Stage();
 404         String text = &quot;01234&quot;;
 405 
 406         textInput.setText(text);
 407         stage.setScene(scene);
 408         root.getChildren().removeAll();
 409         root.getChildren().add(textInput);
 410         stage.show();
 411         tk.firePulse();
 412 
 413         KeyEventFirer keyboard = new KeyEventFirer(textInput);
 414         keyboard.doKeyPress(KeyCode.HOME);
 415 
 416         for(int i = 1; i &lt; text.length() + 1; ++i) {
 417             keyboard.doKeyPress(KeyCode.RIGHT);
 418             tk.firePulse();
 419         }
 420         for(int i = 1; i &lt; text.length() + 1; ++i) {
 421             textInput.undo();
 422         }
 423         assertEquals(text.length(), textInput.getCaretPosition());
 424         root.getChildren().removeAll();
 425         stage.hide();
 426         tk.firePulse();
 427     }
 428 
 429     /******************************************************
 430      * Test for length                                    *
 431      *****************************************************/
 432 
 433     // TODO null text results in 0 length
 434 
 435     @Test public void emptyTextResultsInZeroLength() {
 436         textInput.setText(&quot;Hello&quot;);
 437         textInput.setText(&quot;&quot;);
 438         assertEquals(0, textInput.getLength());
 439     }
 440 
 441     @Test public void lengthMatchesStringLength() {
 442         final String string = &quot;Hello&quot;;
 443         textInput.setText(string);
 444         assertEquals(string.length(), textInput.getLength());
 445     }
 446 
 447     @Test public void lengthChangeNotificationWhenTextIsUpdatedToNonEmptyResult() {
 448         final boolean[] passed = new boolean[] { false };
 449         textInput.lengthProperty().addListener((observable, oldValue, newValue) -&gt; {
 450             passed[0] = true;
 451         });
 452         textInput.setText(&quot;Hello&quot;);
 453         assertTrue(passed[0]);
 454     }
 455 
 456     @Test public void lengthChangeNotificationWhenTextIsSetToEmptyResult() {
 457         textInput.setText(&quot;Goodbye&quot;);
 458         final boolean[] passed = new boolean[] { false };
 459         textInput.lengthProperty().addListener((observable, oldValue, newValue) -&gt; {
 460             passed[0] = true;
 461         });
 462         textInput.setText(&quot;&quot;);
 463         assertTrue(passed[0]);
 464     }
 465 
 466     /******************************************************
 467      * Test for maximumLength                             *
 468      *****************************************************/
 469 
 470     // set maximum length to less than current length
 471 
 472     /******************************************************
 473      * Test for selected text                             *
 474      *****************************************************/
 475 
 476     // TODO test null text and some random range
 477 
 478     @Test public void selectedTextMatchesTextAndSelection() {
 479         textInput.setText(&quot;The quick brown fox&quot;);
 480         textInput.selectRange(0, 3);
 481         assertEquals(&quot;The&quot;, textInput.getSelectedText());
 482     }
 483 
 484     @Test public void selectedTextMatchesTextAndSelection2() {
 485         textInput.setText(&quot;The quick brown fox&quot;);
 486         textInput.selectRange(4, 9);
 487         assertEquals(&quot;quick&quot;, textInput.getSelectedText());
 488     }
 489 
 490     @Test public void selectedTextMatchesTextAndSelection3() {
 491         textInput.setText(&quot;The quick brown fox&quot;);
 492         textInput.selectRange(10, 19);
 493         assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 494     }
 495 
 496     @Test public void selectedTextIsClearedWhenTextChanges() {
 497         textInput.setText(&quot;The quick brown fox&quot;);
 498         textInput.selectRange(4, 9);
 499         textInput.setText(&quot;&quot;);
 500         assertEquals(&quot;&quot;, textInput.getSelectedText());
 501     }
 502 
 503     @Test public void selectedTextWorksWhenSelectionExceedsPossibleRange() {
 504         textInput.setText(&quot;The quick brown fox&quot;);
 505         textInput.selectRange(10, 180);
 506         assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 507     }
 508 
 509     @Test public void selectedTextWorksWhenSelectionExceedsPossibleRange2() {
 510         textInput.setText(&quot;The quick brown fox&quot;);
 511         textInput.selectRange(100, 180);
 512         assertEquals(&quot;&quot;, textInput.getSelectedText());
 513     }
 514 
 515 //    @Test public void selectedTextWorksWhenSelectionIsBound() {
 516 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(4, 9));
 517 //        textInput.setText(&quot;The quick brown fox&quot;);
 518 //        textInput.selectionProperty().bind(other);
 519 //        assertEquals(&quot;quick&quot;, textInput.getSelectedText());
 520 //        other.set(new IndexRange(10, 19));
 521 //        assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 522 //    }
 523 
 524     @Test public void selectedTextWorksWhenTextIsBound() {
 525         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 526         textInput.textProperty().bind(other);
 527         textInput.selectRange(0, 5);
 528         assertEquals(&quot;There&quot;, textInput.getSelectedText());
 529         other.set(&quot;Cleared!&quot;);
 530         assertEquals(&quot;&quot;, textInput.getSelectedText());
 531     }
 532 
 533     @Test public void selectedTextChangeEvents() {
 534         final boolean[] passed = new boolean[] { false };
 535         textInput.setText(&quot;The quick brown fox&quot;);
 536         textInput.selectedTextProperty().addListener(observable -&gt; {
 537             passed[0] = true;
 538         });
 539         textInput.selectRange(0, 3);
 540         assertTrue(passed[0]);
 541     }
 542 
 543     @Test public void selectedTextChangeEvents2() {
 544         final boolean[] passed = new boolean[] { false };
 545         textInput.setText(&quot;The quick brown fox&quot;);
 546         textInput.selectRange(0, 3);
 547         textInput.selectedTextProperty().addListener(observable -&gt; {
 548             passed[0] = true;
 549         });
 550         textInput.selectRange(10, 180);
 551         assertTrue(passed[0]);
 552     }
 553 
 554     @Test public void selectedTextChangeEvents3() {
 555         final boolean[] passed = new boolean[] { false };
 556         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 557         textInput.textProperty().bind(other);
 558         textInput.selectRange(0, 5);
 559         textInput.selectedTextProperty().addListener(observable -&gt; {
 560             passed[0] = true;
 561         });
 562         other.set(&quot;Cleared!&quot;);
 563         assertTrue(passed[0]);
 564     }
 565 
 566     /******************************************************
 567      * Test for selection                                 *
 568      *****************************************************/
 569 
 570     @Test public void selectionIsClearedWhenTextChanges() {
 571         textInput.setText(&quot;The quick brown fox&quot;);
 572         textInput.selectRange(4, 9);
 573         textInput.setText(&quot;&quot;);
 574         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 575     }
 576 
 577     @Test public void selectionCannotBeSetToBeOutOfRange() {
 578         textInput.setText(&quot;The quick brown fox&quot;);
 579         textInput.selectRange(4, 99);
 580         assertEquals(new IndexRange(4, 19), textInput.getSelection());
 581     }
 582 
 583     @Test public void selectionCannotBeSetToBeOutOfRange2() {
 584         textInput.setText(&quot;The quick brown fox&quot;);
 585         textInput.selectRange(44, 99);
 586         assertEquals(new IndexRange(19, 19), textInput.getSelection());
 587     }
 588 
 589 //    @Test public void selectionCanBeBound() {
 590 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(4, 9));
 591 //        textInput.selectionProperty().bind(other);
 592 //        assertEquals(new IndexRange(4, 9), textInput.getSelection());
 593 //        other.set(new IndexRange(10, 19));
 594 //        assertEquals(new IndexRange(10, 19), textInput.getSelection());
 595 //    }
 596 
 597     @Test public void selectionChangeEventsHappen() {
 598         final boolean[] passed = new boolean[] { false };
 599         textInput.selectionProperty().addListener(observable -&gt; {
 600             passed[0] = true;
 601         });
 602         textInput.selectRange(0, 3);
 603         assertTrue(passed[0]);
 604     }
 605 
 606 //    @Test public void selectionChangeEventsHappenWhenBound() {
 607 //        final boolean[] passed = new boolean[] { false };
 608 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(0, 5));
 609 //        textInput.selectionProperty().addListener(new InvalidationListener() {
 610 //            @Override public void invalidated(Observable observable) {
 611 //                passed[0] = true;
 612 //            }
 613 //        });
 614 //        textInput.selectionProperty().bind(other);
 615 //        assertTrue(passed[0]);
 616 //    }
 617 
 618 //    @Test public void selectionChangeEventsHappenWhenBound2() {
 619 //        final boolean[] passed = new boolean[] { false };
 620 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(0, 5));
 621 //        textInput.selectionProperty().bind(other);
 622 //        textInput.selectionProperty().addListener(new InvalidationListener() {
 623 //            @Override public void invalidated(Observable observable) {
 624 //                passed[0] = true;
 625 //            }
 626 //        });
 627 //        assertFalse(passed[0]);
 628 //        other.set(new IndexRange(1, 2));
 629 //        assertTrue(passed[0]);
 630 //    }
 631 
 632     @Test public void selectionChangeEventsHappenWhenTextIsChanged() {
 633         final boolean[] passed = new boolean[] { false };
 634         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 635         textInput.textProperty().bind(other);
 636         textInput.selectRange(0, 5);
 637         textInput.selectionProperty().addListener(observable -&gt; {
 638             passed[0] = true;
 639         });
 640         other.set(&quot;Cleared!&quot;);
 641         assertTrue(passed[0]);
 642     }
 643 
 644     /******************************************************
 645      * Test for cut/copy/paste                            *
 646      *****************************************************/
 647 
 648     @Test public void cutRemovesSelection() {
 649         // Skip for PasswordField
 650         if (textInput instanceof PasswordField) return;
 651         textInput.setText(&quot;The quick brown fox&quot;);
 652         textInput.selectRange(4, 9);
 653         textInput.cut();
 654         assertEquals(&quot;The  brown fox&quot;, textInput.getText());
 655     }
 656 
 657     @Test public void pasteReplacesSelection() {
 658         textInput.setText(&quot;The quick brown fox&quot;);
 659         textInput.selectRange(4, 9);
 660         copy(&quot;slow&quot;);
 661         textInput.paste();
 662         assertEquals(&quot;The slow brown fox&quot;, textInput.getText());
 663     }
 664 
 665     @Test public void pasteIllegalCharacters() {
 666         textInput.setText(&quot;The quick brown fox&quot;);
 667         textInput.selectRange(19, 19);
 668         copy(&quot;&quot; + &#39;\0&#39;);
 669         textInput.paste();
 670         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
 671     }
 672 
 673     @Test public void pasteIllegalCharactersCaretNotAtZero() {
 674         textInput.setText(&quot;The quick brown fox&quot;);
 675         textInput.selectRange(4, 4);
 676         copy(&quot;slow&quot; + &#39;\0&#39;);
 677         textInput.paste();
 678         assertEquals(8, textInput.getCaretPosition());
 679         assertEquals(8, textInput.getAnchor());
 680     }
 681 
 682     @Test public void pasteIllegalCharactersSelection() {
 683         textInput.setText(&quot;The quick brown fox&quot;);
 684         textInput.selectRange(4, 9);
 685         copy(&quot;slow&quot; + &#39;\0&#39;);
 686         textInput.paste();
 687         assertEquals(&quot;The slow brown fox&quot;, textInput.getText());
 688     }
 689 
 690     @Test public void pasteIllegalCharactersIntoSelectionPositionsCaretCorrectly() {
 691         textInput.setText(&quot;The quick brown fox&quot;);
 692         textInput.selectRange(4, 9);
 693         copy(&quot;slow&quot; + &#39;\0&#39;);
 694         textInput.paste();
 695         assertEquals(8, textInput.getCaretPosition());
 696         assertEquals(8, textInput.getAnchor());
 697     }
 698 
 699     /******************************************************
 700      * Test for manipulating selection via methods        *
 701      *****************************************************/
 702 
 703     // cut ends up removing the selection, and setting anchor / caretPosition to match index
 704     @Test public void cutRemovesSelectionAndResetsAnchorAndCaretPositionToIndex() {
 705         // Skip for PasswordField
 706         if (textInput instanceof PasswordField) return;
 707         textInput.setText(&quot;The quick brown fox&quot;);
 708         textInput.selectRange(4, 9);
 709         textInput.cut();
 710         assertEquals(4, textInput.getAnchor());
 711         assertEquals(4, textInput.getCaretPosition());
 712         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 713         assertEquals(&quot;&quot;, textInput.getSelectedText());
 714     }
 715 
 716     @Test public void pasteWithEmptySelection() {
 717         textInput.setText(&quot;quick brown fox&quot;);
 718         textInput.selectRange(0,0);
 719         copy(&quot;The &quot;);
 720         textInput.paste();
 721         assertEquals(4, textInput.getAnchor());
 722         assertEquals(4, textInput.getCaretPosition());
 723         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 724         assertEquals(&quot;&quot;, textInput.getSelectedText());
 725     }
 726 
 727     @Test public void pasteWithSelection() {
 728         textInput.setText(&quot;The quick brown fox&quot;);
 729         textInput.selectRange(4, 9);
 730         copy(&quot;slow&quot;);
 731         textInput.paste();
 732         assertEquals(8, textInput.getAnchor());
 733         assertEquals(8, textInput.getCaretPosition());
 734         assertEquals(new IndexRange(8, 8), textInput.getSelection());
 735         assertEquals(&quot;&quot;, textInput.getSelectedText());
 736     }
 737 
 738     @Test public void pasteAll() {
 739         textInput.setText(&quot;The quick brown fox&quot;);
 740         textInput.selectAll();
 741         copy(&quot;Gone&quot;);
 742         textInput.paste();
 743         assertEquals(4, textInput.getAnchor());
 744         assertEquals(4, textInput.getCaretPosition());
 745         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 746         assertEquals(&quot;&quot;, textInput.getSelectedText());
 747     }
 748 
 749     @Test public void selectBackwardHasNoEffectWhenCaretPositionIsAlreadyZero() {
 750         textInput.setText(&quot;The quick brown fox&quot;);
 751         textInput.selectRange(3, 0);
 752         textInput.selectBackward();
 753         assertEquals(0, textInput.getCaretPosition());
 754         assertEquals(new IndexRange(0, 3), textInput.getSelection());
 755     }
 756 
 757     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionRightOfAnchor() {
 758         textInput.setText(&quot;The quick brown fox&quot;);
 759         textInput.selectRange(0, 3);
 760         textInput.selectBackward();
 761         assertEquals(2, textInput.getCaretPosition());
 762         assertEquals(new IndexRange(0, 2), textInput.getSelection());
 763     }
 764 
 765     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionEqualsAnchor() {
 766         textInput.setText(&quot;The quick brown fox&quot;);
 767         textInput.selectRange(3, 3);
 768         textInput.selectBackward();
 769         assertEquals(2, textInput.getCaretPosition());
 770         assertEquals(new IndexRange(2, 3), textInput.getSelection());
 771     }
 772 
 773     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionLeftOfAnchor() {
 774         textInput.setText(&quot;The quick brown fox&quot;);
 775         textInput.selectRange(6, 3);
 776         textInput.selectBackward();
 777         assertEquals(2, textInput.getCaretPosition());
 778         assertEquals(new IndexRange(2, 6), textInput.getSelection());
 779     }
 780 
 781     @Test public void selectForwardHasNoEffectWhenCaretPositionIsAtLength() {
 782         textInput.setText(&quot;The quick brown fox&quot;);
 783         textInput.selectRange(3, 19);
 784         textInput.selectForward();
 785         assertEquals(19, textInput.getCaretPosition());
 786         assertEquals(new IndexRange(3, 19), textInput.getSelection());
 787     }
 788 
 789     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionRightOfAnchor() {
 790         textInput.setText(&quot;The quick brown fox&quot;);
 791         textInput.selectRange(0, 3);
 792         textInput.selectForward();
 793         assertEquals(4, textInput.getCaretPosition());
 794         assertEquals(new IndexRange(0, 4), textInput.getSelection());
 795     }
 796 
 797     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionEqualsAnchor() {
 798         textInput.setText(&quot;The quick brown fox&quot;);
 799         textInput.selectRange(3, 3);
 800         textInput.selectForward();
 801         assertEquals(4, textInput.getCaretPosition());
 802         assertEquals(new IndexRange(3, 4), textInput.getSelection());
 803     }
 804 
 805     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionLeftOfAnchor() {
 806         textInput.setText(&quot;The quick brown fox&quot;);
 807         textInput.selectRange(6, 3);
 808         textInput.selectForward();
 809         assertEquals(4, textInput.getCaretPosition());
 810         assertEquals(new IndexRange(4, 6), textInput.getSelection());
 811     }
 812 
 813     @Test public void previousWordWithNoText() {
 814         textInput.previousWord();
 815         assertEquals(0, textInput.getCaretPosition());
 816         assertEquals(0, textInput.getAnchor());
 817         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 818     }
 819 
 820     @Test public void previousWordWithSelection_caretPositionBeforeAnchor() {
 821         textInput.setText(&quot;The quick brown fox&quot;);
 822         textInput.selectRange(15, 10);
 823         textInput.previousWord();
 824         assertEquals(4, textInput.getCaretPosition());
 825         assertEquals(4, textInput.getAnchor());
 826         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 827     }
 828 
 829     @Test public void previousWordWithSelection_caretPositionBeforeAnchor2() {
 830         textInput.setText(&quot;The quick brown fox&quot;);
 831         textInput.selectRange(12, 6);
 832         textInput.previousWord();
 833         assertEquals(4, textInput.getCaretPosition());
 834         assertEquals(4, textInput.getAnchor());
 835         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 836     }
 837 
 838     @Test public void previousWordWithSelection_caretPositionAfterAnchor() {
 839         textInput.setText(&quot;The quick brown fox&quot;);
 840         textInput.selectRange(10, 15);
 841         textInput.previousWord();
 842         assertEquals(10, textInput.getCaretPosition());
 843         assertEquals(10, textInput.getAnchor());
 844         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 845     }
 846 
 847     @Test public void previousWordWithSelection_caretPositionAfterAnchor2() {
 848         textInput.setText(&quot;The quick brown fox&quot;);
 849         textInput.selectRange(6, 12);
 850         textInput.previousWord();
 851         assertEquals(10, textInput.getCaretPosition());
 852         assertEquals(10, textInput.getAnchor());
 853         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 854     }
 855 
 856     @Test public void previousWord_caretWithinAWord() {
 857         textInput.setText(&quot;The quick brown fox&quot;);
 858         textInput.positionCaret(12);
 859         textInput.previousWord();
 860         assertEquals(10, textInput.getCaretPosition());
 861         assertEquals(10, textInput.getAnchor());
 862         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 863     }
 864 
 865     @Test public void previousWord_caretAfterWord() {
 866         textInput.setText(&quot;The quick brown fox&quot;);
 867         textInput.positionCaret(15);
 868         textInput.previousWord();
 869         assertEquals(10, textInput.getCaretPosition());
 870         assertEquals(10, textInput.getAnchor());
 871         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 872     }
 873 
 874     @Test public void previousWord_caretBeforeWord() {
 875         textInput.setText(&quot;The quick brown fox&quot;);
 876         textInput.positionCaret(10);
 877         textInput.previousWord();
 878         assertEquals(4, textInput.getCaretPosition());
 879         assertEquals(4, textInput.getAnchor());
 880         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 881     }
 882 
 883     @Test public void previousWord_caretWithinWhitespace() {
 884         textInput.setText(&quot;The quick  brown fox&quot;);
 885         textInput.positionCaret(10);
 886         textInput.previousWord();
 887         assertEquals(4, textInput.getCaretPosition());
 888         assertEquals(4, textInput.getAnchor());
 889         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 890     }
 891 
 892     @Test public void previousWord_multipleWhitespaceInARow() {
 893         textInput.setText(&quot;The quick  brown fox&quot;);
 894         textInput.positionCaret(11);
 895         textInput.previousWord();
 896         assertEquals(4, textInput.getCaretPosition());
 897         assertEquals(4, textInput.getAnchor());
 898         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 899     }
 900 
 901     @Test public void previousWord_withANumber() {
 902         textInput.setText(&quot;There are 5 cards in the hand&quot;);
 903         textInput.positionCaret(12);
 904         textInput.previousWord();
 905         assertEquals(10, textInput.getCaretPosition());
 906         assertEquals(10, textInput.getAnchor());
 907         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 908     }
 909 
 910     @Test public void previousWord_withALongNumber() {
 911         textInput.setText(&quot;There are 52 cards in the deck&quot;);
 912         textInput.positionCaret(13);
 913         textInput.previousWord();
 914         assertEquals(10, textInput.getCaretPosition());
 915         assertEquals(10, textInput.getAnchor());
 916         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 917     }
 918 
 919     @Test public void nextWordWithNoText() {
 920         textInput.nextWord();
 921         assertEquals(0, textInput.getCaretPosition());
 922         assertEquals(0, textInput.getAnchor());
 923         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 924     }
 925 
 926     @Test public void nextWordWithSelection_caretPositionBeforeAnchor() {
 927         textInput.setText(&quot;The quick brown fox&quot;);
 928         textInput.selectRange(9, 4);
 929         textInput.nextWord();
 930         assertEquals(10, textInput.getCaretPosition());
 931         assertEquals(10, textInput.getAnchor());
 932         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 933     }
 934 
 935     @Test public void nextWordWithSelection_caretPositionBeforeAnchor2() {
 936         textInput.setText(&quot;The quick brown fox&quot;);
 937         textInput.selectRange(9, 2);
 938         textInput.nextWord();
 939         assertEquals(4, textInput.getCaretPosition());
 940         assertEquals(4, textInput.getAnchor());
 941         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 942     }
 943 
 944     @Test public void nextWordWithSelection_caretPositionAfterAnchor() {
 945         textInput.setText(&quot;The quick brown fox&quot;);
 946         textInput.selectRange(4, 9);
 947         textInput.nextWord();
 948         assertEquals(10, textInput.getCaretPosition());
 949         assertEquals(10, textInput.getAnchor());
 950         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 951     }
 952 
 953     @Test public void nextWordWithSelection_caretPositionAfterAnchor2() {
 954         textInput.setText(&quot;The quick brown fox&quot;);
 955         textInput.selectRange(5, 11);
 956         textInput.nextWord();
 957         assertEquals(16, textInput.getCaretPosition());
 958         assertEquals(16, textInput.getAnchor());
 959         assertEquals(new IndexRange(16, 16), textInput.getSelection());
 960     }
 961 
 962     @Test public void nextWord_caretWithinAWord() {
 963         textInput.setText(&quot;The quick brown fox&quot;);
 964         textInput.positionCaret(6);
 965         textInput.nextWord();
 966         assertEquals(10, textInput.getCaretPosition());
 967         assertEquals(10, textInput.getAnchor());
 968         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 969     }
 970 
 971     @Test public void nextWord_caretAfterWord() {
 972         textInput.setText(&quot;The quick brown fox&quot;);
 973         textInput.positionCaret(9);
 974         textInput.nextWord();
 975         assertEquals(10, textInput.getCaretPosition());
 976         assertEquals(10, textInput.getAnchor());
 977         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 978     }
 979 
 980     @Test public void nextWord_caretBeforeWord() {
 981         textInput.setText(&quot;The quick brown fox&quot;);
 982         textInput.positionCaret(4);
 983         textInput.nextWord();
 984         assertEquals(10, textInput.getCaretPosition());
 985         assertEquals(10, textInput.getAnchor());
 986         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 987     }
 988 
 989     @Test public void nextWord_caretWithinWhitespace() {
 990         textInput.setText(&quot;The quick  brown fox&quot;);
 991         textInput.positionCaret(10);
 992         textInput.nextWord();
 993         assertEquals(11, textInput.getCaretPosition());
 994         assertEquals(11, textInput.getAnchor());
 995         assertEquals(new IndexRange(11, 11), textInput.getSelection());
 996     }
 997 
 998     @Test public void nextWord_multipleWhitespaceInARow() {
 999         textInput.setText(&quot;The quick  brown fox&quot;);
1000         textInput.positionCaret(9);
1001         textInput.nextWord();
1002         assertEquals(11, textInput.getCaretPosition());
1003         assertEquals(11, textInput.getAnchor());
1004         assertEquals(new IndexRange(11, 11), textInput.getSelection());
1005     }
1006 
1007     @Test public void nextWord_toTheEnd() {
1008         textInput.setText(&quot;The quick brown fox&quot;);
1009         textInput.positionCaret(16);
1010         textInput.nextWord();
1011         assertEquals(19, textInput.getCaretPosition());
1012         assertEquals(19, textInput.getAnchor());
1013         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1014     }
1015 
1016     @Test public void nextWord_withANumber() {
1017         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1018         textInput.positionCaret(6);
1019         textInput.nextWord();
1020         assertEquals(10, textInput.getCaretPosition());
1021         assertEquals(10, textInput.getAnchor());
1022         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1023     }
1024 
1025     @Test public void nextWord_withALongNumber() {
1026         textInput.setText(&quot;There are 52 cards in the deck&quot;);
1027         textInput.positionCaret(10);
1028         textInput.nextWord();
1029         assertEquals(13, textInput.getCaretPosition());
1030         assertEquals(13, textInput.getAnchor());
1031         assertEquals(new IndexRange(13, 13), textInput.getSelection());
1032     }
1033 
1034     @Test public void endOfNextWordWithNoText() {
1035         textInput.endOfNextWord();
1036         assertEquals(0, textInput.getCaretPosition());
1037         assertEquals(0, textInput.getAnchor());
1038         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1039     }
1040 
1041     @Test public void endOfNextWordWithSelection_caretPositionBeforeAnchor() {
1042         textInput.setText(&quot;The quick brown fox&quot;);
1043         textInput.selectRange(9, 4);
1044         textInput.endOfNextWord();
1045         assertEquals(9, textInput.getCaretPosition());
1046         assertEquals(9, textInput.getAnchor());
1047         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1048     }
1049 
1050     @Test public void endOfNextWordWithSelection_caretPositionBeforeAnchor2() {
1051         textInput.setText(&quot;The quick brown fox&quot;);
1052         textInput.selectRange(9, 2);
1053         textInput.endOfNextWord();
1054         assertEquals(3, textInput.getCaretPosition());
1055         assertEquals(3, textInput.getAnchor());
1056         assertEquals(new IndexRange(3, 3), textInput.getSelection());
1057     }
1058 
1059     @Test public void endOfNextWordWithSelection_caretPositionAfterAnchor() {
1060         textInput.setText(&quot;The quick brown fox&quot;);
1061         textInput.selectRange(4, 9);
1062         textInput.endOfNextWord();
1063         assertEquals(15, textInput.getCaretPosition());
1064         assertEquals(15, textInput.getAnchor());
1065         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1066     }
1067 
1068     @Test public void endOfNextWordWithSelection_caretPositionAfterAnchor2() {
1069         textInput.setText(&quot;The quick brown fox&quot;);
1070         textInput.selectRange(5, 11);
1071         textInput.endOfNextWord();
1072         assertEquals(15, textInput.getCaretPosition());
1073         assertEquals(15, textInput.getAnchor());
1074         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1075     }
1076 
1077     @Test public void endOfNextWord_caretWithinAWord() {
1078         textInput.setText(&quot;The quick brown fox&quot;);
1079         textInput.positionCaret(6);
1080         textInput.endOfNextWord();
1081         assertEquals(9, textInput.getCaretPosition());
1082         assertEquals(9, textInput.getAnchor());
1083         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1084     }
1085 
1086     @Test public void endOfNextWord_caretAfterWord() {
1087         textInput.setText(&quot;The quick brown fox&quot;);
1088         textInput.positionCaret(9);
1089         textInput.endOfNextWord();
1090         assertEquals(15, textInput.getCaretPosition());
1091         assertEquals(15, textInput.getAnchor());
1092         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1093     }
1094 
1095     @Test public void endOfNextWord_caretBeforeWord() {
1096         textInput.setText(&quot;The quick brown fox&quot;);
1097         textInput.positionCaret(4);
1098         textInput.endOfNextWord();
1099         assertEquals(9, textInput.getCaretPosition());
1100         assertEquals(9, textInput.getAnchor());
1101         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1102     }
1103 
1104     @Test public void endOfNextWord_caretWithinWhitespace() {
1105         textInput.setText(&quot;The quick  brown fox&quot;);
1106         textInput.positionCaret(10);
1107         textInput.endOfNextWord();
1108         assertEquals(16, textInput.getCaretPosition());
1109         assertEquals(16, textInput.getAnchor());
1110         assertEquals(new IndexRange(16, 16), textInput.getSelection());
1111     }
1112 
1113     @Test public void endOfNextWord_multipleWhitespaceInARow() {
1114         textInput.setText(&quot;The quick  brown fox&quot;);
1115         textInput.positionCaret(9);
1116         textInput.endOfNextWord();
1117         assertEquals(16, textInput.getCaretPosition());
1118         assertEquals(16, textInput.getAnchor());
1119         assertEquals(new IndexRange(16, 16), textInput.getSelection());
1120     }
1121 
1122     @Test public void endOfNextWord_withANumber() {
1123         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1124         textInput.positionCaret(6);
1125         textInput.endOfNextWord();
1126         assertEquals(9, textInput.getCaretPosition());
1127         assertEquals(9, textInput.getAnchor());
1128         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1129     }
1130 
1131     @Test public void endOfNextWord_withANumber_CaretOnANumber() {
1132         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1133         textInput.positionCaret(10);
1134         textInput.endOfNextWord();
1135         assertEquals(11, textInput.getCaretPosition());
1136         assertEquals(11, textInput.getAnchor());
1137         assertEquals(new IndexRange(11, 11), textInput.getSelection());
1138     }
1139 
1140     @Test public void endOfNextWord_withALongNumber_CaretOnANumber() {
1141         textInput.setText(&quot;There are 52 cards in the deck&quot;);
1142         textInput.positionCaret(10);
1143         textInput.endOfNextWord();
1144         assertEquals(12, textInput.getCaretPosition());
1145         assertEquals(12, textInput.getAnchor());
1146         assertEquals(new IndexRange(12, 12), textInput.getSelection());
1147     }
1148 
1149     @Test public void selectPreviousWordWithNoText() {
1150         textInput.selectPreviousWord();
1151         assertEquals(0, textInput.getCaretPosition());
1152         assertEquals(0, textInput.getAnchor());
1153         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1154     }
1155 
1156     @Test public void selectPreviousWordWithSelection_caretPositionBeforeAnchor() {
1157         textInput.setText(&quot;The quick brown fox&quot;);
1158         textInput.selectRange(15, 10);
1159         textInput.selectPreviousWord();
1160         assertEquals(4, textInput.getCaretPosition());
1161         assertEquals(15, textInput.getAnchor());
1162         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1163     }
1164 
1165     @Test public void selectPreviousWordWithSelection_caretPositionAfterAnchor() {
1166         textInput.setText(&quot;The quick brown fox&quot;);
1167         textInput.selectRange(10, 15);
1168         textInput.selectPreviousWord();
1169         assertEquals(10, textInput.getCaretPosition());
1170         assertEquals(10, textInput.getAnchor());
1171         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1172     }
1173 
1174     @Test public void selectPreviousWordWithSelection_caretPositionAfterAnchor2() {
1175         textInput.setText(&quot;The quick brown fox&quot;);
1176         textInput.selectRange(11, 15);
1177         textInput.selectPreviousWord();
1178         assertEquals(10, textInput.getCaretPosition());
1179         assertEquals(11, textInput.getAnchor());
1180         assertEquals(new IndexRange(10, 11), textInput.getSelection());
1181     }
1182 
1183     @Test public void selectPreviousWord_caretWithinAWord() {
1184         textInput.setText(&quot;The quick brown fox&quot;);
1185         textInput.positionCaret(12);
1186         textInput.selectPreviousWord();
1187         assertEquals(10, textInput.getCaretPosition());
1188         assertEquals(12, textInput.getAnchor());
1189         assertEquals(new IndexRange(10, 12), textInput.getSelection());
1190     }
1191 
1192     @Test public void selectPreviousWord_caretAfterWord() {
1193         textInput.setText(&quot;The quick brown fox&quot;);
1194         textInput.positionCaret(15);
1195         textInput.selectPreviousWord();
1196         assertEquals(10, textInput.getCaretPosition());
1197         assertEquals(15, textInput.getAnchor());
1198         assertEquals(new IndexRange(10, 15), textInput.getSelection());
1199     }
1200 
1201     @Test public void selectPreviousWord_caretBeforeWord() {
1202         textInput.setText(&quot;The quick brown fox&quot;);
1203         textInput.positionCaret(10);
1204         textInput.selectPreviousWord();
1205         assertEquals(4, textInput.getCaretPosition());
1206         assertEquals(10, textInput.getAnchor());
1207         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1208     }
1209 
1210     @Test public void selectPreviousWord_caretWithinWhitespace() {
1211         textInput.setText(&quot;The quick  brown fox&quot;);
1212         textInput.positionCaret(10);
1213         textInput.selectPreviousWord();
1214         assertEquals(4, textInput.getCaretPosition());
1215         assertEquals(10, textInput.getAnchor());
1216         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1217     }
1218 
1219     @Test public void selectPreviousWord_multipleWhitespaceInARow() {
1220         textInput.setText(&quot;The quick  brown fox&quot;);
1221         textInput.positionCaret(11);
1222         textInput.selectPreviousWord();
1223         assertEquals(4, textInput.getCaretPosition());
1224         assertEquals(11, textInput.getAnchor());
1225         assertEquals(new IndexRange(4, 11), textInput.getSelection());
1226     }
1227 
1228     @Test public void selectNextWordWithNoText() {
1229         textInput.selectNextWord();
1230         assertEquals(0, textInput.getCaretPosition());
1231         assertEquals(0, textInput.getAnchor());
1232         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1233     }
1234 
1235     @Test public void selectNextWordWithSelection_caretPositionBeforeAnchor() {
1236         textInput.setText(&quot;The quick brown fox&quot;);
1237         textInput.selectRange(9, 4);
1238         textInput.selectNextWord();
1239         assertEquals(10, textInput.getCaretPosition());
1240         assertEquals(9, textInput.getAnchor());
1241         assertEquals(new IndexRange(9, 10), textInput.getSelection());
1242     }
1243 
1244     @Test public void selectNextWordWithSelection_caretPositionBeforeAnchor2() {
1245         textInput.setText(&quot;The quick brown fox&quot;);
1246         textInput.selectRange(9, 2);
1247         textInput.selectNextWord();
1248         assertEquals(4, textInput.getCaretPosition());
1249         assertEquals(9, textInput.getAnchor());
1250         assertEquals(new IndexRange(4, 9), textInput.getSelection());
1251     }
1252 
1253     @Test public void selectNextWordWithSelection_caretPositionAfterAnchor() {
1254         textInput.setText(&quot;The quick brown fox&quot;);
1255         textInput.selectRange(4, 9);
1256         textInput.selectNextWord();
1257         assertEquals(10, textInput.getCaretPosition());
1258         assertEquals(4, textInput.getAnchor());
1259         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1260     }
1261 
1262     @Test public void selectNextWordWithSelection_caretPositionAfterAnchor2() {
1263         textInput.setText(&quot;The quick brown fox&quot;);
1264         textInput.selectRange(5, 11);
1265         textInput.selectNextWord();
1266         assertEquals(16, textInput.getCaretPosition());
1267         assertEquals(5, textInput.getAnchor());
1268         assertEquals(new IndexRange(5, 16), textInput.getSelection());
1269     }
1270 
1271     @Test public void selectNextWord_caretWithinAWord() {
1272         textInput.setText(&quot;The quick brown fox&quot;);
1273         textInput.positionCaret(6);
1274         textInput.selectNextWord();
1275         assertEquals(10, textInput.getCaretPosition());
1276         assertEquals(6, textInput.getAnchor());
1277         assertEquals(new IndexRange(6, 10), textInput.getSelection());
1278     }
1279 
1280     @Test public void selectNextWord_caretAfterWord() {
1281         textInput.setText(&quot;The quick brown fox&quot;);
1282         textInput.positionCaret(9);
1283         textInput.selectNextWord();
1284         assertEquals(10, textInput.getCaretPosition());
1285         assertEquals(9, textInput.getAnchor());
1286         assertEquals(new IndexRange(9, 10), textInput.getSelection());
1287     }
1288 
1289     @Test public void selectNextWord_caretBeforeWord() {
1290         textInput.setText(&quot;The quick brown fox&quot;);
1291         textInput.positionCaret(4);
1292         textInput.selectNextWord();
1293         assertEquals(10, textInput.getCaretPosition());
1294         assertEquals(4, textInput.getAnchor());
1295         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1296     }
1297 
1298     @Test public void selectNextWord_caretWithinWhitespace() {
1299         textInput.setText(&quot;The quick  brown fox&quot;);
1300         textInput.positionCaret(10);
1301         textInput.selectNextWord();
1302         assertEquals(11, textInput.getCaretPosition());
1303         assertEquals(10, textInput.getAnchor());
1304         assertEquals(new IndexRange(10, 11), textInput.getSelection());
1305     }
1306 
1307     @Test public void selectNextWord_multipleWhitespaceInARow() {
1308         textInput.setText(&quot;The quick  brown fox&quot;);
1309         textInput.positionCaret(9);
1310         textInput.selectNextWord();
1311         assertEquals(11, textInput.getCaretPosition());
1312         assertEquals(9, textInput.getAnchor());
1313         assertEquals(new IndexRange(9, 11), textInput.getSelection());
1314     }
1315 
1316     @Test public void selectNextWord_toTheEnd() {
1317         textInput.setText(&quot;The quick brown fox&quot;);
1318         textInput.positionCaret(16);
1319         textInput.selectNextWord();
1320         assertEquals(19, textInput.getCaretPosition());
1321         assertEquals(16, textInput.getAnchor());
1322         assertEquals(new IndexRange(16, 19), textInput.getSelection());
1323     }
1324 
1325     @Test public void selectEndOfNextWordWithNoText() {
1326         textInput.selectEndOfNextWord();
1327         assertEquals(0, textInput.getCaretPosition());
1328         assertEquals(0, textInput.getAnchor());
1329         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1330     }
1331 
1332     @Test public void selectEndOfNextWordWithSelection_caretPositionBeforeAnchor() {
1333         textInput.setText(&quot;The quick brown fox&quot;);
1334         textInput.selectRange(9, 4);
1335         textInput.selectEndOfNextWord();
1336         assertEquals(9, textInput.getCaretPosition());
1337         assertEquals(9, textInput.getAnchor());
1338         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1339     }
1340 
1341     @Test public void selectEndOfNextWordWithSelection_caretPositionBeforeAnchor2() {
1342         textInput.setText(&quot;The quick brown fox&quot;);
1343         textInput.selectRange(9, 2);
1344         textInput.selectEndOfNextWord();
1345         assertEquals(3, textInput.getCaretPosition());
1346         assertEquals(9, textInput.getAnchor());
1347         assertEquals(new IndexRange(3, 9), textInput.getSelection());
1348     }
1349 
1350     @Test public void selectEndOfNextWordWithSelection_caretPositionAfterAnchor() {
1351         textInput.setText(&quot;The quick brown fox&quot;);
1352         textInput.selectRange(4, 9);
1353         textInput.selectEndOfNextWord();
1354         assertEquals(15, textInput.getCaretPosition());
1355         assertEquals(4, textInput.getAnchor());
1356         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1357     }
1358 
1359     @Test public void selectEndOfNextWordWithSelection_caretPositionAfterAnchor2() {
1360         textInput.setText(&quot;The quick brown fox&quot;);
1361         textInput.selectRange(5, 11);
1362         textInput.selectEndOfNextWord();
1363         assertEquals(15, textInput.getCaretPosition());
1364         assertEquals(5, textInput.getAnchor());
1365         assertEquals(new IndexRange(5, 15), textInput.getSelection());
1366     }
1367 
1368     @Test public void selectEndOfNextWord_caretWithinAWord() {
1369         textInput.setText(&quot;The quick brown fox&quot;);
1370         textInput.positionCaret(6);
1371         textInput.selectEndOfNextWord();
1372         assertEquals(9, textInput.getCaretPosition());
1373         assertEquals(6, textInput.getAnchor());
1374         assertEquals(new IndexRange(6, 9), textInput.getSelection());
1375     }
1376 
1377     @Test public void selectEndOfNextWord_caretAfterWord() {
1378         textInput.setText(&quot;The quick brown fox&quot;);
1379         textInput.positionCaret(9);
1380         textInput.selectEndOfNextWord();
1381         assertEquals(15, textInput.getCaretPosition());
1382         assertEquals(9, textInput.getAnchor());
1383         assertEquals(new IndexRange(9, 15), textInput.getSelection());
1384     }
1385 
1386     @Test public void selectEndOfNextWord_caretBeforeWord() {
1387         textInput.setText(&quot;The quick brown fox&quot;);
1388         textInput.positionCaret(4);
1389         textInput.selectEndOfNextWord();
1390         assertEquals(9, textInput.getCaretPosition());
1391         assertEquals(4, textInput.getAnchor());
1392         assertEquals(new IndexRange(4, 9), textInput.getSelection());
1393     }
1394 
1395     @Test public void selectEndOfNextWord_caretWithinWhitespace() {
1396         textInput.setText(&quot;The quick  brown fox&quot;);
1397         textInput.positionCaret(10);
1398         textInput.selectEndOfNextWord();
1399         assertEquals(16, textInput.getCaretPosition());
1400         assertEquals(10, textInput.getAnchor());
1401         assertEquals(new IndexRange(10, 16), textInput.getSelection());
1402     }
1403 
1404     @Test public void selectEndOfNextWord_multipleWhitespaceInARow() {
1405         textInput.setText(&quot;The quick  brown fox&quot;);
1406         textInput.positionCaret(9);
1407         textInput.selectEndOfNextWord();
1408         assertEquals(16, textInput.getCaretPosition());
1409         assertEquals(9, textInput.getAnchor());
1410         assertEquals(new IndexRange(9, 16), textInput.getSelection());
1411     }
1412 
1413     @Test public void selectAllWithNoText() {
1414         textInput.setText(&quot;&quot;);
1415         textInput.selectAll();
1416         assertEquals(0, textInput.getCaretPosition());
1417         assertEquals(0, textInput.getAnchor());
1418         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1419     }
1420 
1421     @Test public void selectAllWithText_caretPositionIsAlwaysAtTheEnd() {
1422         textInput.setText(&quot;The quick brown fox&quot;);
1423         textInput.selectAll();
1424         assertEquals(19, textInput.getCaretPosition());
1425         assertEquals(0, textInput.getAnchor());
1426         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1427     }
1428 
1429     @Test public void homeClearsSelection() {
1430         textInput.setText(&quot;The quick brown fox&quot;);
1431         textInput.selectRange(4, 9);
1432         textInput.home();
1433         assertEquals(0, textInput.getCaretPosition());
1434         assertEquals(0, textInput.getAnchor());
1435         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1436     }
1437 
1438     @Test public void endClearsSelection() {
1439         textInput.setText(&quot;The quick brown fox&quot;);
1440         textInput.selectRange(4, 9);
1441         textInput.end();
1442         assertEquals(19, textInput.getCaretPosition());
1443         assertEquals(19, textInput.getAnchor());
1444         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1445     }
1446 
1447     @Test public void selectHomeHasNoEffectWhenCaretPositionIsAtZero() {
1448         textInput.setText(&quot;The quick brown fox&quot;);
1449         textInput.selectRange(3, 0);
1450         textInput.selectHome();
1451         assertEquals(0, textInput.getCaretPosition());
1452         assertEquals(3, textInput.getAnchor());
1453         assertEquals(new IndexRange(0, 3), textInput.getSelection());
1454     }
1455 
1456     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionRightOfAnchor() {
1457         textInput.setText(&quot;The quick brown fox&quot;);
1458         textInput.selectRange(4, 9);
1459         textInput.selectHome();
1460         assertEquals(0, textInput.getCaretPosition());
1461         assertEquals(4, textInput.getAnchor());
1462         assertEquals(new IndexRange(0, 4), textInput.getSelection());
1463     }
1464 
1465     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionEqualsAnchor() {
1466         textInput.setText(&quot;The quick brown fox&quot;);
1467         textInput.selectRange(3, 3);
1468         textInput.selectHome();
1469         assertEquals(0, textInput.getCaretPosition());
1470         assertEquals(3, textInput.getAnchor());
1471         assertEquals(new IndexRange(0, 3), textInput.getSelection());
1472     }
1473 
1474     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionLeftOfAnchor() {
1475         textInput.setText(&quot;The quick brown fox&quot;);
1476         textInput.selectRange(6, 3);
1477         textInput.selectHome();
1478         assertEquals(0, textInput.getCaretPosition());
1479         assertEquals(6, textInput.getAnchor());
1480         assertEquals(new IndexRange(0, 6), textInput.getSelection());
1481     }
1482 
1483     @Test public void selectEndHasNoEffectWhenCaretPositionIsAtLength() {
1484         textInput.setText(&quot;The quick brown fox&quot;);
1485         textInput.selectRange(3, 19);
1486         textInput.selectEnd();
1487         assertEquals(19, textInput.getCaretPosition());
1488         assertEquals(3, textInput.getAnchor());
1489         assertEquals(new IndexRange(3, 19), textInput.getSelection());
1490     }
1491 
1492     @Test public void selectEndMovesCaretPositionToLength_CaretPositionRightOfAnchor() {
1493         textInput.setText(&quot;The quick brown fox&quot;);
1494         textInput.selectRange(0, 3);
1495         textInput.selectEnd();
1496         assertEquals(19, textInput.getCaretPosition());
1497         assertEquals(0, textInput.getAnchor());
1498         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1499     }
1500 
1501     @Test public void selectEndMovesCaretPositionToLength_CaretPositionEqualsAnchor() {
1502         textInput.setText(&quot;The quick brown fox&quot;);
1503         textInput.selectRange(3, 3);
1504         textInput.selectEnd();
1505         assertEquals(19, textInput.getCaretPosition());
1506         assertEquals(3, textInput.getAnchor());
1507         assertEquals(new IndexRange(3, 19), textInput.getSelection());
1508     }
1509 
1510     @Test public void selectEndMovesCaretPositionToLength_CaretPositionLeftOfAnchor() {
1511         textInput.setText(&quot;The quick brown fox&quot;);
1512         textInput.selectRange(6, 3);
1513         textInput.selectEnd();
1514         assertEquals(19, textInput.getCaretPosition());
1515         assertEquals(6, textInput.getAnchor());
1516         assertEquals(new IndexRange(6, 19), textInput.getSelection());
1517     }
1518 
1519     @Test public void deletePreviousCharDeletesOnlySelectedText_anchorLessThanCaretPosition() {
1520         textInput.setText(&quot;The quick brown fox&quot;);
1521         textInput.selectRange(4, 10);
1522         textInput.deletePreviousChar();
1523         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1524         assertEquals(4, textInput.getCaretPosition());
1525         assertEquals(4, textInput.getAnchor());
1526         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1527     }
1528 
1529     @Test public void deletePreviousCharDeletesOnlySelectedText_caretPositionLessThanAnchor() {
1530         textInput.setText(&quot;The quick brown fox&quot;);
1531         textInput.selectRange(10, 4);
1532         textInput.deletePreviousChar();
1533         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1534         assertEquals(4, textInput.getCaretPosition());
1535         assertEquals(4, textInput.getAnchor());
1536         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1537     }
1538 
1539     @Test public void deletePreviousCharDeletesPreviousCharWhenCaretPositionEqualsAnchor() {
1540         textInput.setText(&quot;The quick brown fox&quot;);
1541         textInput.selectRange(10, 10);
1542         textInput.deletePreviousChar();
1543         assertEquals(&quot;The quickbrown fox&quot;, textInput.getText());
1544         assertEquals(9, textInput.getCaretPosition());
1545         assertEquals(9, textInput.getAnchor());
1546         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1547     }
1548 
1549     @Test public void deletePreviousCharDoesNothingWhenSelectionIs0_0() {
1550         textInput.setText(&quot;The quick brown fox&quot;);
1551         textInput.selectRange(0, 0);
1552         textInput.deletePreviousChar();
1553         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
1554         assertEquals(0, textInput.getCaretPosition());
1555         assertEquals(0, textInput.getAnchor());
1556         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1557     }
1558 
1559     @Test public void deleteNextCharDeletesOnlySelectedText_anchorLessThanCaretPosition() {
1560         textInput.setText(&quot;The quick brown fox&quot;);
1561         textInput.selectRange(4, 10);
1562         textInput.deleteNextChar();
1563         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1564         assertEquals(4, textInput.getCaretPosition());
1565         assertEquals(4, textInput.getAnchor());
1566         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1567     }
1568 
1569     @Test public void deleteNextCharDeletesOnlySelectedText_caretPositionLessThanAnchor() {
1570         textInput.setText(&quot;The quick brown fox&quot;);
1571         textInput.selectRange(10, 4);
1572         textInput.deleteNextChar();
1573         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1574         assertEquals(4, textInput.getCaretPosition());
1575         assertEquals(4, textInput.getAnchor());
1576         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1577     }
1578 
1579     @Test public void deleteNextCharDeletesNextCharWhenCaretPositionEqualsAnchor() {
1580         textInput.setText(&quot;The quick brown fox&quot;);
1581         textInput.selectRange(10, 10);
1582         textInput.deleteNextChar();
1583         assertEquals(&quot;The quick rown fox&quot;, textInput.getText());
1584         assertEquals(10, textInput.getCaretPosition());
1585         assertEquals(10, textInput.getAnchor());
1586         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1587     }
1588 
1589     @Test public void deleteNextCharDoesNothingWhenSelectionIsEmptyAtEnd() {
1590         textInput.setText(&quot;The quick brown fox&quot;);
1591         textInput.selectRange(19, 19);
1592         textInput.deleteNextChar();
1593         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
1594         assertEquals(19, textInput.getCaretPosition());
1595         assertEquals(19, textInput.getAnchor());
1596         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1597     }
1598 
1599     @Test public void forwardSkipsSelection() {
1600         textInput.setText(&quot;The quick brown fox&quot;);
1601         textInput.selectRange(4, 9);
1602         textInput.forward();
1603         assertEquals(9, textInput.getCaretPosition());
1604         assertEquals(9, textInput.getAnchor());
1605         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1606     }
1607 
1608     @Test public void forwardSkipsSelection2() {
1609         textInput.setText(&quot;The quick brown fox&quot;);
1610         textInput.selectRange(9, 4);
1611         textInput.forward();
1612         assertEquals(9, textInput.getCaretPosition());
1613         assertEquals(9, textInput.getAnchor());
1614         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1615     }
1616 
1617     @Test public void forwardMovesForwardWhenNotAtEnd() {
1618         textInput.setText(&quot;The quick brown fox&quot;);
1619         textInput.selectRange(0, 0);
1620         textInput.forward();
1621         assertEquals(1, textInput.getCaretPosition());
1622         assertEquals(1, textInput.getAnchor());
1623         assertEquals(new IndexRange(1, 1), textInput.getSelection());
1624     }
1625 
1626     @Test public void forwardDoesNothingWhenAtEnd() {
1627         textInput.setText(&quot;The quick brown fox&quot;);
1628         textInput.selectRange(19, 19);
1629         textInput.forward();
1630         assertEquals(19, textInput.getCaretPosition());
1631         assertEquals(19, textInput.getAnchor());
1632         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1633     }
1634 
1635     @Test public void backwardSkipsSelection() {
1636         textInput.setText(&quot;The quick brown fox&quot;);
1637         textInput.selectRange(4, 9);
1638         textInput.backward();
1639         assertEquals(4, textInput.getCaretPosition());
1640         assertEquals(4, textInput.getAnchor());
1641         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1642     }
1643 
1644     @Test public void backwardSkipsSelection2() {
1645         textInput.setText(&quot;The quick brown fox&quot;);
1646         textInput.selectRange(9, 4);
1647         textInput.backward();
1648         assertEquals(4, textInput.getCaretPosition());
1649         assertEquals(4, textInput.getAnchor());
1650         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1651     }
1652 
1653     @Test public void backwardMovesBackwardWhenNotAtStart() {
1654         textInput.setText(&quot;The quick brown fox&quot;);
1655         textInput.positionCaret(14);
1656         textInput.backward();
1657         assertEquals(13, textInput.getCaretPosition());
1658         assertEquals(13, textInput.getAnchor());
1659         assertEquals(new IndexRange(13, 13), textInput.getSelection());
1660     }
1661 
1662     @Test public void backwardDoesNothingWhenAtStart() {
1663         textInput.setText(&quot;The quick brown fox&quot;);
1664         textInput.selectRange(0, 0);
1665         textInput.backward();
1666         assertEquals(0, textInput.getCaretPosition());
1667         assertEquals(0, textInput.getAnchor());
1668         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1669     }
1670 
1671     @Test public void positionCaretAtStart() {
1672         textInput.setText(&quot;The quick brown fox&quot;);
1673         textInput.positionCaret(0);
1674         assertEquals(0, textInput.getCaretPosition());
1675         assertEquals(0, textInput.getAnchor());
1676         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1677     }
1678 
1679     @Test public void positionCaretInMiddle() {
1680         textInput.setText(&quot;The quick brown fox&quot;);
1681         textInput.positionCaret(10);
1682         assertEquals(10, textInput.getCaretPosition());
1683         assertEquals(10, textInput.getAnchor());
1684         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1685     }
1686 
1687     @Test public void positionCaretAtEnd() {
1688         textInput.setText(&quot;The quick brown fox&quot;);
1689         textInput.positionCaret(19);
1690         assertEquals(19, textInput.getCaretPosition());
1691         assertEquals(19, textInput.getAnchor());
1692         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1693     }
1694 
1695     @Test public void positionCaretBeyondStartClamps() {
1696         textInput.setText(&quot;The quick brown fox&quot;);
1697         textInput.positionCaret(-10);
1698         assertEquals(0, textInput.getCaretPosition());
1699         assertEquals(0, textInput.getAnchor());
1700         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1701     }
1702 
1703     @Test public void positionCaretBeyondEndClamps() {
1704         textInput.setText(&quot;The quick brown fox&quot;);
1705         textInput.positionCaret(1000);
1706         assertEquals(19, textInput.getCaretPosition());
1707         assertEquals(19, textInput.getAnchor());
1708         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1709     }
1710 
1711     @Test public void selectPositionCaretWhenAnchorAndCaretAreBothZero() {
1712         textInput.setText(&quot;The quick brown fox&quot;);
1713         textInput.selectRange(0, 0);
1714         textInput.selectPositionCaret(10);
1715         assertEquals(10, textInput.getCaretPosition());
1716         assertEquals(0, textInput.getAnchor());
1717         assertEquals(new IndexRange(0, 10), textInput.getSelection());
1718     }
1719 
1720     @Test public void selectPositionCaret_anchorLessThanCaretPosition() {
1721         textInput.setText(&quot;The quick brown fox&quot;);
1722         textInput.selectRange(4, 10);
1723         textInput.selectPositionCaret(1);
1724         assertEquals(1, textInput.getCaretPosition());
1725         assertEquals(4, textInput.getAnchor());
1726         assertEquals(new IndexRange(1, 4), textInput.getSelection());
1727     }
1728 
1729     @Test public void selectPositionCaret_anchorLessThanCaretPosition2() {
1730         textInput.setText(&quot;The quick brown fox&quot;);
1731         textInput.selectRange(4, 10);
1732         textInput.selectPositionCaret(15);
1733         assertEquals(15, textInput.getCaretPosition());
1734         assertEquals(4, textInput.getAnchor());
1735         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1736     }
1737 
1738     @Test public void selectPositionCaret_anchorLessThanCaretPosition3() {
1739         textInput.setText(&quot;The quick brown fox&quot;);
1740         textInput.selectRange(4, 10);
1741         textInput.selectPositionCaret(4);
1742         assertEquals(4, textInput.getCaretPosition());
1743         assertEquals(4, textInput.getAnchor());
1744         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1745     }
1746 
1747     @Test public void selectPositionCaret_caretPositionLessThanAnchor() {
1748         textInput.setText(&quot;The quick brown fox&quot;);
1749         textInput.selectRange(10, 4);
1750         textInput.selectPositionCaret(1);
1751         assertEquals(1, textInput.getCaretPosition());
1752         assertEquals(10, textInput.getAnchor());
1753         assertEquals(new IndexRange(1, 10), textInput.getSelection());
1754     }
1755 
1756     @Test public void selectPositionCaret_caretPositionLessThanAnchor2() {
1757         textInput.setText(&quot;The quick brown fox&quot;);
1758         textInput.selectRange(10, 4);
1759         textInput.selectPositionCaret(14);
1760         assertEquals(14, textInput.getCaretPosition());
1761         assertEquals(10, textInput.getAnchor());
1762         assertEquals(new IndexRange(10, 14), textInput.getSelection());
1763     }
1764 
1765     @Test public void selectPositionCaret_caretPositionLessThanAnchor3() {
1766         textInput.setText(&quot;The quick brown fox&quot;);
1767         textInput.selectRange(10, 4);
1768         textInput.selectPositionCaret(10);
1769         assertEquals(10, textInput.getCaretPosition());
1770         assertEquals(10, textInput.getAnchor());
1771         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1772     }
1773 
1774     @Test public void selectPositionCaretWhenCaretPositionEqualsAnchor() {
1775         textInput.setText(&quot;The quick brown fox&quot;);
1776         textInput.selectRange(10, 10);
1777         textInput.selectPositionCaret(4);
1778         assertEquals(4, textInput.getCaretPosition());
1779         assertEquals(10, textInput.getAnchor());
1780         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1781     }
1782 
1783     @Test public void selectPositionCaretWhenCaretPositionEqualsAnchor2() {
1784         textInput.setText(&quot;The quick brown fox&quot;);
1785         textInput.selectRange(10, 10);
1786         textInput.selectPositionCaret(14);
1787         assertEquals(14, textInput.getCaretPosition());
1788         assertEquals(10, textInput.getAnchor());
1789         assertEquals(new IndexRange(10, 14), textInput.getSelection());
1790     }
1791 
1792     @Test public void extendSelectionWithNoText() {
1793         textInput.extendSelection(0);
1794         assertEquals(0, textInput.getCaretPosition());
1795         assertEquals(0, textInput.getAnchor());
1796         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1797     }
1798 
1799     @Test public void extendSelectionWithOutOfRangePos() {
1800         textInput.setText(&quot;The quick brown fox&quot;);
1801         textInput.selectRange(0, 0);
1802         textInput.extendSelection(1000);
1803         assertEquals(19, textInput.getCaretPosition());
1804         assertEquals(0, textInput.getAnchor());
1805         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1806     }
1807 
1808     @Test public void extendSelectionWithOutOfRangePos2() {
1809         textInput.setText(&quot;The quick brown fox&quot;);
1810         textInput.positionCaret(4);
1811         textInput.extendSelection(-19);
1812         assertEquals(0, textInput.getCaretPosition());
1813         assertEquals(4, textInput.getAnchor());
1814         assertEquals(new IndexRange(0, 4), textInput.getSelection());
1815     }
1816 
1817     @Test public void test_rt26250_caret_issue_for_thai_characters() {
1818         // Thai string containing two characters, consisting of three
1819         // codepoints each.
1820         String thaiStr = &quot;\u0E17\u0E35\u0E48\u0E17\u0E35\u0E48&quot;;
1821         textInput.setText(thaiStr);
1822         textInput.positionCaret(0);
1823 
1824         // Step past one character
1825         textInput.forward();
1826         assertEquals(3, textInput.getCaretPosition());
1827 
1828         // Goto beginning
1829         textInput.backward();
1830         assertEquals(0, textInput.getCaretPosition());
1831 
1832         // Delete entire first character forwards
1833         textInput.deleteNextChar();
1834         assertEquals(&quot;\u0E17\u0E35\u0E48&quot;, textInput.getText());
1835 
1836         // Break up and delete remaining character backwards in three steps
1837         textInput.forward();
1838         textInput.deletePreviousChar();
1839         assertEquals(&quot;\u0E17\u0E35&quot;, textInput.getText());
1840         textInput.deletePreviousChar();
1841         assertEquals(&quot;\u0E17&quot;, textInput.getText());
1842         textInput.deletePreviousChar();
1843         assertEquals(&quot;&quot;, textInput.getText());
1844     }
1845 
1846     @Test public void test_rt40376_delete_next_when_text_is_null() {
1847         textInput.setText(null);
1848         textInput.deleteNextChar();
1849     }
1850 
1851     @Test public void test_jdk_8171229_replaceText() {
1852         textInput.setText(&quot;&quot;);
1853         assertEquals(&quot;&quot;, textInput.getText());
1854 
1855         textInput.replaceText(0, 0, &quot;a&quot;);
1856         assertEquals(&quot;a&quot;, textInput.getText());
1857 
1858         textInput.replaceText(1, 1, &quot;b&quot;);
1859         assertEquals(&quot;ab&quot;, textInput.getText());
1860 
1861         textInput.replaceText(2, 2, &quot;c&quot;);
1862         assertEquals(&quot;abc&quot;, textInput.getText());
1863 
1864         textInput.replaceText(3, 3, &quot;d&quot;);
1865         assertEquals(&quot;abcd&quot;, textInput.getText());
1866 
1867         textInput.replaceText(3, 4, &quot;efg&quot;);
1868         assertEquals(&quot;abcefg&quot;, textInput.getText());
1869 
1870         textInput.replaceText(3, 6, &quot;d&quot;);
1871         assertEquals(&quot;abcd&quot;, textInput.getText());
1872 
1873         textInput.replaceText(0, 4, &quot;&quot;);
1874         assertEquals(&quot;&quot;, textInput.getText());
1875 
1876         textInput.undo();
1877         assertEquals(&quot;abcd&quot;, textInput.getText());
1878 
1879         textInput.undo();
1880         assertEquals(&quot;abcefg&quot;, textInput.getText());
1881 
1882         textInput.undo();
1883         assertEquals(&quot;abcd&quot;, textInput.getText());
1884 
1885         textInput.undo();
1886         assertEquals(&quot;&quot;, textInput.getText());
1887     }
1888 
1889     @Test public void test_redo_replaceText_selectionShortening() {
1890         textInput.setText(&quot;0123456789&quot;);
1891         assertEquals(&quot;0123456789&quot;, textInput.getText());
1892 
1893         textInput.replaceText(8, 10, &quot;x&quot;);
1894         assertEquals(&quot;01234567x&quot;, textInput.getText());
1895 
1896         textInput.undo();
1897         assertEquals(&quot;0123456789&quot;, textInput.getText());
1898 
1899         textInput.redo();
1900         assertEquals(&quot;01234567x&quot;, textInput.getText());
1901     }
1902 
1903     @Test public void replaceSelectionAtEndWithListener() {
1904         StringBuilder selectedTextLog = new StringBuilder();
1905         StringBuilder selectionLog = new StringBuilder();
1906         textInput.setText(&quot;x xxx&quot;);
1907         textInput.selectRange(2, 5);
1908         textInput.selectedTextProperty().addListener((observable, oldValue, newValue) -&gt; selectedTextLog.append(&quot;|&quot; + newValue));
1909         textInput.selectionProperty().addListener((observable, oldValue, newValue) -&gt; selectionLog.append(&quot;|&quot; + newValue.getStart() + &quot;,&quot; + newValue.getEnd()));
1910         textInput.replaceSelection(&quot;a&quot;);
1911         assertEquals(&quot;|&quot;, selectedTextLog.toString());
1912         assertEquals(&quot;|3,3&quot;, selectionLog.toString());
1913         assertEquals(&quot;x a&quot;, textInput.getText());
1914     }
1915 
1916     @Test public void testSelectionProperties() {
1917         textInput.setText(&quot;abcdefghij&quot;);
1918 
1919         StringBuilder selectedTextLog = new StringBuilder();
1920         StringBuilder selectionLog = new StringBuilder();
1921         StringBuilder textLog = new StringBuilder();
1922         textInput.selectedTextProperty().addListener((observable, oldValue, newValue) -&gt; selectedTextLog.append(&quot;|&quot; + newValue));
1923         textInput.selectionProperty().addListener((observable, oldValue, newValue) -&gt; selectionLog.append(&quot;|&quot; + newValue.getStart() + &quot;,&quot; + newValue.getEnd()));
1924         textInput.textProperty().addListener((observable, oldValue, newValue) -&gt; textLog.append(&quot;|&quot; + newValue));
1925 
1926         textInput.selectRange(3, 6);
1927         assertEquals(&quot;|def&quot;, selectedTextLog.toString());
1928         assertEquals(&quot;|3,6&quot;, selectionLog.toString());
1929         assertEquals(&quot;&quot;, textLog.toString());
1930 
1931         textInput.replaceSelection(&quot;xyz&quot;);
1932         assertEquals(&quot;|def|&quot;, selectedTextLog.toString());
1933         assertEquals(&quot;|3,6|6,6&quot;, selectionLog.toString());
1934         assertEquals(&quot;|abcxyzghij&quot;, textLog.toString());
1935 
1936         textInput.undo();
1937         assertEquals(&quot;|def||def&quot;, selectedTextLog.toString());
1938         assertEquals(&quot;|3,6|6,6|3,6&quot;, selectionLog.toString());
1939         assertEquals(&quot;|abcxyzghij|abcdefghij&quot;, textLog.toString());
1940 
1941         textInput.redo();
1942         assertEquals(&quot;|def||def|&quot;, selectedTextLog.toString());
1943         assertEquals(&quot;|3,6|6,6|3,6|6,6&quot;, selectionLog.toString());
1944         assertEquals(&quot;|abcxyzghij|abcdefghij|abcxyzghij&quot;, textLog.toString());
1945     }
1946 
1947     // Test for JDK-8178418
1948     @Test public void UndoRedoSpaceSequence() {
1949         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1950         StackPane root = new StackPane();
1951         Scene scene = new Scene(root);
1952         Stage stage = new Stage();
1953         String text = &quot;123456789&quot;;
1954         String tempText = &quot;&quot;;
1955 
1956         textInput.setText(text);
1957         stage.setScene(scene);
1958         root.getChildren().removeAll();
1959         root.getChildren().add(textInput);
1960         stage.show();
1961         tk.firePulse();
1962 
1963         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1964 
1965         // Test sequence of spaces
1966         keyboard.doKeyPress(KeyCode.HOME);
1967         tk.firePulse();
1968         for (int i = 0; i &lt; 10; ++i) {
1969             keyboard.doKeyTyped(KeyCode.SPACE);
1970             tk.firePulse();
1971             tempText += &quot; &quot;;
1972         }
1973         assertTrue(textInput.getText().equals(tempText + text));
1974 
1975         textInput.undo();
1976         assertTrue(textInput.getText().equals(text));
1977 
1978         textInput.redo();
1979         assertTrue(textInput.getText().equals(tempText + text));
1980 
1981         root.getChildren().removeAll();
1982         stage.hide();
1983         tk.firePulse();
1984     }
1985 
1986     // Test for JDK-8178418
1987     @Test public void UndoRedoReverseSpaceSequence() {
1988         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1989         StackPane root = new StackPane();
1990         Scene scene = new Scene(root);
1991         Stage stage = new Stage();
1992         String text = &quot;123456789&quot;;
1993         String tempText = &quot;&quot;;
1994 
1995         textInput.setText(text);
1996         stage.setScene(scene);
1997         root.getChildren().removeAll();
1998         root.getChildren().add(textInput);
1999         stage.show();
2000         tk.firePulse();
2001 
2002         KeyEventFirer keyboard = new KeyEventFirer(textInput);
2003         // Test reverse sequence of spaces
2004         keyboard.doKeyPress(KeyCode.HOME);
2005         tk.firePulse();
2006         for (int i = 0; i &lt; 10; ++i) {
2007             keyboard.doKeyTyped(KeyCode.SPACE);
2008             keyboard.doKeyPress(KeyCode.LEFT);
2009             tk.firePulse();
2010             tempText += &quot; &quot;;
2011             assertTrue(textInput.getText().equals(tempText + text));
2012         }
2013 
2014         for (int i = 0; i &lt; 10; ++i) {
2015             textInput.undo();
2016             tk.firePulse();
2017         }
2018         assertTrue(textInput.getText().equals(text));
2019 
2020         tempText = &quot;&quot;;
2021         for (int i = 0; i &lt; 10; ++i) {
2022             textInput.redo();
2023             tk.firePulse();
2024             tempText += &quot; &quot;;
2025             assertTrue(textInput.getText().equals(tempText + text));
2026         }
2027 
2028         root.getChildren().removeAll();
2029         stage.hide();
2030         tk.firePulse();
2031     }
2032 
2033     // Test for JDK-8178418
2034     @Test public void UndoRedoWords() {
2035         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
2036         StackPane root = new StackPane();
2037         Scene scene = new Scene(root);
2038         Stage stage = new Stage();
2039         String text = &quot;123456789&quot;;
2040         String tempText = &quot;&quot;;
2041 
2042         textInput.setText(text);
2043         stage.setScene(scene);
2044         root.getChildren().removeAll();
2045         root.getChildren().add(textInput);
2046         stage.show();
2047         tk.firePulse();
2048 
2049         KeyEventFirer keyboard = new KeyEventFirer(textInput);
2050 
2051         // Test words separated by space
2052         keyboard.doKeyPress(KeyCode.HOME);
2053         tk.firePulse();
2054         for (int i = 0; i &lt; 10; ++i) {
2055             keyboard.doKeyTyped(KeyCode.SPACE);
2056             keyboard.doKeyTyped(KeyCode.A);
2057             keyboard.doKeyTyped(KeyCode.B);
2058             tk.firePulse();
2059             tempText += &quot; AB&quot;;
2060             assertTrue(textInput.getText().equals(tempText + text));
2061         }
2062 
2063         for (int i = 0; i &lt; 10; ++i) {
2064             textInput.undo();
2065             tk.firePulse();
2066         }
2067         assertTrue(textInput.getText().equals(text));
2068 
2069         tempText = &quot;&quot;;
2070         for (int i = 0; i &lt; 10; ++i) {
2071             textInput.redo();
2072             tk.firePulse();
2073             tempText += &quot; AB&quot;;
2074             assertTrue(textInput.getText().equals(tempText + text));
2075         }
2076 
2077         root.getChildren().removeAll();
2078         stage.hide();
2079         tk.firePulse();
2080     }
2081 
2082     // Test for JDK-8178418
2083     @Test public void UndoRedoTimestampBased() {
2084         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
2085         StackPane root = new StackPane();
2086         Scene scene = new Scene(root);
2087         Stage stage = new Stage();
2088         String text = &quot;123456789&quot;;
2089         String tempText = &quot;&quot;;
2090 
2091         textInput.setText(text);
2092         stage.setScene(scene);
2093         root.getChildren().removeAll();
2094         root.getChildren().add(textInput);
2095         stage.show();
2096         tk.firePulse();
2097 
2098         KeyEventFirer keyboard = new KeyEventFirer(textInput);
2099 
2100         // Test continuos sequence of characters.
2101         // In this case an undo-redo record is added after 2500 milliseconds.
2102         keyboard.doKeyPress(KeyCode.HOME);
2103         tk.firePulse();
2104 
2105         long startTime = System.currentTimeMillis();
2106         while (System.currentTimeMillis() - startTime &lt; 4000) {
2107 
2108             keyboard.doKeyTyped(KeyCode.A);
2109             tk.firePulse();
2110             tempText += &quot;A&quot;;
2111             assertTrue(textInput.getText().equals(tempText + text));
2112         }
2113 
2114         textInput.undo();
2115         assertFalse(textInput.getText().equals(text));
2116         textInput.undo();
2117         tk.firePulse();
2118         assertTrue(textInput.getText().equals(text));
2119 
2120         root.getChildren().removeAll();
2121         stage.hide();
2122         tk.firePulse();
2123     }
2124 
2125     // TODO tests for Content firing event notification properly
2126 
2127     // TODO tests for Content not allowing illegal characters
2128 
2129     private void copy(String string) {
2130         ClipboardContent content = new ClipboardContent();
2131         content.putString(string);
2132         Clipboard.getSystemClipboard().setContent(content);
2133     }
2134 }
    </pre>
  </body>
</html>